<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>VendorSoluce â€” Vendor Risk Radar (Demo)</title>
<link href="data:image/svg+xml;utf8,%3Csvg%20width%3D%2232%22%20height%3D%2232%22%20viewBox%3D%220%200%2064%2064%22%20fill%3D%22none%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20aria-hidden%3D%22true%22%3E%0A%3Cpath%20d%3D%22M32%204l22%2010v18c0%2016-10.2%2027.7-22%2031C20.2%2059.7%2010%2048%2010%2032V14L32%204z%22%20fill%3D%22currentColor%22%20opacity%3D%220.12%22/%3E%0A%3Cpath%20d%3D%22M32%207.5l19%208.7V32c0%2014.5-9.3%2025.1-19%2028.1C22.3%2057.1%2013%2046.5%2013%2032V16.2L32%207.5z%22%20stroke%3D%22currentColor%22%20stroke-width%3D%223%22%20/%3E%0A%3Cpath%20d%3D%22M22%2033c4.5-10.5%2015.5-16%2022-12.5%22%20stroke%3D%22currentColor%22%20stroke-width%3D%223%22%20stroke-linecap%3D%22round%22/%3E%0A%3Cpath%20d%3D%22M20.5%2041c7%204.5%2016.5%203.8%2023.5-2%22%20stroke%3D%22currentColor%22%20stroke-width%3D%223%22%20stroke-linecap%3D%22round%22/%3E%0A%3Ccircle%20cx%3D%2244%22%20cy%3D%2220%22%20r%3D%223.5%22%20fill%3D%22currentColor%22/%3E%0A%3Ccircle%20cx%3D%2218%22%20cy%3D%2242%22%20r%3D%223.5%22%20fill%3D%22currentColor%22/%3E%0A%3C/svg%3E" rel="icon"/>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&amp;display=swap" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com"></script>
<script>
  tailwind.config = {
    darkMode: 'class',
    theme: {
      extend: {
        colors: {
          'vendorsoluce-green': {
            DEFAULT: '#33691E',
            dark: '#2E5A1A',
            light: '#66BB6A',
            pale: '#E8F5E8',
          },
          'vendorsoluce-light-green': '#66BB6A',
          'vendorsoluce-pale-green': '#E8F5E8',
        }
      }
    }
  }
</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
<script src="data-management-strategy.js"></script>
<script src="vendor-catalog-enhanced.js"></script>
<style>
      :root{
        /* VendorSoluce brand (Growth Green) */
        --vs-green:#33691E;
        --vs-green-dark:#2E5A1A;
        --vs-green-light:#66BB6A;
        --vs-green-pale:#E8F5E8;

        /* Neutrals */
        --bg:#F7F9FC;
        --bg-2:#FFFFFF;
        --card:#FFFFFF;
        --border:rgba(17,24,39,.12);
        --text:#0F172A;
        --muted:rgba(15,23,42,.68);

        /* Design System Variables */
        --vs-text: var(--text);
        --vs-muted: var(--muted);
        --surface: var(--card);
        --surface-2: rgba(15,23,42,.03);
        --surface-3: rgba(15,23,42,.06);
        --line: var(--border);
        --panel: var(--card);
        --brand: var(--vs-green);
        --brand-2: var(--vs-green-light);
        --shadow: var(--shadow-md);

        /* Risk colors */
        --risk-critical:#DC2626;
        --risk-high:#EA580C;
        --risk-medium:#F59E0B;
        --risk-low:#16A34A;

        /* Shadows */
        --shadow-sm: 0 1px 2px rgba(0,0,0,.06);
        --shadow-md: 0 10px 20px rgba(2,6,23,.08);
        --shadow-lg: 0 20px 45px rgba(2,6,23,.14);
        --ring: 0 0 0 3px rgba(51,105,30,.14);
      }

      html.dark{
        --bg:#070A12;
        --bg-2:rgba(255,255,255,.04);
        --card:rgba(255,255,255,.06);
        --border:rgba(255,255,255,.12);
        --text:rgba(248,250,252,.95);
        --muted:rgba(226,232,240,.70);
        --vs-text: rgba(248,250,252,.95);
        --vs-muted: rgba(226,232,240,.70);
        --surface: rgba(255,255,255,.06);
        --surface-2: rgba(255,255,255,.08);
        --surface-3: rgba(255,255,255,.12);
        --line: rgba(255,255,255,.12);
        --panel: rgba(255,255,255,.06);
        --shadow-sm: 0 1px 2px rgba(0,0,0,.35);
        --shadow-md: 0 12px 24px rgba(0,0,0,.35);
        --shadow-lg: 0 28px 60px rgba(0,0,0,.45);
        --shadow: 0 12px 24px rgba(0,0,0,.35);
        --ring: 0 0 0 3px rgba(102,187,106,.18);
      }

      html{color-scheme: light dark;}
      html[data-theme="dark"]{color-scheme: dark;}
      html[data-theme="light"]{color-scheme: light;}

      *{box-sizing:border-box;margin:0;padding:0}
      body{
        font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
        background: radial-gradient(1200px 700px at 20% -10%, rgba(51,105,30,.14), transparent 55%),
                    radial-gradient(900px 600px at 90% 0%, rgba(102,187,106,.12), transparent 50%),
                    var(--bg);
        color: var(--text);
        padding: 24px;
        min-height: 100vh;
        overflow-x:hidden;
      }

      .radar-container{
        max-width:1800px;
        margin: 0 auto;
        padding: 0 18px;
      }

      /* Header */
      .radar-header{
        text-align:center;
        padding: 28px 24px;
        background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.78));
        border: 1px solid var(--border);
        border-radius: 16px;
        margin-bottom: 18px;
        box-shadow: var(--shadow-md);
        position: relative;
        overflow:hidden;
      }
      html.dark .radar-header{
        background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      }
      .radar-header::before{
        content:'';
        position:absolute; inset:0;
        background: radial-gradient(800px 260px at 50% 0%, rgba(51,105,30,.20), transparent 60%);
        pointer-events:none;
      }
      .radar-header h1{
        font-size: 1.85rem;
        font-weight: 800;
        letter-spacing: .2px;
        margin-bottom: 6px;
      }
      .brand-lines{
        display:inline-block;
        line-height:1.05;
        font-weight:800;
      }
      .brand-lines .line1{color:var(--vs-green)}
      .brand-lines .line2{color:var(--text)}
      .brand-lines .line3{color:var(--muted); font-weight:700}
      .radar-status{font-size:.98rem;color:var(--muted);font-weight:600}
      .timestamp{margin-top:8px;font-size:.85rem;color:var(--muted)}

      /* Toolbar */
      .toolbar{
        display:flex; 
        justify-content:space-between; 
        align-items:center;
        padding: 16px 20px;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 14px;
        box-shadow: var(--shadow-sm);
        margin-bottom: 16px;
        flex-wrap:wrap;
        gap: 16px;
      }
      @media (max-width: 1024px) {
        .toolbar{
          padding: 14px 16px;
          gap: 12px;
        }
      }
      .toolbar-group{
        display:flex; 
        gap: 8px; 
        align-items:center; 
        flex-wrap:wrap;
        flex-shrink: 0;
      }
      .toolbar-group:not(:last-child)::after{
        content: '';
        width: 1px;
        height: 28px;
        background: var(--border);
        margin-left: 12px;
        opacity: 0.4;
      }
      @media (max-width: 768px) {
        .toolbar-group:not(:last-child)::after{
          display: none;
        }
        .toolbar-group{
          width: 100%;
          justify-content: flex-start;
        }
      }
      .filter-group{
        display:flex; 
        flex-direction:column; 
        gap: 6px;
        min-width: 160px;
      }
      .filter-group select{
        width: 100%;
        min-height: 38px;
        padding: 10px 20px;
      }
      .filter-label{font-size:0.75rem; font-weight:600; color:var(--muted); text-transform:uppercase; letter-spacing:0.05em; display:flex; align-items:center; gap:4px}
      .filter-hint{font-size:0.7rem; opacity:0.6; cursor:help; font-style:normal}
      .help-shortcut-hint{animation:pulse 2s infinite}

      button{
        background: var(--vs-green);
        color:#fff;
        border: 1px solid rgba(0,0,0,.06);
        padding: 10px 32px !important;
        border-radius: 10px;
        cursor:pointer;
        font-family: inherit;
        font-size: 0.875rem;
        font-weight: 600;
        transition: transform .15s ease, box-shadow .15s ease, background .15s ease, opacity .15s ease;
        display:inline-flex;
        align-items:center;
        justify-content: center;
        gap: 6px;
        letter-spacing:.2px;
        white-space: nowrap;
        min-height: 38px;
      }
      button:hover:not(:disabled){
        background: var(--vs-green-dark);
        transform: translateY(-1px);
        box-shadow: 0 8px 18px rgba(51,105,30,.20);
      }
      button:active:not(:disabled){transform: translateY(0px)}
      button:disabled{opacity:.5; cursor:not-allowed}
      button.primary,
      a.primary{
        background: var(--vs-green-dark);
        color: #fff;
      }
      button.secondary,
      a.secondary{
        background: transparent;
        color: var(--vs-green);
        border: 1px solid rgba(51,105,30,.35);
      }
      html.dark button.secondary,
      html.dark a.secondary{
        color: var(--vs-green-light); 
        border-color: rgba(102,187,106,.40);
      }
      button.secondary:hover:not(:disabled),
      a.secondary:hover{
        background: rgba(51,105,30,.10);
        box-shadow:none;
      }
      html.dark button.secondary:hover:not(:disabled),
      html.dark a.secondary:hover{
        background: rgba(102,187,106,.12);
      }
      a.primary:hover{
        background: var(--vs-green);
        transform: translateY(-1px);
        box-shadow: 0 8px 18px rgba(51,105,30,.20);
      }
      button.danger{
        background: rgba(220,38,38,.12);
        color: var(--risk-critical);
        border: 1px solid rgba(220,38,38,.35);
      }
      button.danger:hover:not(:disabled){
        background: rgba(220,38,38,.18);
        box-shadow: 0 8px 18px rgba(220,38,38,.18);
        transform: translateY(-1px);
      }

      select{
        background: var(--card);
        color: var(--text) !important;
        border: 1px solid var(--border);
        padding: 10px 20px;
        border-radius: 10px;
        font-family: inherit;
        cursor:pointer;
        font-weight: 600;
        font-size: 0.875rem;
        min-height: 38px;
        display: inline-flex;
        align-items: center;
        transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease;
      }
      html.dark select{
        background: rgba(255,255,255,.06);
        color: rgba(248,250,252,.95) !important;
      }
      html:not(.dark) select{
        background: #fff;
        color: #0F172A !important;
      }
      select option{
        background: var(--card);
        color: var(--text) !important;
      }
      html.dark select option{
        background: rgba(15,23,42,.95);
        color: rgba(248,250,252,.95) !important;
      }
      html:not(.dark) select option{
        background: #fff;
        color: #0F172A !important;
      }
      select:focus{outline:none; box-shadow: var(--ring); border-color: rgba(51,105,30,.45)}
      input[type="file"]{display:none}

      /* Focus states */
      button:focus-visible, a:focus-visible, select:focus-visible{
        outline:none;
        box-shadow: var(--ring);
      }

      /* Active navigation link styles - only target navigation menu links (have title attribute), exclude brand logo */
      nav a[title].active,
      nav a[title][aria-current="page"] {
        color: #33691E !important;
        background: rgba(51,105,30,.08) !important;
        font-weight: 700 !important;
      }
      html.dark nav a[title].active,
      html.dark nav a[title][aria-current="page"] {
        color: #66BB6A !important;
        background: rgba(102,187,106,.12) !important;
      }
      nav a[title].active:hover,
      nav a[title][aria-current="page"]:hover {
        background: rgba(51,105,30,.12) !important;
      }
      html.dark nav a[title].active:hover,
      html.dark nav a[title][aria-current="page"]:hover {
        background: rgba(102,187,106,.18) !important;
      }
      /* Ensure brand logo link is never affected by active/hover nav styles */
      nav [data-tour="main-nav"] a,
      nav [data-tour="main-nav"] a:hover,
      nav [data-tour="main-nav"] a.active,
      nav [data-tour="main-nav"] a[aria-current="page"],
      nav [data-tour="main-nav"] a:focus {
        color: inherit !important;
        background: transparent !important;
        font-weight: inherit !important;
      }
      /* Ensure action button icons are visible */
      nav button svg,
      nav [data-tour="user-menu"] svg,
      nav [data-tour="theme-toggle"] svg {
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
        flex-shrink: 0 !important;
      }
      /* Ensure icons inherit button text color properly */
      nav [data-tour="user-menu"] button svg,
      nav [data-tour="theme-toggle"] button svg {
        stroke: currentColor !important;
        color: inherit !important;
      }
      /* Dark mode icon colors */
      html.dark nav [data-tour="user-menu"] button svg.lucide-user,
      html.dark nav [data-tour="theme-toggle"] button svg.lucide-moon {
        stroke: #D1D5DB !important; /* gray-300 */
        color: #D1D5DB !important;
      }
      html:not(.dark) nav [data-tour="user-menu"] button svg.lucide-user,
      html:not(.dark) nav [data-tour="theme-toggle"] button svg.lucide-moon {
        stroke: #374151 !important; /* gray-700 */
        color: #374151 !important;
      }
      /* Prevent hover effects on active Vendor Radar button */
      nav a[aria-current="page"][style*="pointer-events: none"],
      nav a[aria-current="page"].cursor-default {
        pointer-events: none !important;
        opacity: 0.9;
      }
      nav a[aria-current="page"][style*="pointer-events: none"]:hover,
      nav a[aria-current="page"].cursor-default:hover {
        transform: none !important;
        box-shadow: none !important;
      }

      /* Alert Banner */
      .alert-banner{
        padding: 14px 16px;
        border-radius: 14px;
        margin-bottom: 16px;
        display:flex;
        align-items:center;
        gap: 14px;
        border: 1px solid var(--border);
        background: var(--card);
        box-shadow: var(--shadow-sm);
      }
      .alert-banner.critical{border-left: 6px solid var(--risk-critical)}
      .alert-banner.warning{border-left: 6px solid var(--risk-high)}
      .alert-banner.clear{border-left: 6px solid var(--vs-green)}
      .alert-icon{font-size: 1.35rem; display: flex; align-items: center; justify-content: center; width: 24px; height: 24px; flex-shrink: 0;}
      .alert-title{font-size: 1rem; font-weight: 800; margin-bottom: 2px}
      .alert-content{flex:1}
      .alert-desc{color: var(--muted); font-weight: 600}

      /* Stats Grid */
      .stats-grid{
        display:grid;
        grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
        gap: 14px;
        margin-bottom: 16px;
      }
      .stat-card{
        background: linear-gradient(135deg, var(--card), rgba(255,255,255,.02));
        border: 1.5px solid var(--border);
        border-radius: 18px;
        padding: 20px;
        text-align:left;
        box-shadow: var(--shadow-sm);
        position:relative;
        overflow:hidden;
        transition: all .2s cubic-bezier(0.4, 0, 0.2, 1);
      }
      html.dark .stat-card{
        background: linear-gradient(135deg, var(--card), rgba(255,255,255,.03));
      }
      .stat-card:hover{
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
        border-color: rgba(51,105,30,.3);
      }
      html.dark .stat-card:hover{
        border-color: rgba(102,187,106,.3);
      }
      .stat-card::before{
        content:'';
        position:absolute; 
        inset:0;
        background: radial-gradient(500px 220px at 0% 0%, rgba(51,105,30,.12), transparent 65%);
        pointer-events:none;
        opacity: 0.8;
      }
      html.dark .stat-card::before{
        background: radial-gradient(500px 220px at 0% 0%, rgba(102,187,106,.10), transparent 65%);
      }
      .stat-label{
        font-size: .78rem;
        text-transform: uppercase;
        letter-spacing: .12em;
        color: var(--muted);
        margin-bottom: 8px;
        font-weight: 800;
      }
      .stat-value{
        font-size: 2rem;
        font-weight: 900;
        letter-spacing: -.02em;
      }
      .stat-value.critical{color: var(--risk-critical)}
      .stat-value.warning{color: var(--risk-high)}

      /* Main Grid */
      .radar-grid{
        display:grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
        margin-bottom: 24px;
        margin-top: 24px;
      }
      @media (max-width: 1100px){
        .radar-grid{
          grid-template-columns:1fr;
          gap: 20px;
          margin-bottom: 20px;
          margin-top: 20px;
        }
      }

      /* Radar Display */
      .radar-display,
      .radar-panel{
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 24px;
        box-shadow: var(--shadow-md);
        margin-bottom: 0;
      }
      .radar-display:last-child,
      .radar-panel:last-child{
        margin-bottom: 0;
      }
      .panel-title{
        font-size: 1.05rem;
        font-weight: 900;
        letter-spacing: .02em;
        margin-bottom: 14px;
        display:flex;
        align-items:center;
        justify-content:space-between;
      }
      .panel-subtitle{font-size:.85rem;color:var(--muted);font-weight:600;margin-top:4px}

      .radar-screen{
        width: 100%;
        max-width: 480px;
        height: 480px;
        min-height: 400px;
        aspect-ratio: 1;
        margin: 20px auto;
        position: relative;
        background:
          radial-gradient(circle at 50% 50%, rgba(51,105,30,.25) 0%, rgba(51,105,30,.08) 30%, rgba(0,0,0,0) 60%),
          radial-gradient(circle at 30% 30%, rgba(102,187,106,.15) 0%, rgba(0,0,0,0) 50%),
          radial-gradient(circle at 70% 70%, rgba(51,105,30,.12) 0%, rgba(0,0,0,0) 45%),
          linear-gradient(135deg, rgba(2,6,23,.06) 0%, rgba(2,6,23,.02) 50%, rgba(2,6,23,.00) 100%);
        border-radius: 50%;
        border: 3px solid rgba(51,105,30,.35);
        box-shadow: 
          inset 0 0 100px rgba(51,105,30,.12),
          inset 0 0 200px rgba(102,187,106,.08),
          0 0 0 1px rgba(51,105,30,.15),
          0 20px 60px rgba(2,6,23,.15),
          0 0 80px rgba(51,105,30,.08);
        overflow:hidden;
        position: relative;
      }
      .radar-screen::before{
        content: '';
        position: absolute;
        inset: -2px;
        border-radius: 50%;
        background: linear-gradient(135deg, rgba(102,187,106,.1), rgba(51,105,30,.05));
        opacity: 0;
        transition: opacity 0.3s ease;
        pointer-events: none;
        z-index: 1;
      }
      .radar-screen:hover::before{
        opacity: 1;
      }
      html.dark .radar-screen{
        background:
          radial-gradient(circle at 50% 50%, rgba(102,187,106,.22) 0%, rgba(102,187,106,.08) 30%, rgba(0,0,0,0) 65%),
          radial-gradient(circle at 30% 30%, rgba(51,105,30,.12) 0%, rgba(0,0,0,0) 50%),
          radial-gradient(circle at 70% 70%, rgba(102,187,106,.10) 0%, rgba(0,0,0,0) 45%),
          linear-gradient(135deg, rgba(255,255,255,.05) 0%, rgba(255,255,255,.02) 50%, rgba(255,255,255,.00) 100%);
        border-color: rgba(102,187,106,.40);
        box-shadow: 
          inset 0 0 120px rgba(102,187,106,.12),
          inset 0 0 240px rgba(51,105,30,.08),
          0 0 0 1px rgba(102,187,106,.20),
          0 20px 60px rgba(0,0,0,.35),
          0 0 100px rgba(102,187,106,.12);
      }

      .radar-sweep{
        position:absolute;
        top:50%; left:50%;
        width: 50%;
        height: 3px;
        background: linear-gradient(90deg, 
          rgba(102,187,106,1) 0%, 
          rgba(102,187,106,.85) 20%,
          rgba(102,187,106,.4) 60%,
          rgba(102,187,106,0) 100%);
        transform-origin: left center;
        animation: sweep 3.5s linear infinite;
        filter: drop-shadow(0 0 8px rgba(102,187,106,.6)) drop-shadow(0 0 16px rgba(102,187,106,.3));
        z-index: 10;
      }
      .radar-sweep::after{
        content: '';
        position: absolute;
        right: -4px;
        top: 50%;
        transform: translateY(-50%);
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: rgba(102,187,106,1);
        box-shadow: 0 0 12px rgba(102,187,106,.8);
      }
      @keyframes sweep{
        0%{transform: rotate(0deg); opacity: 1;}
        50%{opacity: 0.9;}
        100%{transform: rotate(360deg); opacity: 1;}
      }

      .radar-grid-lines{
        position:absolute; 
        top:50%; 
        left:50%;
        width:100%; 
        height:100%;
        transform: translate(-50%, -50%);
        z-index: 2;
        pointer-events: none;
      }
      .radar-circle{
        position:absolute;
        border: 1.5px solid rgba(51,105,30,.25);
        border-radius: 50%;
        top:50%; 
        left:50%;
        transform: translate(-50%, -50%);
        box-shadow: inset 0 0 20px rgba(51,105,30,.05);
        pointer-events: none;
      }
      html.dark .radar-circle{
        border-color: rgba(102,187,106,.22);
        box-shadow: inset 0 0 20px rgba(102,187,106,.05);
      }
      .radar-circle:nth-child(1){
        width: calc(25% - 2px);
        height: calc(25% - 2px);
        border-width: 1px;
      }
      .radar-circle:nth-child(2){
        width: calc(50% - 3px);
        height: calc(50% - 3px);
        border-width: 1.5px;
      }
      .radar-circle:nth-child(3){
        width: calc(75% - 3px);
        height: calc(75% - 3px);
        border-width: 1.5px;
      }
      .radar-circle:nth-child(4){
        width: calc(100% - 4px);
        height: calc(100% - 4px);
        border-width: 2px;
      }
      .radar-line{
        position:absolute;
        width: 1.5px;
        height: 50%;
        background: linear-gradient(180deg, 
          rgba(51,105,30,.3) 0%,
          rgba(51,105,30,.2) 50%,
          rgba(51,105,30,.1) 100%);
        top:0; 
        left:50%;
        transform-origin: center bottom;
        box-shadow: 0 0 4px rgba(51,105,30,.1);
        pointer-events: none;
      }
      html.dark .radar-line{
        background: linear-gradient(180deg, 
          rgba(102,187,106,.25) 0%,
          rgba(102,187,106,.15) 50%,
          rgba(102,187,106,.08) 100%);
        box-shadow: 0 0 4px rgba(102,187,106,.1);
      }
      .radar-line:nth-child(5){transform: rotate(0deg)}
      .radar-line:nth-child(6){transform: rotate(45deg)}
      .radar-line:nth-child(7){transform: rotate(90deg)}
      .radar-line:nth-child(8){transform: rotate(135deg)}

      .radar-blip{
        position:absolute;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        transform: translate(-50%, -50%) scale(1);
        cursor:pointer;
        transition: all .3s cubic-bezier(0.4, 0, 0.2, 1);
        border: 2.5px solid rgba(255,255,255,.9);
        animation: blip-pulse 2.5s ease-in-out infinite;
        z-index: 20;
        box-shadow: 0 2px 8px rgba(0,0,0,.2);
        outline: none;
      }
      .radar-blip::before{
        content: '';
        position: absolute;
        inset: -4px;
        border-radius: 50%;
        opacity: 0;
        transition: opacity 0.3s ease;
      }
      .radar-blip:hover,
      .radar-blip:focus{
        transform: translate(-50%, -50%) scale(1.8);
        z-index: 50;
        box-shadow: 0 4px 20px rgba(0,0,0,.4);
      }
      .radar-blip:hover::before,
      .radar-blip:focus::before{
        opacity: 1;
      }
      .radar-blip:focus-visible{
        outline: 2px solid var(--vs-green);
        outline-offset: 4px;
        border-radius: 50%;
      }
      .radar-blip.critical{
        background: linear-gradient(135deg, #DC2626, #B91C1C);
        box-shadow: 0 0 0 8px rgba(220,38,38,.15), 0 0 0 16px rgba(220,38,38,.08);
        border-color: rgba(255,255,255,.95);
      }
      .radar-blip.critical:hover::before{
        box-shadow: 0 0 0 12px rgba(220,38,38,.2), 0 0 0 24px rgba(220,38,38,.1);
      }
      .radar-blip.high{
        background: linear-gradient(135deg, #EA580C, #C2410C);
        box-shadow: 0 0 0 8px rgba(234,88,12,.15), 0 0 0 16px rgba(234,88,12,.08);
        border-color: rgba(255,255,255,.95);
      }
      .radar-blip.high:hover::before{
        box-shadow: 0 0 0 12px rgba(234,88,12,.2), 0 0 0 24px rgba(234,88,12,.1);
      }
      .radar-blip.medium{
        background: linear-gradient(135deg, #F59E0B, #D97706);
        box-shadow: 0 0 0 8px rgba(245,158,11,.15), 0 0 0 16px rgba(245,158,11,.08);
        border-color: rgba(255,255,255,.95);
      }
      .radar-blip.medium:hover::before{
        box-shadow: 0 0 0 12px rgba(245,158,11,.2), 0 0 0 24px rgba(245,158,11,.1);
      }
      .radar-blip.low{
        background: linear-gradient(135deg, #66BB6A, #4CAF50);
        box-shadow: 0 0 0 8px rgba(102,187,106,.15), 0 0 0 16px rgba(102,187,106,.08);
        border-color: rgba(255,255,255,.95);
      }
      .radar-blip.low:hover::before{
        box-shadow: 0 0 0 12px rgba(102,187,106,.2), 0 0 0 24px rgba(102,187,106,.1);
      }
      @keyframes blip-pulse{
        0%,100%{
          opacity:1;
          transform: translate(-50%, -50%) scale(1);
        }
        50%{
          opacity:.7;
          transform: translate(-50%, -50%) scale(1.05);
        }
      }

      .radar-legend{
        display:flex; 
        justify-content:center;
        gap: 20px;
        margin-top: 20px;
        padding: 16px;
        flex-wrap:wrap;
        font-size: .9rem;
        color: var(--text);
        font-weight: 700;
        background: rgba(255,255,255,.03);
        border-radius: 12px;
        border: 1px solid var(--border);
      }
      html.dark .radar-legend{
        background: rgba(255,255,255,.04);
      }
      .legend-item{
        display:flex; 
        align-items:center; 
        gap: 10px;
        padding: 6px 12px;
        border-radius: 8px;
        background: rgba(255,255,255,.02);
        transition: background 0.2s ease;
      }
      .legend-item:hover{
        background: rgba(255,255,255,.05);
      }
      html.dark .legend-item:hover{
        background: rgba(255,255,255,.08);
      }
      .legend-dot{
        width: 14px; 
        height: 14px; 
        border-radius: 50%; 
        border: 2.5px solid rgba(255,255,255,.9);
        box-shadow: 0 2px 4px rgba(0,0,0,.15);
        flex-shrink: 0;
      }
      .legend-dot.critical{background: linear-gradient(135deg, #DC2626, #B91C1C);}
      .legend-dot.high{background: linear-gradient(135deg, #EA580C, #C2410C);}
      .legend-dot.medium{background: linear-gradient(135deg, #F59E0B, #D97706);}
      .legend-dot.low{background: linear-gradient(135deg, #66BB6A, #4CAF50);}

      /* Vendor List */
      .vendor-list{
        max-height: 520px; 
        overflow:auto; 
        padding-right: 6px;
        margin-top: 16px;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .vendor-list::-webkit-scrollbar{width: 10px}
      .vendor-list::-webkit-scrollbar-track{background: rgba(148,163,184,.18); border-radius: 999px}
      .vendor-list::-webkit-scrollbar-thumb{background: rgba(51,105,30,.35); border-radius: 999px}
      html.dark .vendor-list::-webkit-scrollbar-track{background: rgba(255,255,255,.10)}
      html.dark .vendor-list::-webkit-scrollbar-thumb{background: rgba(102,187,106,.28)}

      .vendor-item{
        background: rgba(2,6,23,.02);
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 16px;
        margin-bottom: 0;
        cursor:pointer;
        transition: transform .15s ease, border-color .15s ease, box-shadow .15s ease, background .15s ease;
      }
      html.dark .vendor-item{background: rgba(255,255,255,.04)}
      .vendor-item:hover{
        transform: translateY(-1px);
        border-color: rgba(51,105,30,.35);
        box-shadow: 0 10px 22px rgba(2,6,23,.10);
        background: rgba(51,105,30,.05);
      }
      html.dark .vendor-item:hover{border-color: rgba(102,187,106,.35); background: rgba(102,187,106,.08)}

      .vendor-item.critical{border-left: 6px solid var(--risk-critical)}
      .vendor-item.high{border-left: 6px solid var(--risk-high)}
      .vendor-item.medium{border-left: 6px solid var(--risk-medium)}
      .vendor-item.low{border-left: 6px solid var(--vs-green)}

      .vendor-header{
        display:flex; 
        justify-content:space-between; 
        gap: 12px; 
        align-items:flex-start; 
        margin-bottom: 12px;
      }
      .vendor-name{font-weight: 900; font-size: 1rem}
      .vendor-badges{display:flex; gap: 6px; flex-wrap:wrap; justify-content:flex-end}
      .badge{
        padding: 5px 12px;
        border-radius: 999px;
        font-size: .7rem;
        font-weight: 800;
        letter-spacing: .08em;
        text-transform: uppercase;
        border: 1.5px solid;
        display: inline-flex;
        align-items: center;
        gap: 4px;
        box-shadow: 0 1px 3px rgba(0,0,0,.1);
        transition: all .15s ease;
      }
      .badge:hover{
        transform: scale(1.05);
        box-shadow: 0 2px 6px rgba(0,0,0,.15);
      }
      .badge.critical{
        background: linear-gradient(135deg, rgba(220,38,38,.15), rgba(220,38,38,.10));
        color: var(--risk-critical);
        border-color: rgba(220,38,38,.35);
      }
      .badge.high{
        background: linear-gradient(135deg, rgba(234,88,12,.15), rgba(234,88,12,.10));
        color: var(--risk-high);
        border-color: rgba(234,88,12,.35);
      }
      .badge.medium{
        background: linear-gradient(135deg, rgba(245,158,11,.15), rgba(245,158,11,.10));
        color: var(--risk-medium);
        border-color: rgba(245,158,11,.35);
      }
      .badge.low{
        background: linear-gradient(135deg, rgba(51,105,30,.15), rgba(51,105,30,.10));
        color: var(--vs-green);
        border-color: rgba(51,105,30,.35);
      }
      html.dark .badge.low{
        background: linear-gradient(135deg, rgba(102,187,106,.15), rgba(102,187,106,.10));
        color: var(--vs-green-light);
        border-color: rgba(102,187,106,.35);
      }
      .badge.category{
        background: linear-gradient(135deg, rgba(148,163,184,.16), rgba(148,163,184,.10));
        color: var(--text);
        border-color: rgba(148,163,184,.28);
      }
      html.dark .badge.category{
        background: linear-gradient(135deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
        color: var(--text);
        border-color: rgba(255,255,255,.20);
      }

      .vendor-details{font-size: .9rem; color: var(--muted); font-weight: 650; line-height:1.35}
      .vendor-metrics{display:grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px}
      .metric{
        background: rgba(2,6,23,.02);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 10px;
      }
      html.dark .metric{background: rgba(255,255,255,.04)}
      .metric-label{font-size:.75rem; color: var(--muted); font-weight: 800; letter-spacing:.08em; text-transform: uppercase}
      .metric-value{font-size: 1.05rem; font-weight: 900; margin-top: 4px}
      
      /* Platform Status Styles */
      .vs-metaCard__value.status-operational{color: var(--vs-green);}
      html.dark .vs-metaCard__value.status-operational{color: var(--vs-green-light);}
      .vs-metaCard__value.status-scanning{color: var(--risk-medium); animation: pulse 1.5s ease-in-out infinite;}
      .vs-metaCard__value.status-maintenance{color: var(--risk-high);}
      .vs-metaCard__value.status-error{color: var(--risk-critical);}
      @keyframes pulse{0%,100%{opacity:1}50%{opacity:.6}}

      /* Modals */
      .modal{
        position:fixed;
        inset:0;
        background: rgba(2,6,23,.55);
        display:none;
        align-items:center;
        justify-content:center;
        padding: 18px;
        z-index: 1000;
      }
      .modal.active{display:flex}
      .modal-close{
        cursor:pointer;
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--muted);
        transition: color .15s ease;
      }
      .modal-close:hover{
        color: var(--text);
      }
      .modal-content{
        width:min(760px, 100%);
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 18px;
        box-shadow: var(--shadow-lg);
        padding: 18px;
      }
      .modal-header{display:flex; align-items:flex-start; justify-content:space-between; gap: 12px; margin-bottom: 10px}
      .modal-title{font-size: 1.1rem; font-weight: 900}
      .close-btn{
        background: transparent;
        color: var(--muted);
        border: 1px solid var(--border);
        padding: 8px 10px;
        border-radius: 12px;
      }
      .close-btn:hover{background: rgba(148,163,184,.10); transform:none; box-shadow:none}

      .form-grid{display:grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 10px}
      @media (max-width: 720px){.form-grid{grid-template-columns: 1fr}}
      .form-group label{display:block; font-size:.78rem; font-weight: 800; letter-spacing:.08em; text-transform: uppercase; color: var(--muted); margin-bottom: 6px}
      .form-group input, .form-group textarea, .form-group select{
        width: 100%;
        background: var(--bg-2);
        color: var(--text);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 10px 12px;
        font-family: inherit;
        font-weight: 650;
      }
      .form-group textarea{min-height: 90px; resize: vertical}
      .form-group input:focus, .form-group textarea:focus, .form-group select:focus{outline:none; box-shadow: var(--ring); border-color: rgba(51,105,30,.45)}

      /* Footer */
      .footer{
        margin-top: 18px;
        text-align:center;
        color: var(--muted);
        font-size: .85rem;
        font-weight: 650;
      }

      /* Print */
      @media print{
        body{background:#fff; color:#000}
        .toolbar, .modal{display:none !important}
        .radar-display, .radar-panel, .stat-card, .radar-header{box-shadow:none}
      }
    

      /* VendorSoluce header/footer + shell */
      .vs-shell{ 
        max-width:1800px; 
        margin: 0 auto; 
        padding: 0 0 34px 0; 
      }
      .vs-header{ position:sticky; top:0; z-index:50; border-bottom:1px solid var(--line); background: var(--panel); background: color-mix(in srgb, var(--panel) 92%, transparent); -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px); }
      .vs-header__inner{ max-width:1180px; margin:0 auto; padding:14px 18px; display:flex; align-items:center; gap:16px; }
      .vs-brand{ display:flex; gap:12px; align-items:center; text-decoration:none; color:var(--text); }
      .vs-brand__logo{ width:40px; height:40px; display:grid; place-items:center; border-radius:14px; background: linear-gradient(135deg, rgba(51,105,30,0.22), rgba(102,187,106,0.14)); background: linear-gradient(135deg, color-mix(in srgb, var(--brand) 22%, transparent), color-mix(in srgb, var(--brand-2) 14%, transparent)); border:1px solid rgba(51,105,30,0.22); border:1px solid color-mix(in srgb, var(--brand) 22%, transparent); box-shadow: 0 10px 26px rgba(0,0,0,.18); }
      .vs-brand__text{ display:flex; flex-direction:column; line-height:1.05; }
      .vs-brand__line1{ font-weight:800; letter-spacing:.2px; font-size:14px; }
      .vs-brand__line2{ font-weight:650; font-size:12px; color:var(--muted); }
      .vs-brand__line3{ font-weight:700; font-size:12px; color: var(--brand); color: color-mix(in srgb, var(--brand) 64%, var(--text)); }

      .vs-nav{ margin-left:10px; display:flex; gap:10px; flex-wrap:wrap; }
      .vs-nav__item{ padding:8px 10px; border-radius:10px; text-decoration:none; color:var(--muted); border:1px solid transparent; }
      .vs-nav__item:hover{ color:var(--text); border-color: var(--line); background: color-mix(in srgb, var(--panel) 75%, transparent); }

      .vs-actions{ margin-left:auto; display:flex; gap:10px; align-items:center; }

      .btn{ display:inline-flex; align-items:center; gap:8px; padding:10px 32px !important; border-radius:12px; border:1px solid var(--line); background: var(--panel); color:var(--text); cursor:pointer; }
      .btn:hover{ border-color: var(--brand); border-color: color-mix(in srgb, var(--brand) 30%, var(--line)); }
      .btn-ghost{ background: transparent; }
      .btn__icon{ font-size:14px; }
      .btn__text{ font-weight:650; font-size:13px; }

      .vs-footer{ border-top:1px solid var(--line); background: color-mix(in srgb, var(--panel) 88%, transparent); }
      .vs-footer__inner{ max-width:1180px; margin:0 auto; padding:16px 18px; display:flex; gap:14px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
      .vs-footer__brand{ display:flex; gap:12px; align-items:center; }
      .vs-footer__logo{ width:40px; height:40px; display:grid; place-items:center; border-radius:14px; border:1px solid var(--line); background: color-mix(in srgb, var(--panel) 70%, transparent); }
      .vs-footer__text{ line-height:1.08; }
      .vs-footer__line1{ font-weight:800; font-size:13px; }
      .vs-footer__line2{ font-weight:650; font-size:12px; color:var(--muted); }
      .vs-footer__line3{ font-weight:700; font-size:12px; color: var(--brand); color: color-mix(in srgb, var(--brand) 64%, var(--text)); }
      .vs-footer__meta{ display:flex; gap:10px; align-items:center; }
      .pill{ font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid var(--line); background: color-mix(in srgb, var(--panel) 75%, transparent); }
      .muted{ color:var(--muted); font-size:12px; }

      /* Nicer section anchors */
      [id]{ scroll-margin-top: 92px; }

      /* Premium polish additions */
      .vs-watermark{position:fixed; inset:auto 18px 18px auto; z-index:5; font-weight:900; letter-spacing:.22em;
        font-size:12px; padding:10px 12px; border-radius:999px; opacity:.6;
        color: var(--vs-text); background: rgba(2,6,23,.35); border:1px solid rgba(148,163,184,.25); -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px)}
      [data-theme="light"] .vs-watermark{background: rgba(255,255,255,.65)}
      .vs-hero{margin: 14px 0 20px; padding: 0; border-radius: 18px;
        background: radial-gradient(1200px 420px at 10% 0%, rgba(51,105,30,.35), transparent 60%),
                    radial-gradient(900px 420px at 90% 10%, rgba(34,197,94,.22), transparent 55%),
                    linear-gradient(180deg, rgba(2,6,23,.55), rgba(2,6,23,.25));
        border: 1px solid rgba(148,163,184,.18);
        box-shadow: 0 18px 50px rgba(0,0,0,.28)}
      [data-theme="light"] .vs-hero{background: radial-gradient(1200px 420px at 10% 0%, rgba(51,105,30,.18), transparent 60%),
                    radial-gradient(900px 420px at 90% 10%, rgba(34,197,94,.12), transparent 55%),
                    linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.78));
        box-shadow: 0 18px 50px rgba(2,6,23,.08)}
      .vs-hero__top{display:flex; justify-content:space-between; gap:16px; align-items:flex-start; flex-wrap:wrap}
      .vs-hero__eyebrow{font-size:12px; letter-spacing:.14em; text-transform:uppercase; color: var(--vs-muted); margin-bottom:8px}
      .vs-hero__title{font-size:28px; line-height:1.05; margin:0; font-weight:800}
      .vs-hero__sub{margin-top:10px; color: var(--vs-muted); max-width: 62ch}
      .vs-hero__meta{display:flex; gap:10px; flex-wrap:wrap}
      .vs-metaCard{min-width:160px; padding:12px 14px; border-radius:14px; background: rgba(15,23,42,.45);
        border:1px solid rgba(148,163,184,.16)}
      [data-theme="light"] .vs-metaCard{background: rgba(255,255,255,.78)}
      .vs-metaCard__label{font-size:12px; color: var(--vs-muted); margin-bottom:6px}
      .vs-metaCard__value{font-weight:800}
      .vs-kpis{display:grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap:12px; margin-top:14px}
      @media (max-width: 1100px){.vs-kpis{grid-template-columns: repeat(2, minmax(0,1fr));}}
      @media (max-width: 560px){.vs-kpis{grid-template-columns: 1fr;}}
      .vs-kpi{padding:14px; border-radius:16px; background: rgba(15,23,42,.38);
        border:1px solid rgba(148,163,184,.16); position:relative; overflow:hidden}
      .vs-kpi:before{content:""; position:absolute; inset:-2px -2px auto auto; width:120px; height:120px;
        background: radial-gradient(circle at 40% 40%, rgba(34,197,94,.35), transparent 55%); transform: translate(22px,-22px)}
      [data-theme="light"] .vs-kpi{background: rgba(255,255,255,.78)}
      .vs-kpi__label{font-size:12px; color: var(--vs-muted); letter-spacing:.08em; text-transform:uppercase}
      .vs-kpi__value{font-size:30px; font-weight:900; margin-top:8px}
      .vs-kpi__hint{margin-top:6px; color: var(--vs-muted); font-size:12px}
      .vs-hero__note{display:grid; grid-template-columns: 1.25fr .95fr; gap:12px; margin-top:12px}
      @media (max-width: 900px){.vs-hero__note{grid-template-columns: 1fr;}}
      .vs-note{padding:14px; border-radius:16px; background: rgba(15,23,42,.30); border:1px solid rgba(148,163,184,.14)}
      [data-theme="light"] .vs-note{background: rgba(255,255,255,.78)}
      .vs-note__title{font-weight:900; margin-bottom:6px}
      .vs-note__text{color: var(--vs-muted)}
      .vs-card{padding:14px; border-radius:16px; background: rgba(15,23,42,.30); border:1px solid rgba(148,163,184,.14)}
      [data-theme="light"] .vs-card{background: rgba(255,255,255,.78)}
      .vs-card__title{font-weight:900; margin-bottom:10px}
      .vs-bullets{margin:0; padding-left: 18px; color: var(--vs-text)}
      .vs-bullets li{margin: 6px 0; color: var(--vs-muted)}
      .vs-steps{margin:0; padding-left:18px}
      .vs-steps li{margin: 8px 0; color: var(--vs-muted)}
      .vs-chips{display:flex; flex-wrap:wrap; gap:8px}
      .vs-chip{padding:6px 10px; border-radius:999px; font-size:12px; border:1px solid rgba(148,163,184,.18);
        background: rgba(2,6,23,.35)}
      [data-theme="light"] .vs-chip{background: rgba(255,255,255,.85)}
      .vs-sbomBox{display:grid; gap:8px}
      .vs-sbomLine{display:flex; justify-content:space-between; gap:10px}
      .vs-sbomNote{margin-top:6px; font-size:12px; color: var(--vs-muted)}
      /* Drawer + modal */
      .vs-drawer, .vs-modal{position:fixed; inset:0; z-index:9999; display:none}
      .vs-drawer[aria-hidden="false"], .vs-modal[aria-hidden="false"]{display:block}
      .vs-drawer__backdrop, .vs-modal__backdrop{position:absolute; inset:0; background: rgba(0,0,0,.55)}
      .vs-drawer__panel{position:absolute; right:0; top:0; height:100%; width:min(520px, 94vw);
        background: rgba(2,6,23,.92); color: var(--vs-text);
        border-left: 1px solid rgba(148,163,184,.18); box-shadow: -18px 0 60px rgba(0,0,0,.45);
        display:flex; flex-direction:column}
      [data-theme="light"] .vs-drawer__panel{background: rgba(255,255,255,.95); box-shadow: -18px 0 60px rgba(2,6,23,.12)}
      .vs-drawer__header{display:flex; align-items:flex-start; justify-content:space-between; padding:16px 16px 10px; gap:12px}
      .vs-drawer__title{font-size:18px; font-weight:900}
      .vs-drawer__subtitle{color: var(--vs-muted); margin-top:4px}
      .vs-drawer__body{padding: 0 16px 16px; overflow:auto}
      .vs-drawer__footer{padding: 12px 16px 16px; display:flex; gap:10px; border-top:1px solid rgba(148,163,184,.14)}
      .vs-kpiRow{display:grid; grid-template-columns: repeat(3,1fr); gap:10px; margin-bottom:12px}
      .vs-kpiMini{padding:10px 12px; border-radius:14px; background: rgba(15,23,42,.40); border:1px solid rgba(148,163,184,.14)}
      [data-theme="light"] .vs-kpiMini{background: rgba(255,255,255,.8)}
      .vs-kpiMini__label{font-size:11px; color: var(--vs-muted); text-transform:uppercase; letter-spacing:.10em}
      .vs-kpiMini__value{margin-top:6px; font-weight:900}
      .vs-modal__panel{position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); width:min(760px, 94vw);
        background: rgba(2,6,23,.92); border:1px solid rgba(148,163,184,.18); border-radius: 18px;
        box-shadow: 0 22px 80px rgba(0,0,0,.55)}
      [data-theme="light"] .vs-modal__panel{background: rgba(255,255,255,.95); box-shadow: 0 22px 80px rgba(2,6,23,.12)}
      .vs-modal__header{display:flex; justify-content:space-between; gap:12px; align-items:flex-start; padding:16px 16px 10px}
      .vs-modal__title{font-weight:900; font-size:18px}
      .vs-modal__body{padding: 0 16px 16px}
      .vs-modal__lead{color: var(--vs-muted); margin-top:0}
      .vs-grid2{display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:12px; margin:12px 0}
      @media (max-width: 780px){.vs-grid2{grid-template-columns:1fr}}
      .vs-ctaRow{display:flex; flex-wrap:wrap; gap:10px; margin-top:8px}
      .vs-small{font-size:12px}

      /* Footer Styles */
      .border-border { border-color: var(--border); }
      .bg-background\/95 { background: color-mix(in srgb, var(--bg) 95%, transparent); }
      .text-foreground { color: var(--text); }
      .text-muted-foreground { color: var(--muted); }
      .brand-text { display: flex; flex-direction: column; line-height: 1.2; }
      .brand-name { font-weight: 800; font-size: 18px; color: var(--vs-green); }
      .brand-tagline { font-size: 12px; color: var(--muted); margin-top: 2px; }
      .brand-attribution { font-size: 11px; color: var(--muted); margin-top: 1px; }
      .bg-secure-green\/10 { background: rgba(51, 105, 30, 0.1); }
      .border-secure-green\/30 { border-color: rgba(51, 105, 30, 0.3); }
      .text-secure-green { color: var(--vs-green); }

/* --- VendorSoluce Dashboard Enhancements (v8) --- */
.vs-dashboard{
  max-width:1200px;
  margin: 0 auto 24px;
  padding: 0;
}
.vs-dashboard__header{
  display:flex;flex-direction:column;gap:6px;
  padding:16px 18px;border:1px solid var(--border);
  background:linear-gradient(135deg, rgba(51,105,30,.14), rgba(0,0,0,0));
  border-radius:18px;box-shadow: var(--shadow);
}
html.dark .vs-dashboard__header{background:linear-gradient(135deg, rgba(102,187,106,.10), rgba(0,0,0,0));}
.vs-dashboard__title{font-size:18px;font-weight:800;letter-spacing:.2px}
.vs-dashboard__subtitle{font-size:13px;opacity:.82}

.radar-panel{position:relative}
.panel-title{
  display:flex;align-items:center;justify-content:space-between;gap:10px;
  cursor:pointer; -webkit-user-select:none; user-select:none;
}
.panel-title:focus{outline:2px solid rgba(51,105,30,.35); outline-offset:3px; border-radius:10px;}
.panel-title .panel-chev{opacity:.75; font-size:14px; transition: transform .18s ease, opacity .18s ease;}
.radar-panel.collapsed .panel-chev{transform: rotate(-90deg); opacity:.9;}
.radar-panel.collapsed > :not(.panel-title){display:none !important;}

/* Collapsible Sections */
.collapsible-section{
  position:relative;
  margin: 16px 0;
  border: 1px solid var(--border);
  border-radius: 12px;
  background: var(--card);
  padding: 0;
  overflow: hidden;
}
.collapsible-section.collapsed .section-content{display:none !important;}
.section-header{
  padding: 14px 18px;
  display:flex;align-items:center;justify-content:space-between;gap:10px;
  padding: 12px 16px;
  cursor:pointer;
  -webkit-user-select:none; user-select:none;
  background: var(--surface-2);
  border-bottom: 1px solid var(--border);
  transition: background 0.2s ease;
}
.section-header:hover{background: var(--surface-3);}
.section-header:focus{outline:2px solid rgba(51,105,30,.35); outline-offset:-2px;}
.section-header-content{
  display:flex;align-items:center;gap:8px;
  flex:1;
}
.section-title{
  font-weight: 700;
  font-size: 14px;
  letter-spacing: 0.3px;
  color: var(--text);
}
.section-chev{
  opacity:.75;
  font-size:14px;
  transition: transform .18s ease, opacity .18s ease;
}
.collapsible-section.collapsed .section-chev{transform: rotate(-90deg); opacity:.9;}
.section-content{
  padding: 16px 18px;
}
.section-guidance{
  margin-bottom: 16px;
  padding: 12px;
  background: rgba(51,105,30,.08);
  border-left: 3px solid rgba(51,105,30,.4);
  border-radius: 6px;
}
html.dark .section-guidance{
  background: rgba(102,187,106,.12);
  border-left-color: rgba(102,187,106,.5);
}
.guidance-content{
  font-size: 13px;
  line-height: 1.6;
  color: var(--text);
}
.guidance-content p{margin:0 0 8px 0;}
.guidance-content ul{
  margin: 8px 0 0 0;
  padding-left: 20px;
}
.guidance-content li{margin-bottom: 4px;}

/* Help Buttons */
.section-help-btn, .panel-help-btn{
  width: 20px;
  height: 20px;
  border-radius: 50%;
  border: 1px solid var(--border);
  background: var(--surface);
  color: var(--text);
  font-size: 11px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  flex-shrink: 0;
}
.section-help-btn:hover, .panel-help-btn:hover{
  background: rgba(51,105,30,.15);
  border-color: rgba(51,105,30,.3);
  transform: scale(1.1);
}
html.dark .section-help-btn:hover, html.dark .panel-help-btn:hover{
  background: rgba(102,187,106,.2);
  border-color: rgba(102,187,106,.4);
}

/* Panel Guidance */
.panel-guidance{
  margin-bottom: 12px;
  padding: 10px;
  background: rgba(51,105,30,.08);
  border-left: 3px solid rgba(51,105,30,.4);
  border-radius: 6px;
  font-size: 12px;
  line-height: 1.5;
}
html.dark .panel-guidance{
  background: rgba(102,187,106,.12);
  border-left-color: rgba(102,187,106,.5);
}
.panel-title span{flex:1;}

.vs-kpi{border:1px solid var(--border); background:var(--surface); box-shadow: var(--shadow);}
html.dark .vs-kpi{background:rgba(255,255,255,.06);}

.toolbar button.secondary{border:1px solid var(--border); background:var(--surface-2); padding-left: 32px !important; padding-right: 32px !important;}
html.dark .toolbar button.secondary{background:rgba(255,255,255,.06);}

/* Breadcrumb Navigation */
.breadcrumb-nav{
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 12px 24px;
  margin-bottom: 18px;
  box-shadow: var(--shadow-sm);
}
.breadcrumb-nav .breadcrumb-container{
  max-width: 1800px;
  margin: 0 auto;
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 0.9rem;
}
.breadcrumb-nav a{
  display: inline-flex;
  align-items: center;
  gap: 6px;
  color: var(--muted);
  text-decoration: none;
  transition: color 0.15s ease;
}
.breadcrumb-nav a:hover{
  color: var(--vs-green);
}
html.dark .breadcrumb-nav a:hover{
  color: var(--vs-green-light);
}
.breadcrumb-nav .breadcrumb-separator{
  color: var(--muted);
  opacity: 0.5;
}
.breadcrumb-nav .breadcrumb-current{
  font-weight: 600;
  color: var(--vs-green);
}
html.dark .breadcrumb-nav .breadcrumb-current{
  color: var(--vs-green-light);
}

/* Help Panel */
.help-panel{
  position: fixed;
  top: 0;
  right: -400px;
  width: 400px;
  max-width: 90vw;
  height: 100vh;
  background: var(--card);
  border-left: 1px solid var(--border);
  box-shadow: -4px 0 20px rgba(0,0,0,.15);
  z-index: 10000;
  transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  overflow-y: auto;
  display: flex;
  flex-direction: column;
}
.help-panel.show{
  right: 0;
}
.help-panel-header{
  padding: 20px;
  border-bottom: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: var(--panel);
  position: sticky;
  top: 0;
  z-index: 1;
}
.help-panel-header h3{
  margin: 0;
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--text);
}
.help-panel-close{
  background: transparent;
  border: none;
  cursor: pointer;
  padding: 4px;
  border-radius: 6px;
  color: var(--muted);
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}
.help-panel-close:hover{
  background: var(--surface-2);
  color: var(--text);
}
.help-panel-content{
  padding: 20px;
  flex: 1;
}
.help-section{
  margin-bottom: 24px;
}
.help-section h4{
  font-size: 1rem;
  font-weight: 700;
  color: var(--text);
  margin: 0 0 12px 0;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--border);
}
.help-section ul{
  list-style: none;
  padding: 0;
  margin: 0;
}
.help-section li{
  margin-bottom: 10px;
  padding-left: 20px;
  position: relative;
  font-size: 0.9rem;
  line-height: 1.6;
  color: var(--text);
}
.help-section li::before{
  content: 'â€¢';
  position: absolute;
  left: 0;
  color: var(--vs-green);
  font-weight: 700;
}
.help-section kbd{
  background: var(--surface-2);
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 2px 6px;
  font-family: monospace;
  font-size: 0.85em;
  color: var(--text);
  box-shadow: 0 1px 2px rgba(0,0,0,.1);
}
html.dark .help-section kbd{
  background: rgba(255,255,255,.1);
  border-color: rgba(255,255,255,.2);
}

/* Help Panel Backdrop */
.help-panel-backdrop{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.4);
  z-index: 9999;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
  -webkit-backdrop-filter: blur(2px);
  backdrop-filter: blur(2px);
}
.help-panel-backdrop.show{
  opacity: 1;
  pointer-events: all;
}
</style>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<meta content="Vendor risk radar demo aligned with NIST SP 800-161. Import vendors (CSV/Excel), prioritize critical risk, and surface SBOM gaps." name="description"/>
<script>
// Production-safe logging utility
(function() {
  const DEBUG = false; // Set to false in production
  window.log = DEBUG ? console.log.bind(console) : function() {};
  window.logError = function(...args) {
    // Always log errors, but could send to error tracking service
    console.error(...args);
    // TODO: Send to error tracking service (e.g., Sentry) in production
  };
  window.logWarn = DEBUG ? console.warn.bind(console) : function() {};
})();

// Theme toggle functionality - must run immediately to prevent flash
(function() {
  // Get theme from localStorage or default to light
  const getTheme = () => {
    const stored = localStorage.getItem('theme');
    if (stored) return stored;
    // Check system preference
    return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
  };
  
  // Apply theme
  const applyTheme = (theme) => {
    const html = document.documentElement;
    if (theme === 'dark') {
      html.classList.add('dark');
    } else {
      html.classList.remove('dark');
    }
    localStorage.setItem('theme', theme);
    
    // Update theme toggle button icons (only if DOM is ready)
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        updateThemeIcons(theme);
      });
    } else {
      updateThemeIcons(theme);
    }
  };
  
  // Update theme toggle button icons
  const updateThemeIcons = (theme) => {
    const themeButtons = document.querySelectorAll('[data-theme-toggle]');
    themeButtons.forEach(btn => {
      const sunIcon = btn.querySelector('.lucide-sun');
      const moonIcon = btn.querySelector('.lucide-moon');
      if (theme === 'dark') {
        if (sunIcon) {
          sunIcon.style.display = 'block';
          sunIcon.style.visibility = 'visible';
        }
        if (moonIcon) {
          moonIcon.style.display = 'none';
          moonIcon.style.visibility = 'hidden';
        }
        btn.setAttribute('aria-label', 'Switch to light mode');
      } else {
        if (sunIcon) {
          sunIcon.style.display = 'none';
          sunIcon.style.visibility = 'hidden';
        }
        if (moonIcon) {
          moonIcon.style.display = 'block';
          moonIcon.style.visibility = 'visible';
        }
        btn.setAttribute('aria-label', 'Switch to dark mode');
      }
    });
  };
  
  // Apply theme immediately to prevent flash
  applyTheme(getTheme());
  
  // Set up event listeners after DOM is ready
  document.addEventListener('DOMContentLoaded', () => {
    // Re-apply theme to ensure icons are updated
    applyTheme(getTheme());
    
    // Add click handlers to theme toggle buttons
    document.querySelectorAll('[data-theme-toggle]').forEach(btn => {
      btn.addEventListener('click', () => {
        const currentTheme = getTheme();
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        applyTheme(newTheme);
      });
    });
    
    // Listen for system theme changes
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
      if (!localStorage.getItem('theme')) {
        applyTheme(e.matches ? 'dark' : 'light');
      }
    });
  });
})();
</script>
<style id="vendorsoluce-vendor-catalog-css">
  .vs-modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:9999;padding:16px}
  .vs-modal{width:min(1100px,100%);max-height:86vh;overflow:auto;border-radius:18px;box-shadow:0 20px 70px rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.08)}
  html:not(.dark) .vs-modal{background:#fff;border-color:rgba(0,0,0,.08)}
  html.dark .vs-modal{background:rgba(12,22,16,.98)}
  .vs-modal header{position:sticky;top:0;-webkit-backdrop-filter:saturate(180%) blur(12px);backdrop-filter:saturate(180%) blur(12px);padding:14px 16px;border-bottom:1px solid rgba(127,127,127,.18);display:flex;align-items:center;justify-content:space-between;gap:12px}
  .vs-modal h3{margin:0;font-size:16px;font-weight:750;letter-spacing:.2px}
  .vs-modal .vs-close{appearance:none;border:1px solid rgba(127,127,127,.25);background:transparent;border-radius:12px;padding:8px 10px;cursor:pointer}
  .vs-modal .vs-body{padding:16px}
  .vs-grid{display:grid;grid-template-columns: 320px 1fr;gap:16px}
  @media (max-width: 980px){.vs-grid{grid-template-columns:1fr}}
  .vs-card{border-radius:16px;border:1px solid rgba(127,127,127,.18);padding:14px}
  html:not(.dark) .vs-card{background:linear-gradient(180deg, rgba(51,105,30,.06), rgba(0,0,0,0));}
  html.dark .vs-card{background:linear-gradient(180deg, rgba(51,105,30,.12), rgba(0,0,0,0));}
  .vs-field{display:flex;flex-direction:column;gap:6px;margin-bottom:12px}
  .vs-field label{font-size:12px;opacity:.8}
  .vs-input,.vs-select{padding:10px 12px;border-radius:12px;border:1px solid rgba(127,127,127,.25);background:transparent}
  html:not(.dark) .vs-input, html:not(.dark) .vs-select{background:#fff}
  .vs-row{display:flex;gap:10px;flex-wrap:wrap}
  .vs-pill{display:inline-flex;align-items:center;gap:8px;border:1px solid rgba(127,127,127,.22);border-radius:999px;padding:7px 10px;font-size:12px}
  .vs-btn{appearance:none;border:1px solid rgba(127,127,127,.25);background:transparent;border-radius:12px;padding:10px 12px;cursor:pointer;font-weight:650}
  .vs-btn.primary{border-color:rgba(51,105,30,.55)}
  html:not(.dark) .vs-btn.primary{background:rgba(51,105,30,.10)}
  html.dark .vs-btn.primary{background:rgba(51,105,30,.18)}
  .vs-table{width:100%;border-collapse:separate;border-spacing:0 10px}
  .vs-table th{font-size:12px;text-align:left;opacity:.75;padding:0 10px}
  .vs-table td{padding:12px 10px;border-top:1px solid rgba(127,127,127,.18);border-bottom:1px solid rgba(127,127,127,.18)}
  .vs-table tr td:first-child{border-left:1px solid rgba(127,127,127,.18);border-top-left-radius:14px;border-bottom-left-radius:14px}
  .vs-table tr td:last-child{border-right:1px solid rgba(127,127,127,.18);border-top-right-radius:14px;border-bottom-right-radius:14px}
  .vs-muted{opacity:.75;font-size:12px}
  .vs-badge{display:inline-flex;align-items:center;border-radius:999px;padding:2px 6px;font-size:0.65em;background:rgba(51,105,30,.12);color:var(--vs-green);font-weight:600;vertical-align:middle;border:none}
  html.dark .vs-badge{background:rgba(102,187,106,.18);color:var(--vs-green-light)}
  .vs-stepper{display:flex;gap:8px;flex-wrap:wrap}
  .vs-step{padding:7px 10px;border-radius:999px;border:1px solid rgba(127,127,127,.22);font-size:12px}
  .vs-step.active{border-color:rgba(51,105,30,.55)}
  .vs-alert{border-radius:14px;border:1px solid rgba(127,127,127,.18);padding:10px 12px;font-size:12px}
  html:not(.dark) .vs-alert{background:rgba(51,105,30,.06)}
  html.dark .vs-alert{background:rgba(51,105,30,.12)}
</style>
</head>
<body>
<!-- Shared Header Navigation for VendorSoluce -->
<nav class="bg-white dark:bg-gray-800 shadow-sm sticky top-0 z-[100] w-full">
  <div class="max-w-7xl mx-auto px-2 sm:px-4 lg:px-8 w-full">
    <div class="flex items-center justify-between h-16 w-full">
      <!-- Brand -->
      <div class="flex items-center flex-shrink-0 min-w-0 md:max-w-none max-w-[calc(100%-60px)]" data-tour="main-nav">
        <a class="flex items-center min-w-0 group" href="../index.html">
          <img src="../homepage_files/vendorsoluce.png" alt="VendorSoluce Logo" class="h-9 w-9 sm:h-10 sm:w-10 md:h-11 md:w-11 flex-shrink-0 transition-transform group-hover:scale-105 pointer-events-none">
          <span class="ml-1.5 sm:ml-2 min-w-0 pointer-events-none">
            <div class="flex items-center gap-1.5">
              <span class="block text-[10px] sm:text-xs md:text-sm font-bold text-vendorsoluce-green dark:text-white truncate leading-tight">
                VendorSoluceâ„¢
                <span class="vs-badge ml-1.5">beta</span>
              </span>
            </div>
            <span class="block text-[9px] sm:text-[10px] md:text-[10px] text-vendorsoluce-green/80 text-gray-700 dark:text-vendorsoluce-light-green font-normal leading-tight tracking-tighter" style="letter-spacing: -0.02em; margin-top: -3px;">Supply Chain Assurance</span>
            <span class="block text-[9px] sm:text-[10px] md:text-[10px] text-gray-600 dark:text-gray-400 font-normal leading-tight">by ERMITS</span>
          </span>
        </a>
      </div>

      <!-- Desktop Navigation - Streamlined -->
      <div class="hidden md:flex md:items-center md:space-x-1">
        <a class="inline-flex items-center px-3 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-white hover:text-vendorsoluce-green dark:hover:text-white hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200" title="Home" href="../index.html">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-home w-4 h-4 mr-1.5">
            <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
          </svg>
          Home
        </a>
        <a class="inline-flex items-center px-3 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-white hover:text-vendorsoluce-green dark:hover:text-white hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200" title="How It Works" href="../how-it-works.html">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-layers w-4 h-4 mr-1.5">
            <path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"></path>
            <path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"></path>
            <path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"></path>
          </svg>
          How It Works
        </a>
        <a class="inline-flex items-center px-3 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-white hover:text-vendorsoluce-green dark:hover:text-white hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200" title="Features" href="../features.html">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sparkles w-4 h-4 mr-1.5">
            <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path>
            <path d="M5 3v4"></path>
            <path d="M19 17v4"></path>
            <path d="M3 5h4"></path>
            <path d="M17 19h4"></path>
          </svg>
          Features
        </a>
        <a class="inline-flex items-center px-3 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-white hover:text-vendorsoluce-green dark:hover:text-white hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200" title="Pricing" href="../pricing.html">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-dollar-sign w-4 h-4 mr-1.5">
            <line x1="12" x2="12" y1="2" y2="22"></line>
            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
          </svg>
          Pricing
        </a>
        <a class="inline-flex items-center px-3 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-white hover:text-vendorsoluce-green dark:hover:text-white hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200" title="Trust" href="../trust.html">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shield w-4 h-4 mr-1.5">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"></path>
          </svg>
          Trust
        </a>
        <div class="ml-2 border-l border-gray-300 dark:border-gray-600 pl-3">
          <a href="vendor-risk-radar.html" aria-current="page" class="inline-flex items-center px-4 py-2 rounded-lg transition-all duration-200 hover:scale-105 hover:shadow-md focus:outline-none focus:ring-2 focus:ring-vendorsoluce-green focus:ring-offset-2 bg-vendorsoluce-green text-white hover:bg-vendorsoluce-dark-green font-semibold text-sm opacity-90 cursor-default" title="Vendor Radar" style="pointer-events: none;">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-radar w-4 h-4 mr-1.5">
              <path d="M19.07 4.93A10 10 0 0 0 6.99 3.34M4.93 19.07a10 10 0 0 1 1.65-12.08M15.34 6.99a10 10 0 0 1 2.73 12.08M2 12h20M12 2v20"></path>
              <circle cx="12" cy="12" r="2"></circle>
            </svg>
            Vendor Radar
          </a>
        </div>
      </div>

      <!-- Action Buttons (Desktop) -->
      <div class="hidden md:flex items-center space-x-1.5 sm:space-x-2 flex-shrink-0">
        <div data-tour="user-menu">
          <a href="https://www.application.vendorsoluce.com">
            <button type="button" class="w-9 h-9 rounded-lg transition-all duration-200 hover:scale-105 hover:shadow-md focus:outline-none focus:ring-2 focus:ring-vendorsoluce-green focus:ring-offset-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 flex items-center justify-center" aria-label="User Account">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user w-5 h-5">
                <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
            </button>
          </a>
        </div>
        <div data-tour="theme-toggle">
          <button type="button" data-theme-toggle class="w-9 h-9 rounded-lg transition-all duration-200 hover:scale-105 hover:shadow-md focus:outline-none focus:ring-2 focus:ring-vendorsoluce-green focus:ring-offset-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-yellow-400 hover:bg-gray-200 dark:hover:bg-gray-600 flex items-center justify-center" aria-label="Switch theme">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sun w-5 h-5 text-amber-500" style="display: none;">
              <circle cx="12" cy="12" r="4"></circle>
              <path d="M12 2v2"></path>
              <path d="M12 20v2"></path>
              <path d="m4.93 4.93 1.41 1.41"></path>
              <path d="m17.66 17.66 1.41 1.41"></path>
              <path d="M2 12h2"></path>
              <path d="M20 12h2"></path>
              <path d="m6.34 17.66-1.41 1.41"></path>
              <path d="m19.07 4.93-1.41 1.41"></path>
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon w-5 h-5">
              <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path>
            </svg>
          </button>
        </div>
      </div>

      <!-- Mobile Menu Button -->
      <div class="flex items-center md:hidden flex-shrink-0 ml-auto gap-1.5">
        <div data-tour="theme-toggle">
          <button type="button" data-theme-toggle class="font-medium rounded-md transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 bg-transparent text-vendorsoluce-green hover:bg-vendorsoluce-pale-green focus:ring-vendorsoluce-green/30 dark:text-vendorsoluce-light-green dark:hover:bg-vendorsoluce-green/20 px-3 py-1.5 text-sm cursor-pointer p-2" aria-label="Switch to light mode">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sun h-5 w-5 text-vendorsoluce-green dark:text-vendorsoluce-light-green" style="display: none;"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path d="m19.07 4.93-1.41 1.41"></path></svg>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon h-5 w-5 text-vendorsoluce-green dark:text-vendorsoluce-light-green"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg>
          </button>
        </div>
        <button data-mobile-menu-button="true" class="inline-flex items-center justify-center p-1.5 rounded-md text-gray-700 dark:text-gray-300 hover:text-vendorsoluce-green dark:hover:text-white hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none flex-shrink-0 w-9 h-9" aria-label="Open menu" aria-expanded="false">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu text-gray-700 dark:text-gray-300">
            <line x1="4" x2="20" y1="12" y2="12"></line>
            <line x1="4" x2="20" y1="6" y2="6"></line>
            <line x1="4" x2="20" y1="18" y2="18"></line>
          </svg>
        </button>
      </div>
    </div>
  </div>
</nav>

<!-- Mobile Menu Panel - Streamlined -->
<div data-mobile-menu="true" class="md:hidden fixed left-0 right-0 z-50 hidden" style="top: 64px;">
  <div class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 shadow-lg">
    <div class="max-w-7xl mx-auto px-4 py-3">
      <div class="space-y-2">
        <a href="../index.html" class="flex items-center px-3 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-vendorsoluce-green dark:hover:text-white hover:bg-gray-50 dark:hover:bg-gray-700">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-home w-4 h-4 mr-2">
            <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
          </svg>
          Home
        </a>
        <a href="../how-it-works.html" class="flex items-center px-3 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-vendorsoluce-green dark:hover:text-white hover:bg-gray-50 dark:hover:bg-gray-700">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-layers w-4 h-4 mr-2">
            <path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"></path>
            <path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"></path>
            <path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"></path>
          </svg>
          How It Works
        </a>
        <a href="../features.html" class="flex items-center px-3 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-vendorsoluce-green dark:hover:text-white hover:bg-gray-50 dark:hover:bg-gray-700">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sparkles w-4 h-4 mr-2">
            <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path>
            <path d="M5 3v4"></path>
            <path d="M19 17v4"></path>
            <path d="M3 5h4"></path>
            <path d="M17 19h4"></path>
          </svg>
          Features
        </a>
        <a href="../pricing.html" class="flex items-center px-3 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-vendorsoluce-green dark:hover:text-white hover:bg-gray-50 dark:hover:bg-gray-700">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-dollar-sign w-4 h-4 mr-2">
            <line x1="12" x2="12" y1="2" y2="22"></line>
            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
          </svg>
          Pricing
        </a>
        <a href="../trust.html" class="flex items-center px-3 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-vendorsoluce-green dark:hover:text-white hover:bg-gray-50 dark:hover:bg-gray-700">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shield w-4 h-4 mr-2">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"></path>
          </svg>
          Trust
        </a>
        <div class="pt-2 border-t border-gray-200 dark:border-gray-700">
          <a href="vendor-risk-radar.html" aria-current="page" class="flex items-center justify-center gap-2 w-full px-4 py-2 rounded-lg text-sm font-semibold text-center text-white bg-vendorsoluce-green hover:bg-vendorsoluce-dark-green transition-colors opacity-90 cursor-default" style="pointer-events: none;">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-radar w-4 h-4">
              <path d="M19.07 4.93A10 10 0 0 0 6.99 3.34M4.93 19.07a10 10 0 0 1 1.65-12.08M15.34 6.99a10 10 0 0 1 2.73 12.08M2 12h20M12 2v20"></path>
              <circle cx="12" cy="12" r="2"></circle>
            </svg>
            Vendor Radar
          </a>
        </div>
        <!-- Secondary links in footer section -->
        <div class="pt-2 border-t border-gray-200 dark:border-gray-700 space-y-2">
          <a href="../faq.html" class="block px-3 py-2 rounded-lg text-sm font-medium text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">
            FAQ
          </a>
          <a href="../contact.html" class="block px-3 py-2 rounded-lg text-sm font-medium text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">
            Contact
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Tooltip -->
<div class="tooltip" id="tooltip">
<div class="tooltip-title" id="tooltipTitle"></div>
<div class="tooltip-content" id="tooltipContent"></div>
</div>
<style>
.tooltip{
  position: fixed;
  background: linear-gradient(135deg, rgba(2,6,23,.95), rgba(2,6,23,.92));
  border: 1.5px solid rgba(51,105,30,.4);
  border-radius: 12px;
  padding: 12px 16px;
  box-shadow: 0 12px 32px rgba(0,0,0,.3), 0 0 0 1px rgba(51,105,30,.2);
  z-index: 10000;
  pointer-events: none;
  opacity: 0;
  transform: translateY(-4px);
  transition: opacity 0.2s ease, transform 0.2s ease;
  max-width: 280px;
  -webkit-backdrop-filter: blur(12px);
  backdrop-filter: blur(12px);
}
html.dark .tooltip{
  background: linear-gradient(135deg, rgba(15,23,42,.98), rgba(15,23,42,.95));
  border-color: rgba(102,187,106,.4);
  box-shadow: 0 12px 32px rgba(0,0,0,.5), 0 0 0 1px rgba(102,187,106,.2);
}
.tooltip.show{
  opacity: 1;
  transform: translateY(0);
}
.tooltip-title{
  font-size: 1rem;
  font-weight: 800;
  color: var(--text);
  margin-bottom: 8px;
  padding-bottom: 6px;
  border-bottom: 1px solid var(--border);
}
.tooltip-content{
  font-size: 0.85rem;
  color: var(--muted);
  line-height: 1.6;
}
.tooltip-row{
  display: flex;
  justify-content: space-between;
  gap: 12px;
  margin-bottom: 6px;
}
.tooltip-row span:first-child{
  color: var(--muted);
}
.tooltip-row strong{
  color: var(--text);
  font-weight: 700;
}
</style>
<!-- Add/Edit Vendor Modal -->
<div class="modal" id="vendorModal">
<div class="modal-content">
<div class="modal-header">
<div class="modal-title" id="modalTitle">ADD VENDOR</div>
<div class="modal-close" onclick="closeVendorModal()">âœ•</div>
</div>
<form id="vendorForm">
<div class="form-group">
<label class="form-label">Vendor Name *</label>
<input class="form-input" id="vendorName" required="" type="text"/>
</div>
<div class="form-group">
<label class="form-label">Vendor Category *</label>
<select class="form-input" id="vendorCategory" required="">
<option value="">Select Category</option>
<option value="critical">Critical - Mission Essential</option>
<option value="strategic">Strategic - High Value</option>
<option value="tactical">Tactical - Operational</option>
<option value="commodity">Commodity - Low Impact</option>
</select>
</div>
<div class="form-group">
<label class="form-label">Data in Scope *</label>
<div class="checkbox-group">
<label class="checkbox-label">
<input name="dataType" type="checkbox" value="PII"/> PII
                        </label>
<label class="checkbox-label">
<input name="dataType" type="checkbox" value="PHI"/> PHI
                        </label>
<label class="checkbox-label">
<input name="dataType" type="checkbox" value="Financial"/> Financial
                        </label>
<label class="checkbox-label">
<input name="dataType" type="checkbox" value="IP"/> Intellectual Property
                        </label>
<label class="checkbox-label">
<input name="dataType" type="checkbox" value="Confidential"/> Confidential
                        </label>
<label class="checkbox-label">
<input name="dataType" type="checkbox" value="Public"/> Public Only
                        </label>
</div>
</div>
<div class="form-group">
<label class="form-label">Sector</label>
<select class="form-input" id="vendorSector">
<option value="Cloud Services">Cloud Services</option>
<option value="SaaS">SaaS</option>
<option value="Security">Security</option>
<option value="Infrastructure">Infrastructure</option>
<option value="Collaboration">Collaboration</option>
<option value="Analytics">Analytics</option>
<option value="Financial">Financial Services</option>
<option value="Healthcare">Healthcare</option>
<option value="Consulting">Consulting</option>
<option value="Other">Other</option>
</select>
</div>
<div class="form-group">
<label class="form-label">Location</label>
<select class="form-input" id="vendorLocation">
<option value="United States">United States</option>
<option value="Europe">Europe</option>
<option value="Asia">Asia</option>
<option value="Global">Global</option>
<option value="Other">Other</option>
</select>
</div>
<div class="form-group">
<label class="form-label">Contact Email</label>
<input class="form-input" id="vendorContact" type="email"/>
</div>
<div class="form-group">
<label class="form-label">Notes</label>
<textarea class="form-input" id="vendorNotes"></textarea>
</div>
<div style="display: flex; gap: 15px; justify-content: flex-end;">
<button onclick="closeVendorModal()" type="button">CANCEL</button>
<button class="primary" type="submit">SAVE VENDOR</button>
</div>
</form>
</div>
</div>
<!-- Breadcrumb Navigation -->
<nav aria-label="Breadcrumb" class="breadcrumb-nav">
  <div class="breadcrumb-container">
    <a href="../index.html">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
      Home
    </a>
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="breadcrumb-separator"><path d="m9 18 6-6-6-6"></path></svg>
    <span class="breadcrumb-current">Vendor Risk Radar</span>
  </div>
</nav>
<!-- Header -->
<!-- Dashboard Overview + Executive KPIs -->
<section class="vs-hero collapsible-section collapsed" id="radar">
<div class="section-header" data-section="hero-header" style="margin-bottom: 0;">
<div class="section-header-content">
<span class="section-title" style="display: inline-flex; align-items: center; gap: 8px; font-size: 1.1rem; font-weight: 700;">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-layout-dashboard"><rect width="7" height="9" x="3" y="3" rx="1"></rect><rect width="7" height="5" x="14" y="3" rx="1"></rect><rect width="7" height="9" x="14" y="12" rx="1"></rect><rect width="7" height="5" x="3" y="16" rx="1"></rect></svg>
Dashboard Overview
</span>
</div>
<span class="section-chev">â–¾</span>
</div>
<div class="section-content">
<div class="vs-hero__top">
<div>
<div class="vs-hero__eyebrow" id="modeIndicator">VendorSoluce â€¢ Demo Mode</div>
<h1 class="vs-hero__title">Vendor Risk Radar</h1>
<div class="vs-hero__sub">Supply chain risk signal map with SBOM-aware classification (EO 14028 posture signals).</div>
</div>
<div class="vs-hero__meta">
<div class="vs-metaCard">
<div class="vs-metaCard__label">Status</div>
<div class="vs-metaCard__value" id="platformStatus" style="cursor: pointer; user-select: none;" onclick="togglePlatformStatus()" title="Click to refresh status">Operational</div>
</div>
<div class="vs-metaCard">
<div class="vs-metaCard__label">Last refresh</div>
<div class="vs-metaCard__value" id="timestamp">â€”</div>
</div>
</div>
</div>
<!-- Trial CTA Banner -->
<div class="vs-hero__note" id="trialCtaBanner" style="border-top: 1px solid var(--border); padding-top: 16px; margin-top: 16px; display: none;">
<div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px;">
<div>
<div style="font-weight: 700; margin-bottom: 4px;">Ready to import your vendors?</div>
<div style="font-size: 0.9rem; color: var(--muted);">Start your 14-day free trial â€” no credit card required</div>
</div>
<button class="btn primary" onclick="startTrial()" style="white-space: nowrap; display: inline-flex; align-items: center; gap: 6px;">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-rocket"><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"></path><path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"></path><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"></path><path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"></path></svg>
Start Free Trial
</button>
</div>
</div>
<div class="collapsible-section">
<div class="section-header" data-section="kpis">
<div class="section-header-content">
<span class="section-title" style="display: inline-flex; align-items: center; gap: 8px;"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trending-up"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline><polyline points="16 7 22 7 22 13"></polyline></svg>Executive KPIs</span>
<button class="section-help-btn" onclick="showGuidance('kpis')" aria-label="Show guidance" title="Show guidance"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-info"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg></button>
</div>
<span class="section-chev">â–¾</span>
</div>
<div class="section-content">
<div class="section-guidance" id="guidance-kpis" style="display: none;">
<div class="guidance-content">
<p><strong>Executive KPIs:</strong> Key performance indicators for leadership reporting. These metrics help prioritize vendor risk management efforts and demonstrate compliance posture.</p>
<ul>
<li><strong>Vendors in view:</strong> Current count of vendors being analyzed (demo mode has limits)</li>
<li><strong>Critical vendors:</strong> Mission-essential vendors requiring highest attention</li>
<li><strong>SBOM gaps:</strong> Software vendors missing Software Bill of Materials (EO 14028 requirement)</li>
<li><strong>Highest risk:</strong> Maximum residual risk score in your portfolio</li>
</ul>
</div>
</div>
<div class="vs-kpis">
<div class="vs-kpi">
<div class="vs-kpi__label">Vendors in view</div>
<div class="vs-kpi__value" id="kpiTotal">0</div>
<div class="vs-kpi__hint">Demo capped at <span id="kpiCap">8</span></div>
</div>
<div class="vs-kpi">
<div class="vs-kpi__label">Critical vendors</div>
<div class="vs-kpi__value" id="kpiCritical">0</div>
<div class="vs-kpi__hint">Top operational exposure</div>
</div>
<div class="vs-kpi">
<div class="vs-kpi__label">SBOM gaps</div>
<div class="vs-kpi__value" id="kpiSbomGaps">0</div>
<div class="vs-kpi__hint">Software vendors without SBOM</div>
</div>
<div class="vs-kpi">
<div class="vs-kpi__label">Highest risk</div>
<div class="vs-kpi__value" id="kpiMaxRisk">0</div>
<div class="vs-kpi__hint">Residual score (0â€“100)</div>
</div>
</div>
</div>
</div>
<div class="collapsible-section">
<div class="section-header" data-section="insights">
<div class="section-header-content">
<span class="section-title" style="display: inline-flex; align-items: center; gap: 8px;"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-lightbulb"><path d="M9 21h6"></path><path d="M12 3a6 6 0 0 0 6 6c0 4.314-2.343 5.9-4.265 7.113a1 1 0 0 1-.867.5c-.49 0-.924-.24-1.3-.614L12 14l-.568.999c-.376.374-.81.614-1.3.614a1 1 0 0 1-.867-.5C6.343 14.9 4 13.314 4 9a6 6 0 0 0 6-6Z"></path><path d="M8 21h8"></path></svg>Insights & Guidance</span>
<button class="section-help-btn" onclick="showGuidance('insights')" aria-label="Show guidance" title="Show guidance"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-info"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg></button>
</div>
<span class="section-chev">â–¾</span>
</div>
<div class="section-content">
<div class="section-guidance" id="guidance-insights" style="display: none;">
<div class="guidance-content">
<p><strong>Insights & Guidance:</strong> This section provides contextual information about regulatory requirements, best practices, and how to use the Vendor Risk Radar effectively.</p>
<ul>
<li><strong>EO 14028:</strong> Executive Order requires SBOMs for software vendors</li>
<li><strong>Quick Start:</strong> Learn what you can accomplish in minutes</li>
<li>Use filters and categories to focus on high-priority vendors</li>
<li>Export reports for compliance documentation</li>
</ul>
</div>
</div>
<div class="vs-hero__note" id="insights">
<div class="vs-note">
<div class="vs-note__title">EO 14028 signal</div>
<div class="vs-note__text">Vendors that provide software and cannot produce an SBOM are flagged and prioritized for procurement followâ€‘up. This demo shows signal detection; full SBOM ingestion &amp; component risk scoring is a Professional feature.</div>
</div>
<div class="vs-note">
<div class="vs-note__title">What you get in 3 minutes</div>
<div class="vs-note__text">Identify the vendors that can break execution, see the SBOM gaps, and export a defensible narrative for leadership (PDF locked in demo).</div>
</div>
</div>
</div>
<!-- Stage 2 CTA - Continue to Assessment -->
<div class="vs-hero__note" style="margin-top: 20px; border: 2px solid var(--vs-green); background: linear-gradient(135deg, var(--vs-green-pale) 0%, rgba(51,105,30,0.05) 100%); padding: 20px; border-radius: 12px;">
<div style="display: flex; flex-direction: column; gap: 12px;">
<div style="display: flex; align-items: center; gap: 8px;">
<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color: var(--vs-green); flex-shrink: 0;"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"></path><path d="m9 12 2 2 4-4"></path></svg>
<div>
<div style="font-weight: 700; font-size: 1.1rem; color: var(--vs-text); margin-bottom: 4px;">Ready for Stage 2: Understand Your Gaps</div>
<div style="font-size: 0.95rem; color: var(--vs-muted); line-height: 1.5;">Now that you've identified your high-risk vendors, define the security requirements they need to meet using NIST SP 800-161 aligned assessments.</div>
</div>
</div>
<a href="https://www.application.vendorsoluce.com/supply-chain-assessment" class="btn primary" style="margin-top: 8px; align-self: flex-start; display: inline-flex; align-items: center; gap: 8px; white-space: nowrap;">
<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"></path><path d="m12 5 7 7-7 7"></path></svg>
Continue to Stage 2: Define Requirements
</a>
</div>
</div>
</div>
</div>
</section>
<main class="vs-shell">
<div class="loading-overlay" id="loadingOverlay" style="display: none;">
<div class="loading-radar"></div>
<div class="loading-text">Scanning vendors...</div>
</div>
<div class="radar-container">
<!-- Toolbar -->
<div class="toolbar">
<div class="toolbar-group">
<button id="scanBtn" onclick="scanVendors()" title="Scan and analyze all vendors">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-radar"><path d="M19.07 4.93A10 10 0 0 0 6.99 3.34M4.93 19.07a10 10 0 0 1 1.65-12.08M15.34 6.99a10 10 0 0 1 2.73 12.08M2 12h20M12 2v20"></path><circle cx="12" cy="12" r="2"></circle></svg>
Scan Vendors
</button>
<button id="resetBtn" onclick="resetVendorData()" title="Reset to demo data" class="secondary">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg>
Reset
</button>
<button id="clearBtn" onclick="clearAllVendors()" title="Clear all vendors (cannot be undone)" class="secondary" style="color: var(--danger, #dc2626);">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2"><path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path><line x1="10" x2="10" y1="11" y2="17"></line><line x1="14" x2="14" y1="11" y2="17"></line></svg>
Clear
</button>
<button class="primary" onclick="openAddVendor()" title="Add a new vendor to the risk assessment">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg>
Add Vendor
</button>
<button type="button" class="secondary" onclick="const fileInput = document.getElementById('importFile'); if (fileInput) { fileInput.click(); }" title="Import vendors from CSV or Excel file">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-upload"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" x2="12" y1="3" y2="15"></line></svg>
Import CSV
</button>
<input accept=".csv,.xlsx,.xls" id="importFile" onchange="if (this.files && this.files.length > 0) { importVendors({ target: this }); }" type="file" style="display: none;"/>
</div>
<div class="toolbar-group">
<div class="filter-group">
<label for="categoryFilter" class="filter-label">
  Category
  <span class="filter-hint" title="Filter by business criticality: Critical (mission-essential), Strategic (high-value), Tactical (operational), Commodity (replaceable)">â„¹ï¸</span>
</label>
<select id="categoryFilter" onchange="updateRadar()" title="Filter vendors by business criticality category. Critical = mission-essential, Strategic = high-value, Tactical = operational, Commodity = easily replaceable" aria-label="Filter by vendor category">
<option value="all">All Categories</option>
<option value="critical">Critical Only (Mission-essential)</option>
<option value="strategic">Strategic+ (High-value & Critical)</option>
<option value="tactical">Tactical+ (Operational & above)</option>
</select>
</div>
<div class="filter-group">
<label for="riskFilter" class="filter-label">
  Risk Level
  <span class="filter-hint" title="Filter by residual risk score after controls">â„¹ï¸</span>
</label>
<select id="riskFilter" onchange="updateRadar()" title="Filter vendors by residual risk score after controls. Critical = 90-100, High = 70-89, Medium = 40-69, Low = 0-39" aria-label="Filter by risk level">
<option value="all">All Risk Levels</option>
<option value="critical">Critical Risk (90-100)</option>
<option value="high">High Risk+ (70+)</option>
<option value="medium">Medium Risk+ (40+)</option>
</select>
</div>
</div>
<div class="toolbar-group">
<button class="secondary" id="expandAllBtn" onclick="VSCollapse.expandAll()" title="Expand all dashboard sections">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevrons-down"><path d="m7 6 5 5 5-5"></path><path d="m7 13 5 5 5-5"></path></svg>
Expand
</button>
<button class="secondary" id="collapseAllBtn" onclick="VSCollapse.collapseAll()" title="Collapse all dashboard sections">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevrons-up"><path d="m17 18-5-5-5 5"></path><path d="m17 6-5-5-5 5"></path></svg>
Collapse
</button>
</div>
<div class="toolbar-group">
<button id="vsBtnTemplate" onclick="VSUI.downloadTemplate()" title="Download CSV template for vendor import" class="secondary">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-text"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"></path><path d="M14 2v4a2 2 0 0 0 2 2h4"></path><path d="M10 9H8"></path><path d="M16 13H8"></path><path d="M16 17H8"></path></svg>
Template
</button>
<button id="vsBtnCatalog" onclick="VSUI.open('vsCatalogBackdrop')" title="Browse pre-configured vendor catalog" class="secondary">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-open"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
Catalog
</button>
<button id="vsBtnWizard" onclick="VSUI.open('vsWizardBackdrop')" title="Use onboarding wizard to quickly add vendors" class="secondary">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sparkles"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path><path d="M5 3v4"></path><path d="M19 17v4"></path><path d="M3 5h4"></path><path d="M17 19h4"></path></svg>
Wizard
</button>
<button onclick="exportVendors()" title="Export vendor data to CSV file" class="secondary">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-download"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" x2="12" y1="15" y2="3"></line></svg>
Export
</button>
<button onclick="generateReport()" title="Generate comprehensive PDF risk assessment report" class="secondary">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-text"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"></path><path d="M14 2v4a2 2 0 0 0 2 2h4"></path><path d="M10 9H8"></path><path d="M16 13H8"></path><path d="M16 17H8"></path></svg>
Report
</button>
<a href="https://www.application.vendorsoluce.com/supply-chain-assessment" class="primary" title="Continue to Stage 2: Define security requirements using NIST SP 800-161 assessments" style="display: inline-flex; align-items: center; gap: 6px; white-space: nowrap; text-decoration: none;">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shield-check"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"></path><path d="m9 12 2 2 4-4"></path></svg>
Stage 2: Assessment
</a>
<button onclick="showHelpPanel()" title="Show help, tips, and keyboard shortcuts (Press ? or H)" class="secondary" id="helpBtn" style="position: relative;">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-help-circle"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><path d="M12 17h.01"></path></svg>
Help
<span class="help-shortcut-hint" style="position: absolute; top: -6px; right: -6px; background: var(--vs-green); color: white; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 700; box-shadow: 0 2px 4px rgba(0,0,0,.2);">?</span>
</button>
</div>
</div>
<!-- Alert Banner -->
<div class="alert-banner" id="alertBanner" style="display: none;">
<div class="alert-icon" id="alertIcon" style="display: flex; align-items: center; justify-content: center; width: 24px; height: 24px; flex-shrink: 0;"></div>
<div class="alert-content">
<div class="alert-title" id="alertTitle">RADAR ALERT</div>
<div class="alert-desc" id="alertDesc">Monitoring vendor landscape...</div>
</div>
</div>
<!-- Stats -->
<div class="collapsible-section">
<div class="section-header" data-section="stats">
<div class="section-header-content">
<span class="section-title" style="display: inline-flex; align-items: center; gap: 8px;"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bar-chart-3"><path d="M3 3v18h18"></path><path d="M18 7v11"></path><path d="M13 7v15"></path><path d="M8 12v6"></path></svg>Quick Stats Overview</span>
<button class="section-help-btn" onclick="showGuidance('stats')" aria-label="Show guidance" title="Show guidance"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-info"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg></button>
</div>
<span class="section-chev">â–¾</span>
</div>
<div class="section-content">
<div class="section-guidance" id="guidance-stats" style="display: none;">
<div class="guidance-content">
<p><strong>Quick Stats Overview:</strong> This section provides at-a-glance metrics about your vendor portfolio. Use these numbers to quickly assess overall risk exposure and identify areas requiring immediate attention.</p>
<ul>
<li><strong>Total Vendors:</strong> Complete count of vendors in your system</li>
<li><strong>Critical Category:</strong> Vendors classified as mission-essential</li>
<li><strong>Critical Risk:</strong> Vendors with risk scores â‰¥90</li>
<li><strong>High Risk:</strong> Vendors with risk scores 70-89</li>
<li><strong>With PII/PHI:</strong> Vendors handling sensitive personal data</li>
<li><strong>Avg Inherent Risk:</strong> Average risk score across all vendors</li>
</ul>
</div>
</div>
<div class="stats-grid">
<div class="stat-card">
<div class="stat-label">Total Vendors</div>
<div class="stat-value" id="totalVendors">--</div>
</div>
<div class="stat-card">
<div class="stat-label">Critical Category</div>
<div class="stat-value critical" id="criticalCategoryCount">--</div>
</div>
<div class="stat-card">
<div class="stat-label">Critical Risk</div>
<div class="stat-value critical" id="criticalRiskCount">--</div>
</div>
<div class="stat-card">
<div class="stat-label">High Risk</div>
<div class="stat-value warning" id="highRiskCount">--</div>
</div>
<div class="stat-card">
<div class="stat-label">With PII/PHI</div>
<div class="stat-value warning" id="sensitiveDataCount">--</div>
</div>
<div class="stat-card">
<div class="stat-label">Avg Inherent Risk</div>
<div class="stat-value" id="avgInherentRisk">--</div>
</div>
</div>
</div>
</div>
<!-- Main Radar and Category Distribution -->
<div class="radar-grid">
<div class="radar-display">
<div class="panel-title">VENDOR RISK SCAN</div>
<div class="vs-dashboard"><div class="vs-dashboard__header"><div class="vs-dashboard__title">Dashboard</div><div class="vs-dashboard__subtitle">Interactive vendor prioritization, SBOM signals, and risk analytics (demo mode)</div></div><div class="radar-screen" id="radarScreen">
<div class="radar-grid-lines">
<div class="radar-circle"></div>
<div class="radar-circle"></div>
<div class="radar-circle"></div>
<div class="radar-circle"></div>
<div class="radar-line"></div>
<div class="radar-line"></div>
<div class="radar-line"></div>
<div class="radar-line"></div>
</div>
<div class="radar-sweep"></div>
</div></div>
<div class="radar-legend">
<div class="legend-item">
<div class="legend-dot" style="background: #ff0000;"></div>
<span>CRITICAL (90-100)</span>
</div>
<div class="legend-item">
<div class="legend-dot" style="background: #ff6600;"></div>
<span>HIGH (70-89)</span>
</div>
<div class="legend-item">
<div class="legend-dot" style="background: #ffaa00;"></div>
<span>MEDIUM (40-69)</span>
</div>
<div class="legend-item">
<div class="legend-dot" style="background: #00ff41;"></div>
<span>LOW (0-39)</span>
</div>
</div>
</div>
<div class="radar-panel">
<div class="panel-title">
<span style="display: inline-flex; align-items: center; gap: 8px;"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tags"><path d="m15 5 6.3 6.3a2.4 2.4 0 0 1 0 3.4L17 19.7a2.4 2.4 0 0 1-3.4 0L4 10"></path><circle cx="8.5" cy="8.5" r="1.5" fill="currentColor"></circle></svg>VENDOR CATEGORIZATION</span>
<button class="panel-help-btn" onclick="showGuidance('categorization')" aria-label="Show guidance" title="Show guidance"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-info"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg></button>
</div>
<div class="panel-guidance" id="guidance-categorization" style="display: none;">
<div class="guidance-content">
<p><strong>Vendor Categorization:</strong> Vendors are classified by business criticality. This chart shows the distribution across categories, helping you understand where to focus risk management resources.</p>
</div>
</div>
<canvas id="categoryChart"></canvas>
<div style="margin-top: 20px; font-size: 0.85em; opacity: 0.8;">
<div style="margin-bottom: 5px;">ðŸ”´ <strong>Critical:</strong> Mission-essential, single point of failure</div>
<div style="margin-bottom: 5px;">ðŸŸ  <strong>Strategic:</strong> High-value, significant impact</div>
<div style="margin-bottom: 5px;">ðŸ”µ <strong>Tactical:</strong> Operational support, moderate impact</div>
<div style="margin-bottom: 5px;">âšª <strong>Commodity:</strong> Easily replaceable, low impact</div>
</div>
</div>
</div>
<!-- Vendor Lists -->
<div class="radar-grid">
<div class="radar-panel">
<div class="panel-title">
<span style="display: inline-flex; align-items: center; gap: 8px;"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-alert-triangle"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><path d="M12 9v4"></path><path d="M12 17h.01"></path></svg>HIGH RISK VENDORS</span>
<button class="panel-help-btn" onclick="showGuidance('high-risk')" aria-label="Show guidance" title="Show guidance"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-info"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg></button>
</div>
<div class="panel-guidance" id="guidance-high-risk" style="display: none;">
<div class="guidance-content">
<p><strong>High Risk Vendors:</strong> Vendors with risk scores â‰¥70. These require immediate attention and may need additional controls or remediation plans. Click any vendor to view detailed risk analysis.</p>
</div>
</div>
<div class="vendor-list" id="highRiskList"></div>
</div>
<div class="radar-panel">
<div class="panel-title">
<span style="display: inline-flex; align-items: center; gap: 8px;"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-target"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>CRITICAL CATEGORY VENDORS</span>
<button class="panel-help-btn" onclick="showGuidance('critical-category')" aria-label="Show guidance" title="Show guidance"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-info"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg></button>
</div>
<div class="panel-guidance" id="guidance-critical-category" style="display: none;">
<div class="guidance-content">
<p><strong>Critical Category Vendors:</strong> Mission-essential vendors that are single points of failure. These vendors have the highest business impact and require comprehensive risk management strategies.</p>
</div>
</div>
<div class="vendor-list" id="criticalCategoryList"></div>
</div>
</div>
<!-- Data & Risk Analysis -->
<div class="radar-grid">
<div class="radar-panel">
<div class="panel-title">
<span style="display: inline-flex; align-items: center; gap: 8px;"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-lock"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>DATA IN SCOPE ANALYSIS</span>
<button class="panel-help-btn" onclick="showGuidance('data-analysis')" aria-label="Show guidance" title="Show guidance"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-info"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg></button>
</div>
<div class="panel-guidance" id="guidance-data-analysis" style="display: none;">
<div class="guidance-content">
<p><strong>Data In Scope Analysis:</strong> Shows the types of sensitive data handled by your vendors. Understanding data exposure helps prioritize compliance efforts and assess breach impact.</p>
</div>
</div>
<canvas id="dataChart"></canvas>
</div>
<div class="radar-panel">
<div class="panel-title">
<span style="display: inline-flex; align-items: center; gap: 8px;"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-zap"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>INHERENT RISK DISTRIBUTION</span>
<button class="panel-help-btn" onclick="showGuidance('inherent-risk')" aria-label="Show guidance" title="Show guidance"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-info"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg></button>
</div>
<div class="panel-guidance" id="guidance-inherent-risk" style="display: none;">
<div class="guidance-content">
<p><strong>Inherent Risk Distribution:</strong> Shows the distribution of risk scores before controls. This helps identify vendors that may need additional security controls or monitoring.</p>
</div>
</div>
<canvas id="inherentRiskChart"></canvas>
</div>
</div>
<!-- Additional Charts -->
<div class="radar-grid">
<div class="radar-panel">
<div class="panel-title">
<span style="display: inline-flex; align-items: center; gap: 8px;"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-building"><rect width="16" height="20" x="4" y="2" rx="2" ry="2"></rect><path d="M9 22v-4h6v4"></path><path d="M8 6h.01"></path><path d="M16 6h.01"></path><path d="M12 6h.01"></path><path d="M12 10h.01"></path><path d="M12 14h.01"></path><path d="M16 10h.01"></path><path d="M16 14h.01"></path><path d="M8 10h.01"></path><path d="M8 14h.01"></path></svg>VENDOR SECTORS</span>
<button class="panel-help-btn" onclick="showGuidance('sectors')" aria-label="Show guidance" title="Show guidance"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-info"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg></button>
</div>
<div class="panel-guidance" id="guidance-sectors" style="display: none;">
<div class="guidance-content">
<p><strong>Vendor Sectors:</strong> Breakdown of vendors by industry sector. This helps identify concentration risks and sector-specific compliance requirements.</p>
</div>
</div>
<canvas id="sectorChart"></canvas>
</div>
<div class="radar-panel">
<div class="panel-title">
<span style="display: inline-flex; align-items: center; gap: 8px;"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-globe"><circle cx="12" cy="12" r="10"></circle><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"></path><path d="M2 12h20"></path></svg>GEOGRAPHIC DISTRIBUTION</span>
<button class="panel-help-btn" onclick="showGuidance('geographic')" aria-label="Show guidance" title="Show guidance"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-info"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg></button>
</div>
<div class="panel-guidance" id="guidance-geographic" style="display: none;">
<div class="guidance-content">
<p><strong>Geographic Distribution:</strong> Shows where your vendors are located. This is important for understanding data residency requirements, regulatory jurisdiction, and geopolitical risks.</p>
</div>
</div>
<canvas id="geoChart"></canvas>
</div>
</div>
</div>
</div>
<script>
        // Vendor categorization framework
        const VENDOR_CATEGORIES = {
            critical: {
                name: 'Critical',
                description: 'Mission-essential, single point of failure',
                inherentRiskMultiplier: 1.5,
                color: '#ff0000'
            },
            strategic: {
                name: 'Strategic',
                description: 'High-value, significant impact',
                inherentRiskMultiplier: 1.3,
                color: '#ffa500'
            },
            tactical: {
                name: 'Tactical',
                description: 'Operational support, moderate impact',
                inherentRiskMultiplier: 1.1,
                color: '#0096ff'
            },
            commodity: {
                name: 'Commodity',
                description: 'Easily replaceable, low impact',
                inherentRiskMultiplier: 0.9,
                color: '#999999'
            }
        };

        // --- VendorSoluce Demo Configuration ---
        const DEMO_MODE = {
            enabled: true,
            maxVendors: 25,  // Updated to match user journey spec
            pdfEnabled: false
        };

        // Helper function to safely get element or log error
        function safeGetElement(id, context = '') {
            const el = document.getElementById(id);
            if (!el) {
                console.error(`Element not found: ${id}${context ? ' in ' + context : ''}`);
            }
            return el;
        }

        function openUpgrade(reason) {
            const modal = safeGetElement('upgradeModal', 'openUpgrade');
            const backdrop = safeGetElement('upgradeBackdrop', 'openUpgrade');
            const closeBtn = safeGetElement('upgradeCloseBtn', 'openUpgrade');
            const reasonEl = safeGetElement('upgradeReason', 'openUpgrade');
            
            if (!modal || !backdrop || !closeBtn || !reasonEl) {
                console.error('Cannot open upgrade modal: required elements missing');
                return;
            }
            
            reasonEl.textContent = reason || 'This action is locked in Demo Mode.';
            modal.setAttribute('aria-hidden', 'false');

            const close = () => modal.setAttribute('aria-hidden', 'true');
            backdrop.onclick = close;
            closeBtn.onclick = close;
            document.addEventListener('keydown', function esc(e){
                if(e.key === 'Escape'){ close(); document.removeEventListener('keydown', esc); }
            });
        }

        // Platform status management
        let platformStatus = 'operational';
        const statusOptions = ['operational', 'scanning', 'maintenance', 'error'];
        const statusMessages = {
            'operational': 'Operational',
            'scanning': 'Scanning...',
            'maintenance': 'Maintenance',
            'error': 'Error'
        };

        function updatePlatformStatus(newStatus) {
            if (!statusOptions.includes(newStatus)) return;
            platformStatus = newStatus;
            const statusEl = document.getElementById('platformStatus');
            if (statusEl) {
                statusEl.textContent = statusMessages[newStatus];
                statusEl.className = `vs-metaCard__value status-${newStatus}`;
            }
        }

        function togglePlatformStatus() {
            // Cycle through statuses for demo purposes
            const currentIndex = statusOptions.indexOf(platformStatus);
            const nextIndex = (currentIndex + 1) % statusOptions.length;
            updatePlatformStatus(statusOptions[nextIndex]);
            
            // Auto-return to operational after 2 seconds
            setTimeout(() => {
                if (platformStatus !== 'operational') {
                    updatePlatformStatus('operational');
                }
            }, 2000);
        }

        // Initialize platform status on load
        function initializePlatformStatus() {
            updatePlatformStatus('operational');
            
            // Update status during scan
            const originalScanVendors = window.scanVendors;
            if (originalScanVendors) {
                window.scanVendors = async function() {
                    updatePlatformStatus('scanning');
                    try {
                        await originalScanVendors();
                        updatePlatformStatus('operational');
                    } catch (error) {
                        updatePlatformStatus('error');
                        setTimeout(() => updatePlatformStatus('operational'), 3000);
                    }
                };
            }
        }

        function openDrawer(vendor) {
            const drawer = safeGetElement('vendorDrawer', 'openDrawer');
            const backdrop = safeGetElement('drawerBackdrop', 'openDrawer');
            const closeBtn = safeGetElement('drawerCloseBtn', 'openDrawer');
            const secondaryBtn = safeGetElement('drawerSecondaryBtn', 'openDrawer');

            if (!drawer || !backdrop || !closeBtn || !secondaryBtn) {
                console.error('Cannot open drawer: required elements missing');
                return;
            }

            // Header
            const drawerTitle = safeGetElement('drawerTitle', 'openDrawer');
            if (drawerTitle) drawerTitle.textContent = vendor.name || 'Vendor';
            
            const drawerSubtitle = safeGetElement('drawerSubtitle', 'openDrawer');
            if (drawerSubtitle) drawerSubtitle.textContent = `${(VENDOR_CATEGORIES[vendor.category]||{}).name || vendor.category || 'â€”'} â€¢ ${vendor.sector || 'â€”'}`;

            // KPIs
            const drawerRiskLevel = safeGetElement('drawerRiskLevel', 'openDrawer');
            if (drawerRiskLevel) drawerRiskLevel.textContent = vendor.riskLevel || 'â€”';
            
            const drawerScores = safeGetElement('drawerScores', 'openDrawer');
            if (drawerScores) drawerScores.textContent = `${Math.round(vendor.inherentRisk || 0)} / ${Math.round(vendor.residualRisk || 0)}`;
            
            const drawerCriticality = safeGetElement('drawerCriticality', 'openDrawer');
            if (drawerCriticality) drawerCriticality.textContent = (VENDOR_CATEGORIES[vendor.category]||{}).name || vendor.category || 'â€”';

            // Rationale
            const rationale = safeGetElement('drawerRationale', 'openDrawer');
            if (rationale) {
                rationale.innerHTML = '';
                const reasons = buildRationale(vendor);
                reasons.forEach(r => {
                    const li = document.createElement('li');
                    li.textContent = r;
                    rationale.appendChild(li);
                });
            }

            // Data types
            const chips = safeGetElement('drawerDataTypes', 'openDrawer');
            if (chips) {
                chips.innerHTML = '';
                (vendor.dataTypes || []).forEach(dt => {
                    const span = document.createElement('span');
                    span.className = 'vs-chip';
                    span.textContent = dt;
                    chips.appendChild(span);
                });
            }

            // SBOM
            const sp = vendor.sbomProfile || {};
            const drawerProvidesSoftware = safeGetElement('drawerProvidesSoftware', 'openDrawer');
            if (drawerProvidesSoftware) drawerProvidesSoftware.textContent = sp.providesSoftware ? 'Yes' : 'No';
            
            const drawerSbomAvailable = safeGetElement('drawerSbomAvailable', 'openDrawer');
            if (drawerSbomAvailable) drawerSbomAvailable.textContent = sp.sbomAvailable ? 'Yes' : 'No';
            
            const drawerSbomFormat = safeGetElement('drawerSbomFormat', 'openDrawer');
            if (drawerSbomFormat) drawerSbomFormat.textContent = sp.sbomFormat || 'none';
            
            const drawerOssExposure = safeGetElement('drawerOssExposure', 'openDrawer');
            if (drawerOssExposure) drawerOssExposure.textContent = sp.openSourceExposure || 'unknown';

            // Actions
            const actions = safeGetElement('drawerActions', 'openDrawer');
            if (actions) {
                actions.innerHTML = '';
                buildNextActions(vendor).forEach(a => {
                    const li = document.createElement('li');
                    li.textContent = a;
                    actions.appendChild(li);
                });
            }

            // CTA
            const drawerCtaBtn = safeGetElement('drawerCtaBtn', 'openDrawer');
            if (drawerCtaBtn) {
                drawerCtaBtn.onclick = () => openUpgrade('Request Full Access to unlock exports, unlimited vendors, and full SBOM ingestion.');
            }

            const close = () => { drawer.setAttribute('aria-hidden', 'true'); };
            drawer.setAttribute('aria-hidden', 'false');
            backdrop.onclick = close;
            closeBtn.onclick = close;
            secondaryBtn.onclick = close;
            document.addEventListener('keydown', function esc(e){
                if(e.key === 'Escape'){ close(); document.removeEventListener('keydown', esc); }
            });
        }

        function buildRationale(v) {
            const out = [];
            if ((v.residualRisk || 0) >= 80) out.push('High residual risk with limited mitigation signals.');
            if ((v.inherentRisk || 0) >= 85) out.push('High inherent exposure based on access and dependency.');
            if (v.dataTypes && v.dataTypes.includes('PII')) out.push('Handles PII â€” privacy and breach impact escalates.');
            if (v.dataTypes && v.dataTypes.includes('PHI')) out.push('Handles PHI â€” regulated exposure requires stronger assurance.');
            if (v.category === 'critical') out.push('Critical dependency â€” failure can disrupt core operations.');
            const sp = v.sbomProfile || {};
            if (sp.providesSoftware && !sp.sbomAvailable) out.push('Provides software but does not provide an SBOM (EO 14028 posture gap).');
            if (sp.providesSoftware && sp.sbomAvailable) out.push('Provides software and signals SBOM availability â€” improved supply-chain defensibility.');
            return out.length ? out : ['No specific drivers detected. Add vendor details to strengthen the signal.'];
        }

        function buildNextActions(v) {
            const actions = [];
            const sp = v.sbomProfile || {};
            if (v.category === 'critical') actions.push('Confirm exit plan / redundancy options for this dependency.');
            if (v.dataTypes && (v.dataTypes.includes('PII') || v.dataTypes.includes('PHI'))) actions.push('Validate privacy controls, DPA clauses, and breach notification obligations.');
            if (sp.providesSoftware && !sp.sbomAvailable) actions.push('Request SBOM (SPDX/CycloneDX) and document procurement followâ€‘up.');
            if ((v.residualRisk || 0) >= 80) actions.push('Initiate targeted due diligence and timeâ€‘bound remediation plan.');
            actions.push('Assign an owner and set next review date.');
            return actions;
        }

        function updateKpis(vendors) {
            const total = vendors.length;
            const critical = vendors.filter(v => v.category === 'critical').length;
            const sbomGaps = vendors.filter(v => (v.sbomProfile||{}).providesSoftware && !(v.sbomProfile||{}).sbomAvailable).length;
            const maxRisk = vendors.reduce((m,v) => Math.max(m, Math.round(v.residualRisk||0)), 0);

            const set = (id, val) => { const el=document.getElementById(id); if(el) el.textContent = String(val); };
            set('kpiTotal', total);
            set('kpiCritical', critical);
            set('kpiSbomGaps', sbomGaps);
            set('kpiMaxRisk', maxRisk);
            set('kpiCap', DEMO_MODE.maxVendors);
        }



        // Data classification risk weights
        const DATA_RISK_WEIGHTS = {
            'PII': 15,
            'PHI': 20,
            'Financial': 18,
            'IP': 16,
            'Confidential': 12,
            'Public': 0
        };

        let vendorData = [];
        let charts = {};
        let currentCategoryFilter = 'all';
        let currentRiskFilter = 'all';
        let editingVendorId = null;
        let currentMode = 'demo'; // Will be set by initializeApp()

        // Load vendor data from Excel file for demo
        async function loadVendorDataFromExcelFile() {
            try {
                if (!window.XLSX) {
                    console.warn('XLSX library not available');
                    return null;
                }
                
                const response = await fetch('vendorsoluce-import-template-populated.xlsx');
                if (!response.ok) {
                    throw new Error('Failed to load Excel file');
                }
                
                const arrayBuffer = await response.arrayBuffer();
                const data = new Uint8Array(arrayBuffer);
                const wb = XLSX.read(data, { type: 'array' });
                
                if (!wb.SheetNames || wb.SheetNames.length === 0) {
                    throw new Error('Excel file has no sheets');
                }
                
                const sheetName = wb.SheetNames[0];
                const ws = wb.Sheets[sheetName];
                const json = XLSX.utils.sheet_to_json(ws, { defval: '' });
                
                if (!json || json.length === 0) {
                    throw new Error('Excel file is empty or invalid');
                }
                
                const vendors = json.map(obj => {
                    const row = {};
                    Object.keys(obj).forEach(k => row[normalizeHeader(k)] = obj[k]);
                    const vendor = mapRowToVendor(row);
                    if (vendor.name) {
                        return {
                            id: generateId(),
                            ...vendor
                        };
                    }
                    return null;
                }).filter(v => v !== null);
                
                return vendors.length > 0 ? vendors : null;
            } catch (error) {
                console.warn('Failed to load vendor data from Excel:', error);
                return null;
            }
        }

        // Load vendor data from CSV/Excel file for demo
        async function loadVendorDataFromFile() {
            // Try populated Excel file first (if XLSX library is available)
            if (window.XLSX) {
                try {
                    const excelResponse = await fetch('vendorsoluce-import-template-populated.xlsx');
                    if (excelResponse.ok) {
                        const arrayBuffer = await excelResponse.arrayBuffer();
                        const data = new Uint8Array(arrayBuffer);
                        const wb = XLSX.read(data, { type: 'array' });
                        
                        if (wb.SheetNames && wb.SheetNames.length > 0) {
                            const ws = wb.Sheets[wb.SheetNames[0]];
                            const json = XLSX.utils.sheet_to_json(ws, { defval: '' });
                            
                            if (json && json.length > 0) {
                                const vendors = json.map((obj, index) => {
                                    try {
                                        const row = {};
                                        Object.keys(obj).forEach(k => {
                                            const normalizedKey = normalizeHeader(k);
                                            row[normalizedKey] = obj[k];
                                        });
                                        const vendor = mapRowToVendor(row);
                                        if (vendor && vendor.name) {
                                            return {
                                                id: generateId(),
                                                ...vendor
                                            };
                                        }
                                        return null;
                                    } catch (err) {
                                        console.warn(`Error processing Excel row ${index + 1}:`, err);
                                        return null;
                                    }
                                }).filter(v => v !== null);
                                
                                if (vendors.length > 0) {
                                    console.log(`Loaded ${vendors.length} vendors from populated Excel file`);
                                    return vendors;
                                }
                            }
                        }
                    }
                } catch (error) {
                    console.warn('Failed to load populated Excel file, trying CSV:', error);
                }
            }
            
            // Try populated CSV file
            try {
                const csvResponse = await fetch('vendorsoluce-import-template-populated.xlsx');
                if (!csvResponse.ok) {
                    throw new Error('Populated file not found');
                }
                // If it's actually an Excel file, skip CSV parsing
                const contentType = csvResponse.headers.get('content-type');
                if (contentType && contentType.includes('spreadsheet')) {
                    throw new Error('File is Excel format, not CSV');
                }
            } catch (e) {
                // Fall through to try regular CSV template
            }
            
            // Fallback to regular CSV template
            try {
                const response = await fetch('vendorsoluce-import-template.csv');
                if (!response.ok) {
                    throw new Error('Failed to load CSV file');
                }
                const csvText = await response.text();
                const lines = csvText.split(/\r?\n/).filter(line => line.trim());
                if (lines.length < 2) {
                    throw new Error('CSV file is empty or invalid');
                }
                
                // Parse CSV headers
                const headers = lines[0].split(',').map(h => normalizeHeader(h.trim()));
                const vendors = [];
                
                // Parse CSV rows
                for (let i = 1; i < lines.length; i++) {
                    const values = parseCSVLine(lines[i]);
                    if (values.length === 0 || !values[0]) continue;
                    
                    const row = {};
                    headers.forEach((h, idx) => {
                        let val = (values[idx] ?? '').trim();
                        if (val.startsWith('"') && val.endsWith('"')) {
                            val = val.slice(1, -1).replace(/""/g, '"');
                        }
                        row[h] = val;
                    });
                    
                    const vendor = mapRowToVendor(row);
                    if (vendor && vendor.name) {
                        vendors.push({
                            id: generateId(),
                            ...vendor
                        });
                    }
                }
                
                if (vendors.length > 0) {
                    console.log(`Loaded ${vendors.length} vendors from CSV file`);
                    return vendors;
                }
            } catch (error) {
                console.warn('Failed to load vendor data from CSV:', error);
            }
            
            return null;
        }

        // Helper function to parse CSV line with proper quote handling
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                const nextChar = line[i + 1];
                
                if (char === '"') {
                    if (inQuotes && nextChar === '"') {
                        current += '"';
                        i++;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim());
            return result;
        }

        // Initialize with sample data
        // Priority: CSV file > Enhanced catalog > Hardcoded fallback
        async function initializeSampleVendors() {
            // Try to load from CSV file first
            const csvVendors = await loadVendorDataFromFile();
            if (csvVendors && csvVendors.length > 0) {
                return csvVendors;
            }
            
            // Try to use enhanced catalog starter set if available
            if (typeof getStarterVendorSet === 'function') {
                try {
                    const starterSet = getStarterVendorSet();
                    if (starterSet && starterSet.length > 0) {
                        // Convert enhanced catalog format to vendor record format
                        return starterSet.map(v => ({
                            id: v.id || generateId(),
                            name: v.name,
                            category: v.category || 'tactical',
                            dataTypes: v.dataTypes || ['Confidential'],
                            sector: v.sector || 'Other',
                            location: v.location || 'Unknown',
                            contact: v.contact || '',
                            notes: v.notes || '',
                            sbomProfile: v.sbom || {
                                providesSoftware: v.providesSoftware || false,
                                sbomAvailable: v.sbomAvailable || false,
                                sbomFormat: v.sbomFormat || 'none'
                            }
                        }));
                    }
                } catch (e) {
                    console.warn('Failed to load enhanced catalog starter set:', e);
                }
            }
            
            // Fallback to hardcoded sample data
            return [
                {
                    id: generateId(),
                    name: 'AWS',
                    category: 'critical',
                    dataTypes: ['PII', 'Financial', 'Confidential'],
                    sector: 'Cloud Services',
                    location: 'United States',
                    contact: 'security@aws.amazon.com',
                    notes: 'Primary cloud infrastructure provider'
                },
                {
                    id: generateId(),
                    name: 'Microsoft 365',
                    category: 'critical',
                    dataTypes: ['PII', 'Confidential', 'IP'],
                    sector: 'SaaS',
                    location: 'United States',
                    contact: 'security@microsoft.com',
                    notes: 'Email and productivity suite'
                },
                {
                    id: generateId(),
                    name: 'Salesforce',
                    category: 'strategic',
                    dataTypes: ['PII', 'Financial'],
                    sector: 'SaaS',
                    location: 'United States',
                    contact: 'security@salesforce.com',
                    notes: 'CRM platform'
                },
                {
                    id: generateId(),
                    name: 'Okta',
                    category: 'strategic',
                    dataTypes: ['PII'],
                    sector: 'Security',
                    location: 'United States',
                    contact: 'security@okta.com',
                    notes: 'Identity and access management'
                },
                {
                    id: generateId(),
                    name: 'Zoom',
                    category: 'tactical',
                    dataTypes: ['PII'],
                    sector: 'Collaboration',
                    location: 'United States',
                    contact: 'security@zoom.us',
                    notes: 'Video conferencing'
                },
                {
                    id: generateId(),
                    name: 'Slack',
                    category: 'tactical',
                    dataTypes: ['Confidential'],
                    sector: 'Collaboration',
                    location: 'United States',
                    contact: 'security@slack.com',
                    notes: 'Team messaging'
                },
                {
                    id: generateId(),
                    name: 'DocuSign',
                    category: 'tactical',
                    dataTypes: ['PII', 'Financial'],
                    sector: 'SaaS',
                    location: 'United States',
                    contact: 'security@docusign.com',
                    notes: 'Digital signature platform'
                },
                {
                    id: generateId(),
                    name: 'Office Supplies Co',
                    category: 'commodity',
                    dataTypes: ['Public'],
                    sector: 'Other',
                    location: 'United States',
                    contact: 'sales@officesupplies.com',
                    notes: 'Office supply vendor'
                }
            ];
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Helper function to save vendor data based on current mode
        function saveVendorData() {
            const mode = (typeof detectMode === 'function') ? detectMode() : 'demo';
            const config = (typeof MODE_CONFIG !== 'undefined' && MODE_CONFIG[mode]) 
                ? MODE_CONFIG[mode] 
                : { dataSource: 'catalog', persistence: 'session', maxVendors: 25 };
            const storageKey = config.dataSource === 'catalog' 
                ? 'vendorsoluce_demo_data' 
                : 'vendorsoluce_user_data';
            const storage = config.persistence === 'session' ? sessionStorage : localStorage;
            
            // Enforce vendor limit
            if (config.maxVendors !== Infinity && vendorData.length > config.maxVendors) {
                vendorData = vendorData.slice(0, config.maxVendors);
            }
            
            storage.setItem(storageKey, JSON.stringify(vendorData));
            
            // Professional mode: also sync to backend
            if (mode === 'professional' && typeof syncToBackend === 'function') {
                syncToBackend(vendorData);
            }
        }

        async function scanVendors() {
            const btn = safeGetElement('scanBtn', 'scanVendors');
            const loadingOverlay = safeGetElement('loadingOverlay', 'scanVendors');
            
            if (!btn || !loadingOverlay) {
                console.error('Cannot scan: required UI elements missing');
                return;
            }
            
            // Update status to scanning
            if (typeof updatePlatformStatus === 'function') {
                updatePlatformStatus('scanning');
            }
            
            btn.disabled = true;
            btn.textContent = 'â³ SCANNING...';
            
            loadingOverlay.style.display = 'flex';
            
            try {
                // Use mode detection from strategy file
                if (typeof detectMode === 'function') {
                    currentMode = detectMode();
                } else {
                    currentMode = 'demo'; // fallback
                }
                
                const config = (typeof MODE_CONFIG !== 'undefined' && MODE_CONFIG[currentMode]) 
                    ? MODE_CONFIG[currentMode] 
                    : { name: 'Demo', maxVendors: 8, dataSource: 'catalog', persistence: 'session' };
                
                const storageKey = config.dataSource === 'catalog' 
                    ? 'vendorsoluce_demo_data' 
                    : 'vendorsoluce_user_data';
                
                const storage = config.persistence === 'session' ? sessionStorage : localStorage;
                const saved = storage.getItem(storageKey);
                
                if (!saved || JSON.parse(saved).length === 0) {
                    // Use catalog starter set instead of hardcoded
                    if (config.dataSource === 'catalog') {
                        // Demo mode: try CSV file first, then catalog, then hardcoded fallback
                        try {
                            const sampleVendors = await initializeSampleVendors();
                            if (sampleVendors && sampleVendors.length > 0) {
                                vendorData = sampleVendors.slice(0, config.maxVendors);
                            } else {
                                // Fallback to enhanced catalog if available
                                if (typeof getStarterVendorSet === 'function') {
                                    try {
                                        const starter = getStarterVendorSet();
                                        if (starter && starter.length > 0) {
                                            vendorData = starter.slice(0, config.maxVendors).map(v => {
                                                return {
                                                    id: v.id || generateId(),
                                                    name: v.name,
                                                    category: v.category || 'tactical',
                                                    dataTypes: v.dataTypes || ['Confidential'],
                                                    sector: v.sector || 'Other',
                                                    location: v.location || 'Unknown',
                                                    contact: v.contact || '',
                                                    notes: v.notes || '',
                                                    sbomProfile: v.sbom || {
                                                        providesSoftware: v.providesSoftware || false,
                                                        sbomAvailable: v.sbomAvailable || false,
                                                        sbomFormat: v.sbomFormat || 'none'
                                                    }
                                                };
                                            });
                                        }
                                    } catch (e) {
                                        console.warn('Error loading starter set:', e);
                                    }
                                }
                            }
                        } catch (e) {
                            console.warn('Error loading sample vendors:', e);
                        }
                    } else {
                        // Trial/Professional: empty or show onboarding
                        vendorData = [];
                        if (currentMode === 'trial' && typeof getTrialData === 'function' && !getTrialData()) {
                            // First time in trial - show onboarding
                            setTimeout(() => {
                                if (typeof showDataOnboarding === 'function') {
                                    showDataOnboarding();
                                }
                            }, 500);
                        }
                    }
                    if (vendorData.length > 0) {
                        storage.setItem(storageKey, JSON.stringify(vendorData));
                    }
                } else {
                    try {
                        vendorData = JSON.parse(saved);
                        if (!Array.isArray(vendorData)) {
                            vendorData = [];
                        }
                    } catch (e) {
                        console.error('Error parsing saved data:', e);
                        vendorData = initializeSampleVendors();
                        storage.setItem(storageKey, JSON.stringify(vendorData));
                    }
                }
                
                // Calculate risk scores
                vendorData = vendorData.map(vendor => ({
                    ...vendor,
                    ...calculateVendorRisk(vendor)
                }));
                
                // Enforce mode limits
                if (config.maxVendors !== Infinity && vendorData.length > config.maxVendors) {
                    vendorData = vendorData.slice(0, config.maxVendors);
                    storage.setItem(storageKey, JSON.stringify(vendorData));
                }
                
                updateAllDisplays();
                
                // Update UI for mode
                if (typeof updateUIForMode === 'function') {
                    updateUIForMode(config);
                }
                
                const now = new Date();
                const timestampEl = document.getElementById('timestamp');
                if (timestampEl) {
                    timestampEl.textContent = `LAST SCAN: ${now.toLocaleString()} â€¢ ${config.name.toUpperCase()}`;
                }
                
                // Update platform status to operational after successful scan
                if (typeof updatePlatformStatus === 'function') {
                    updatePlatformStatus('operational');
                }
            } catch (error) {
                // Error handled silently
                // Update platform status to error on failure
                if (typeof updatePlatformStatus === 'function') {
                    updatePlatformStatus('error');
                    setTimeout(() => updatePlatformStatus('operational'), 3000);
                }
            } finally {
                if (loadingOverlay) {
                    loadingOverlay.style.display = 'none';
                }
                if (btn) {
                    btn.disabled = false;
                    btn.textContent = 'Scan Vendors';
                }
            }
        }
        
        // Make scanVendors globally accessible
        window.scanVendors = scanVendors;

        
function hashStringToRange(str, min, max){
            let h = 2166136261;
            for (let i = 0; i < str.length; i++){
                h ^= str.charCodeAt(i);
                h = Math.imul(h, 16777619);
            }
            const n = (h >>> 0) / 4294967295; // 0..1
            return min + n * (max - min);
        }

        function detectSBOMProfile(vendor){
            const hay = [
                vendor.name, vendor.sector, vendor.category,
                (vendor.notes||''), (vendor.contact||''),
                ...(vendor.dataTypes||[])
            ].join(' ').toLowerCase();

            const providesSoftware =
                /(saas|software|app|api|platform|cloud|it service|managed service|msps?|mssp|devops|hosting|cdn|repository|package|library|sdk)/i.test(hay) ||
                ['technology','software','it','cloud'].includes((vendor.sector||'').toLowerCase());

            const mentionsSBOM = /(sbom|spdx|cyclonedx)/i.test(hay);
            const format = /spdx/i.test(hay) ? 'SPDX' : (/cyclonedx/i.test(hay) ? 'CycloneDX' : 'none');

            // If the vendor is software-ish but SBOM isn't explicitly present, assume "not provided" in demo mode.
            const sbomAvailable = mentionsSBOM;

            return {
                providesSoftware,
                sbomAvailable,
                sbomFormat: sbomAvailable ? format : 'none'
            };
        }

        function calculateVendorRisk(vendor) {
            const sbom = vendor.sbomProfile ? vendor.sbomProfile : detectSBOMProfile(vendor);
            vendor.sbomProfile = sbom;

            // Base risk
            let inherentRisk = 18;

            // Category multiplier
            const categoryMultiplier = VENDOR_CATEGORIES[vendor.category]?.inherentRiskMultiplier || 1;
            inherentRisk *= categoryMultiplier;

            // Data types weighting
            (vendor.dataTypes || []).forEach(dataType => {
                inherentRisk += DATA_RISK_WEIGHTS[dataType] || 0;
            });

            // SBOM/Supply-chain exposure bump (EO 14028 / modern procurement expectations)
            if (sbom.providesSoftware && !sbom.sbomAvailable) {
                inherentRisk += 15;
            } else if (sbom.providesSoftware && sbom.sbomAvailable) {
                inherentRisk += 4; // still software, but with better hygiene
            }

            // Deterministic residual risk (no Math.random)
            const jitter = hashStringToRange(vendor.name || 'vendor', -8, 8);
            let residualRisk = inherentRisk * 0.88 + jitter;

            // Clamp
            inherentRisk = Math.max(0, Math.min(100, inherentRisk));
            residualRisk = Math.max(0, Math.min(100, residualRisk));

            // Determine risk level
            let riskLevel;
            if (residualRisk >= 90) riskLevel = 'critical';
            else if (residualRisk >= 70) riskLevel = 'high';
            else if (residualRisk >= 40) riskLevel = 'medium';
            else riskLevel = 'low';

            return {
                inherentRisk: Math.round(inherentRisk),
                residualRisk: Math.round(residualRisk),
                riskLevel,
                sbomProfile: sbom
            };
        }


        function updateAllDisplays() {
            log('updateAllDisplays called - vendorData:', typeof vendorData !== 'undefined' ? `${vendorData.length} vendors` : 'UNDEFINED');
            
            if (!vendorData || vendorData.length === 0) {
                log('updateAllDisplays: No vendor data, clearing displays');
                // Clear displays if no data
                const totalVendors = safeGetElement('totalVendors', 'updateStats');
                if (totalVendors) totalVendors.textContent = '0';
                
                const criticalCategoryCount = safeGetElement('criticalCategoryCount', 'updateStats');
                if (criticalCategoryCount) criticalCategoryCount.textContent = '0';
                
                const criticalRiskCount = safeGetElement('criticalRiskCount', 'updateStats');
                if (criticalRiskCount) criticalRiskCount.textContent = '0';
                
                const highRiskCount = safeGetElement('highRiskCount', 'updateStats');
                if (highRiskCount) highRiskCount.textContent = '0';
                
                const sensitiveDataCount = safeGetElement('sensitiveDataCount', 'updateStats');
                if (sensitiveDataCount) sensitiveDataCount.textContent = '0';
                
                const avgInherentRisk = safeGetElement('avgInherentRisk', 'updateStats');
                if (avgInherentRisk) avgInherentRisk.textContent = '0';
                updateRadarBlips([]);
                return;
            }
            
            log('updateAllDisplays: Updating displays with', vendorData.length, 'vendors');
            try {
                updateStats();
                updateAlertBanner();
                updateRadar();
                updateCharts();
                log('updateAllDisplays: All display functions called successfully');
            } catch (err) {
                logError('Error in updateAllDisplays:', err);
            }
        }

        function updateStats() {
            log('updateStats called - vendorData:', typeof vendorData !== 'undefined' ? `${vendorData.length} vendors` : 'UNDEFINED');
            
            if (!vendorData || vendorData.length === 0) {
                log('updateStats: No vendor data, setting all to 0');
                const totalEl = document.getElementById('totalVendors');
                if (totalEl) totalEl.textContent = '0';
                const criticalCatEl = document.getElementById('criticalCategoryCount');
                if (criticalCatEl) criticalCatEl.textContent = '0';
                const criticalRiskEl = document.getElementById('criticalRiskCount');
                if (criticalRiskEl) criticalRiskEl.textContent = '0';
                const highRiskEl = document.getElementById('highRiskCount');
                if (highRiskEl) highRiskEl.textContent = '0';
                const sensitiveEl = document.getElementById('sensitiveDataCount');
                if (sensitiveEl) sensitiveEl.textContent = '0';
                const avgEl = document.getElementById('avgInherentRisk');
                if (avgEl) avgEl.textContent = '0';
                return;
            }
            
            console.log('updateStats: Calculating stats for', vendorData.length, 'vendors');
            
            const criticalCategory = vendorData.filter(v => v.category === 'critical').length;
            const criticalRisk = vendorData.filter(v => v.riskLevel === 'critical').length;
            const highRisk = vendorData.filter(v => v.riskLevel === 'high').length;
            const sensitiveData = vendorData.filter(v => 
                v.dataTypes && v.dataTypes.some(dt => ['PII', 'PHI', 'Financial'].includes(dt))
            ).length;
            const avgInherent = vendorData.length > 0 
                ? (vendorData.reduce((sum, v) => sum + (v.inherentRisk || 0), 0) / vendorData.length).toFixed(0)
                : 0;
            
            const totalEl = document.getElementById('totalVendors');
            if (totalEl) totalEl.textContent = vendorData.length;
            const criticalCatEl = document.getElementById('criticalCategoryCount');
            if (criticalCatEl) criticalCatEl.textContent = criticalCategory;
            const criticalRiskEl = document.getElementById('criticalRiskCount');
            if (criticalRiskEl) criticalRiskEl.textContent = criticalRisk;
            const highRiskEl = document.getElementById('highRiskCount');
            if (highRiskEl) highRiskEl.textContent = highRisk;
            const sensitiveEl = document.getElementById('sensitiveDataCount');
            if (sensitiveEl) sensitiveEl.textContent = sensitiveData;
            const avgEl = document.getElementById('avgInherentRisk');
            if (avgEl) avgEl.textContent = avgInherent;
        }

        function updateAlertBanner() {
            const banner = document.getElementById('alertBanner');
            const icon = document.getElementById('alertIcon');
            const title = document.getElementById('alertTitle');
            const desc = document.getElementById('alertDesc');
            
            if (!banner || !icon || !title || !desc) {
                console.warn('Alert banner elements not found');
                return;
            }
            
            const criticalRisk = vendorData.filter(v => v.riskLevel === 'critical');
            const highRisk = vendorData.filter(v => v.riskLevel === 'high');
            const criticalCategory = vendorData.filter(v => v.category === 'critical' && v.riskLevel !== 'low');
            
            banner.style.display = 'flex';
            
            if (criticalRisk.length > 0) {
                banner.className = 'alert-banner critical';
                icon.textContent = 'ðŸš¨';
                title.textContent = 'CRITICAL VENDOR ALERT';
                desc.textContent = `${criticalRisk.length} vendor(s) in critical risk zone. Immediate review required: ${criticalRisk.map(v => v.name).join(', ')}`;
            } else if (criticalCategory.length > 0) {
                banner.className = 'alert-banner warning';
                icon.textContent = 'âš ï¸';
                title.textContent = 'CRITICAL CATEGORY AT RISK';
                desc.textContent = `${criticalCategory.length} mission-critical vendor(s) showing elevated risk. Enhanced monitoring required.`;
            } else if (highRisk.length > 3) {
                banner.className = 'alert-banner warning';
                icon.textContent = 'âš ï¸';
                title.textContent = 'ELEVATED VENDOR RISK';
                desc.textContent = `${highRisk.length} vendors at high risk. Enhanced monitoring recommended.`;
            } else {
                banner.className = 'alert-banner clear';
                icon.textContent = 'âœ…';
                title.textContent = 'VENDOR LANDSCAPE STABLE';
                desc.textContent = 'No critical risks detected. Continue standard vendor monitoring.';
            }
        }

        function updateRadar() {
            const categoryFilterEl = document.getElementById('categoryFilter');
            const riskFilterEl = document.getElementById('riskFilter');
            
            if (!categoryFilterEl || !riskFilterEl) {
                console.warn('Filter elements not found');
                return;
            }
            
            currentCategoryFilter = categoryFilterEl.value;
            currentRiskFilter = riskFilterEl.value;
            
            let filteredVendors = vendorData;
            
            // Category filter
            if (currentCategoryFilter !== 'all') {
                const categoryMap = {
                    critical: ['critical'],
                    strategic: ['critical', 'strategic'],
                    tactical: ['critical', 'strategic', 'tactical']
                };
                filteredVendors = filteredVendors.filter(v => categoryMap[currentCategoryFilter].includes(v.category));
            }
            
            // Risk filter
            if (currentRiskFilter !== 'all') {
                const riskMap = {
                    critical: ['critical'],
                    high: ['critical', 'high'],
                    medium: ['critical', 'high', 'medium']
                };
                filteredVendors = filteredVendors.filter(v => riskMap[currentRiskFilter].includes(v.riskLevel));
            }
            
            updateRadarBlips(filteredVendors);
            updateVendorLists();
        }

        // Track focused blip for keyboard navigation
        let focusedBlipIndex = -1;
        let currentBlips = [];
        
        function updateRadarBlips(vendors) {
            const screen = document.getElementById('radarScreen');
            if (!screen) {
                console.warn('Radar screen element not found');
                return;
            }
            
            // Ensure radar visuals are always visible
            const gridLines = screen.querySelector('.radar-grid-lines');
            if (gridLines) {
                gridLines.style.display = '';
            }
            const sweep = screen.querySelector('.radar-sweep');
            if (sweep) {
                sweep.style.display = '';
            }
            
            // Remove old blips
            document.querySelectorAll('.radar-blip').forEach(b => b.remove());
            currentBlips = vendors || [];
            focusedBlipIndex = -1;
            
            // Add new blips only if vendors exist
            if (!vendors || vendors.length === 0) {
                return;
            }
            
            vendors.forEach((vendor, index) => {
                const blip = document.createElement('div');
                blip.className = `radar-blip ${vendor.riskLevel}`;
                blip.setAttribute('tabindex', '0');
                blip.setAttribute('role', 'button');
                blip.setAttribute('aria-label', `${vendor.name} - ${vendor.riskLevel} risk`);
                blip.dataset.vendorIndex = index;
                
                // Position based on risk (closer to center = higher risk)
                const angle = (index / Math.max(vendors.length, 1)) * 360;
                const distance = (100 - vendor.residualRisk) * 0.45;
                
                const x = 50 + distance * Math.cos(angle * Math.PI / 180);
                const y = 50 + distance * Math.sin(angle * Math.PI / 180);
                
                blip.style.left = x + '%';
                blip.style.top = y + '%';
                
                // Enhanced hover effects
                blip.addEventListener('mouseenter', (e) => {
                    showTooltip(e, vendor);
                    blip.style.transform = 'scale(1.3)';
                    blip.style.zIndex = '1000';
                });
                blip.addEventListener('mouseleave', () => {
                    hideTooltip();
                    if (blip !== document.activeElement) {
                        blip.style.transform = 'scale(1)';
                        blip.style.zIndex = '';
                    }
                });
                blip.addEventListener('mousemove', (e) => moveTooltip(e));
                blip.addEventListener('click', (e) => {
                    e.stopPropagation();
                    openDrawer(vendor);
                });
                
                // Keyboard navigation
                blip.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        openDrawer(vendor);
                    } else if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
                        e.preventDefault();
                        focusNextBlip();
                    } else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
                        e.preventDefault();
                        focusPrevBlip();
                    }
                });
                
                blip.addEventListener('focus', () => {
                    focusedBlipIndex = index;
                    blip.style.transform = 'scale(1.3)';
                    blip.style.zIndex = '1000';
                    showTooltip({ pageX: blip.getBoundingClientRect().left, pageY: blip.getBoundingClientRect().top }, vendor);
                });
                
                blip.addEventListener('blur', () => {
                    blip.style.transform = 'scale(1)';
                    blip.style.zIndex = '';
                    hideTooltip();
                });
                
                screen.appendChild(blip);
            });
        }
        
        function focusNextBlip() {
            if (currentBlips.length === 0) return;
            focusedBlipIndex = (focusedBlipIndex + 1) % currentBlips.length;
            const blips = document.querySelectorAll('.radar-blip');
            if (blips[focusedBlipIndex]) {
                blips[focusedBlipIndex].focus();
            }
        }
        
        function focusPrevBlip() {
            if (currentBlips.length === 0) return;
            focusedBlipIndex = focusedBlipIndex <= 0 ? currentBlips.length - 1 : focusedBlipIndex - 1;
            const blips = document.querySelectorAll('.radar-blip');
            if (blips[focusedBlipIndex]) {
                blips[focusedBlipIndex].focus();
            }
        }

        function showTooltip(e, vendor) {
            const tooltip = safeGetElement('tooltip', 'showTooltip');
            if (!tooltip) return; // Early return if tooltip element doesn't exist
            
            const categoryName = VENDOR_CATEGORIES[vendor.category]?.name || vendor.category;
            const sbom = vendor.sbomProfile || {};
            const sbomStatus = sbom.providesSoftware 
                ? (sbom.sbomAvailable ? `âœ“ SBOM Available (${sbom.sbomFormat || 'Unknown'})` : 'âš  SBOM Missing (EO 14028 gap)')
                : 'N/A (Non-software vendor)';
            const locationInfo = vendor.location || 'Unknown';
            const contactInfo = vendor.contact ? `<a href="mailto:${vendor.contact}" style="color: var(--brand); text-decoration: underline;">${vendor.contact}</a>` : 'Not provided';
            const notesPreview = vendor.notes ? (vendor.notes.length > 60 ? vendor.notes.substring(0, 60) + '...' : vendor.notes) : 'No notes';
            
            const tooltipTitle = safeGetElement('tooltipTitle', 'showTooltip');
            if (tooltipTitle) tooltipTitle.textContent = vendor.name;
            
            const tooltipContent = safeGetElement('tooltipContent', 'showTooltip');
            if (tooltipContent) tooltipContent.innerHTML = `
                <div class="tooltip-row"><span>Category:</span><strong>${categoryName}</strong></div>
                <div class="tooltip-row"><span>Risk Level:</span><strong style="color: ${getRiskColor(vendor.riskLevel)}">${vendor.riskLevel.toUpperCase()}</strong></div>
                <div class="tooltip-row"><span>Inherent Risk:</span><strong>${vendor.inherentRisk}/100</strong></div>
                <div class="tooltip-row"><span>Residual Risk:</span><strong>${vendor.residualRisk}/100</strong></div>
                <div class="tooltip-row"><span>Sector:</span><strong>${vendor.sector || 'Unknown'}</strong></div>
                <div class="tooltip-row"><span>Location:</span><strong>${locationInfo}</strong></div>
                <div class="tooltip-row"><span>Contact:</span><strong>${contactInfo}</strong></div>
                <div class="tooltip-row"><span>Data Types:</span><strong>${(vendor.dataTypes || []).join(', ') || 'None'}</strong></div>
                <div class="tooltip-row"><span>SBOM Status:</span><strong style="font-size: 0.9em;">${sbomStatus}</strong></div>
                ${notesPreview !== 'No notes' ? `<div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--border); font-size: 0.85em; color: var(--muted);"><strong>Notes:</strong> ${escapeHtml(notesPreview)}</div>` : ''}
                <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--border); font-size: 0.75em; color: var(--muted); opacity: 0.8;">Click to view full details</div>
            `;
            tooltip.classList.add('show');
            moveTooltip(e);
        }
        
        function getRiskColor(riskLevel) {
            const colors = {
                'critical': '#ff0000',
                'high': '#ff6600',
                'medium': '#ffaa00',
                'low': '#00ff41'
            };
            return colors[riskLevel] || '#00ff41';
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function hideTooltip() {
            const tooltip = safeGetElement('tooltip', 'hideTooltip');
            if (tooltip) tooltip.classList.remove('show');
        }

        function moveTooltip(e) {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.left = (e.pageX + 15) + 'px';
            tooltip.style.top = (e.pageY + 15) + 'px';
        }
        
        function showNotification(message, type = 'info') {
            if (!message || typeof message !== 'string') {
                logWarn('showNotification called with invalid message:', message);
                return;
            }
            
            // Create or get notification element
            let notification = document.getElementById('chartNotification');
            if (!notification) {
                notification = document.createElement('div');
                notification.id = 'chartNotification';
                notification.setAttribute('role', 'alert');
                notification.setAttribute('aria-live', 'polite');
                notification.style.cssText = `
                    position: fixed;
                    top: 80px;
                    right: 20px;
                    background: linear-gradient(135deg, rgba(2,6,23,.95), rgba(2,6,23,.92));
                    border: 1.5px solid rgba(51,105,30,.4);
                    border-radius: 12px;
                    padding: 12px 16px;
                    box-shadow: 0 12px 32px rgba(0,0,0,.3);
                    z-index: 10001;
                    max-width: 300px;
                    opacity: 0;
                    transform: translateX(100%);
                    transition: all 0.3s ease;
                    color: var(--text);
                    font-size: 0.9rem;
                    pointer-events: none;
                `;
                document.body.appendChild(notification);
            }
            
            // Set type-specific styling
            const typeColors = {
                success: 'rgba(34,197,94,.4)',
                error: 'rgba(239,68,68,.4)',
                warning: 'rgba(234,179,8,.4)',
                info: 'rgba(51,105,30,.4)'
            };
            notification.style.borderColor = typeColors[type] || typeColors.info;
            notification.textContent = message;
            notification.style.opacity = '1';
            notification.style.transform = 'translateX(0)';
            
            // Auto-dismiss after 4 seconds (longer for errors)
            const duration = type === 'error' ? 6000 : 4000;
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, duration);
        }
        
        // Make showNotification globally accessible
        window.showNotification = showNotification;

        function updateVendorLists() {
            log('updateVendorLists called - vendorData:', typeof vendorData !== 'undefined' ? `${vendorData.length} vendors` : 'UNDEFINED');
            
            if (!vendorData || vendorData.length === 0) {
                log('updateVendorLists: No vendor data, clearing lists');
                const highRiskList = document.getElementById('highRiskList');
                if (highRiskList) {
                    highRiskList.innerHTML = '<div style="text-align: center; padding: 40px; opacity: 0.7;">No vendors loaded</div>';
                }
                const criticalList = document.getElementById('criticalCategoryList');
                if (criticalList) {
                    criticalList.innerHTML = '<div style="text-align: center; padding: 40px; opacity: 0.7;">No vendors loaded</div>';
                }
                return;
            }
            
            // High Risk Vendors
            const highRisk = vendorData
                .filter(v => v && (v.riskLevel === 'critical' || v.riskLevel === 'high'))
                .sort((a, b) => (b.residualRisk || 0) - (a.residualRisk || 0))
                .slice(0, 10);
            
            console.log('High risk vendors found:', highRisk.length);
            
            const highRiskList = document.getElementById('highRiskList');
            if (highRiskList) {
                if (highRisk.length > 0) {
                    highRiskList.innerHTML = highRisk.map(vendor => createVendorCard(vendor)).join('');
                    console.log('High risk list updated with', highRisk.length, 'vendors');
                } else {
                    highRiskList.innerHTML = '<div style="text-align: center; padding: 40px; opacity: 0.7;">No high-risk vendors detected</div>';
                }
            } else {
                console.warn('High risk list element not found');
            }
            
            // Critical Category Vendors
            const criticalCategory = vendorData
                .filter(v => v && v.category === 'critical')
                .sort((a, b) => (b.residualRisk || 0) - (a.residualRisk || 0));
            
            console.log('Critical category vendors found:', criticalCategory.length);
            
            const criticalList = document.getElementById('criticalCategoryList');
            if (criticalList) {
                if (criticalCategory.length > 0) {
                    criticalList.innerHTML = criticalCategory.map(vendor => createVendorCard(vendor)).join('');
                    console.log('Critical category list updated with', criticalCategory.length, 'vendors');
                } else {
                    criticalList.innerHTML = '<div style="text-align: center; padding: 40px; opacity: 0.7;">No critical vendors defined</div>';
                }
            } else {
                console.warn('Critical category list element not found');
            }
        }

        function createVendorCard(vendor) {
            const categoryName = VENDOR_CATEGORIES[vendor.category]?.name || vendor.category;
            const dataTypeTags = (vendor.dataTypes || []).map(dt => 
                `<span class="badge category" style="font-size: 0.65rem; padding: 3px 8px;">${dt}</span>`
            ).join('');
            
            const riskBadgeClass = vendor.riskLevel || 'low';
            const sbom = vendor.sbomProfile || {};
            const sbomIndicator = sbom.providesSoftware 
                ? (sbom.sbomAvailable 
                    ? '<span style="color: #00ff41; font-size: 0.7rem;">âœ“ SBOM</span>' 
                    : '<span style="color: #ff6600; font-size: 0.7rem;">âš  No SBOM</span>')
                : '';
            const contactInfo = vendor.contact ? `<div style="font-size: 0.75rem; opacity: 0.7; margin-top: 4px;"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 4px;"><rect width="20" height="16" x="2" y="4" rx="2"></rect><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path></svg>${vendor.contact}</div>` : '';
            
            return `
                <div class="vendor-item ${vendor.riskLevel}" onclick="openDrawer(${JSON.stringify(vendor).replace(/"/g, '&quot;')})" style="cursor: pointer; transition: all 0.2s ease; position: relative;" onmouseenter="this.style.transform='translateX(4px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'" onmouseleave="this.style.transform='translateX(0)'; this.style.boxShadow=''">
                    <div class="vendor-header">
                        <div class="vendor-name" style="display: flex; align-items: center; gap: 8px;">
                            ${vendor.name}
                            ${sbomIndicator}
                        </div>
                        <div class="vendor-badges">
                            <span class="badge category">${categoryName}</span>
                            <span class="badge ${riskBadgeClass}">${vendor.residualRisk || 0}/100</span>
                        </div>
                    </div>
                    <div class="vendor-details">
                        <div style="margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                            <strong>${vendor.sector || 'Unknown'}</strong>
                            <span style="opacity: 0.5;">â€¢</span>
                            <span style="font-size: 0.9em;">${vendor.location || 'Unknown'}</span>
                        </div>
                        <div style="font-size: 0.85rem; opacity: 0.85; display: flex; gap: 12px; flex-wrap: wrap;">
                            <span>Inherent: <strong>${vendor.inherentRisk || 0}/100</strong></span>
                            <span>Residual: <strong>${vendor.residualRisk || 0}/100</strong></span>
                        </div>
                        ${contactInfo}
                    </div>
                    ${dataTypeTags ? `<div class="vendor-tags" style="margin-top: 10px; display: flex; flex-wrap: wrap; gap: 6px;">${dataTypeTags}</div>` : ''}
                    ${vendor.notes ? `<div style="margin-top: 8px; font-size: 0.75rem; opacity: 0.7; font-style: italic; max-height: 2.4em; overflow: hidden; text-overflow: ellipsis;">${escapeHtml(vendor.notes.length > 80 ? vendor.notes.substring(0, 80) + '...' : vendor.notes)}</div>` : ''}
                </div>
            `;
        }

        function updateCharts() {
            // Category Distribution
            const categoryCtx = document.getElementById('categoryChart');
            if (categoryCtx) {
                if (charts.category) charts.category.destroy();
            
            const categoryCounts = {
                'Critical': vendorData.filter(v => v.category === 'critical').length,
                'Strategic': vendorData.filter(v => v.category === 'strategic').length,
                'Tactical': vendorData.filter(v => v.category === 'tactical').length,
                'Commodity': vendorData.filter(v => v.category === 'commodity').length
            };
            
            charts.category = new Chart(categoryCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(categoryCounts).map(k => `${k} (${categoryCounts[k]})`),
                    datasets: [{
                        data: Object.values(categoryCounts),
                        backgroundColor: ['#ff0000', '#ffa500', '#0096ff', '#999999'],
                        borderColor: '#0a0e27',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#00ff41', padding: 15 }
                        },
                        tooltip: {
                            callbacks: {
                                footer: (items) => {
                                    return 'Click to filter by this category';
                                }
                            }
                        }
                    },
                    onClick: (event, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const categories = ['critical', 'strategic', 'tactical', 'commodity'];
                            const selectedCategory = categories[index];
                            document.getElementById('categoryFilter').value = selectedCategory === 'critical' ? 'critical' : 
                                selectedCategory === 'strategic' ? 'strategic' : 
                                selectedCategory === 'tactical' ? 'tactical' : 'all';
                            updateRadar();
                        }
                    }
                }
            });
            } else {
                console.warn('Category chart canvas not found');
            }
            
            // Data in Scope
            const dataCtx = document.getElementById('dataChart');
            if (dataCtx) {
                if (charts.data) charts.data.destroy();
                
                const dataTypes = ['PII', 'PHI', 'Financial', 'IP', 'Confidential', 'Public'];
                const dataCounts = dataTypes.map(dt => 
                    vendorData.filter(v => (v.dataTypes || []).includes(dt)).length
                );
                
                charts.data = new Chart(dataCtx, {
                type: 'bar',
                data: {
                    labels: dataTypes,
                    datasets: [{
                        label: 'Vendors with Data Type',
                        data: dataCounts,
                        backgroundColor: ['#ff0000', '#ff6464', '#ffc800', '#c800ff', '#0096ff', '#00ff41'],
                        borderColor: '#00ff41',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: { 
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                footer: (items) => {
                                    return 'Click to view vendors with this data type';
                                }
                            }
                        }
                    },
                    onClick: (event, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const selectedDataType = dataTypes[index];
                            // Filter vendors by data type
                            const filtered = vendorData.filter(v => (v.dataTypes || []).includes(selectedDataType));
                            updateRadarBlips(filtered);
                            updateVendorLists();
                            // Show notification
                            showNotification(`Showing ${filtered.length} vendor(s) with ${selectedDataType} data`, 'info');
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#00ff41' },
                            grid: { color: 'rgba(0, 255, 65, 0.1)' }
                        },
                        x: {
                            ticks: { color: '#00ff41' },
                            grid: { display: false }
                        }
                    }
                }
            });
            } else {
                console.warn('Data chart canvas not found');
            }
            
            // Inherent Risk Distribution
            const inherentCtx = document.getElementById('inherentRiskChart');
            if (inherentCtx) {
                if (charts.inherent) charts.inherent.destroy();
            
            const riskBuckets = {
                'Critical (90-100)': vendorData.filter(v => v.inherentRisk >= 90).length,
                'High (70-89)': vendorData.filter(v => v.inherentRisk >= 70 && v.inherentRisk < 90).length,
                'Medium (40-69)': vendorData.filter(v => v.inherentRisk >= 40 && v.inherentRisk < 70).length,
                'Low (0-39)': vendorData.filter(v => v.inherentRisk < 40).length
            };
            
            charts.inherent = new Chart(inherentCtx, {
                type: 'pie',
                data: {
                    labels: Object.keys(riskBuckets),
                    datasets: [{
                        data: Object.values(riskBuckets),
                        backgroundColor: ['#ff0000', '#ff6600', '#ffaa00', '#00ff41'],
                        borderColor: '#0a0e27',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#00ff41', padding: 10 }
                        },
                        tooltip: {
                            callbacks: {
                                footer: (items) => {
                                    return 'Click to filter by this risk level';
                                }
                            }
                        }
                    },
                    onClick: (event, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const riskRanges = [
                                { min: 90, max: 100, label: 'Critical' },
                                { min: 70, max: 89, label: 'High' },
                                { min: 40, max: 69, label: 'Medium' },
                                { min: 0, max: 39, label: 'Low' }
                            ];
                            const selectedRange = riskRanges[index];
                            document.getElementById('riskFilter').value = selectedRange.label === 'Critical' ? 'critical' :
                                selectedRange.label === 'High' ? 'high' :
                                selectedRange.label === 'Medium' ? 'medium' : 'all';
                            updateRadar();
                        }
                    }
                }
            });
            } else {
                console.warn('Inherent risk chart canvas not found');
            }
            
            // Sector Distribution
            const sectorCtx = document.getElementById('sectorChart');
            if (sectorCtx) {
                if (charts.sector) charts.sector.destroy();
            
            const sectors = {};
            vendorData.forEach(v => {
                sectors[v.sector] = (sectors[v.sector] || 0) + 1;
            });
            
            charts.sector = new Chart(sectorCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(sectors),
                    datasets: [{
                        label: 'Vendors',
                        data: Object.values(sectors),
                        backgroundColor: 'rgba(0, 255, 65, 0.3)',
                        borderColor: '#00ff41',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: { 
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                footer: (items) => {
                                    return 'Click to filter by this sector';
                                }
                            }
                        }
                    },
                    onClick: (event, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const sectorNames = Object.keys(sectors);
                            const selectedSector = sectorNames[index];
                            const filtered = vendorData.filter(v => v.sector === selectedSector);
                            updateRadarBlips(filtered);
                            updateVendorLists();
                            showNotification(`Showing ${filtered.length} vendor(s) in ${selectedSector} sector`, 'info');
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#00ff41' },
                            grid: { color: 'rgba(0, 255, 65, 0.1)' }
                        },
                        x: {
                            ticks: { color: '#00ff41' },
                            grid: { display: false }
                        }
                    }
                }
            });
            } else {
                console.warn('Sector chart canvas not found');
            }
            
            // Geographic Distribution
            const geoCtx = document.getElementById('geoChart');
            if (geoCtx) {
                if (charts.geo) charts.geo.destroy();
                
                const locations = {};
                vendorData.forEach(v => {
                    locations[v.location] = (locations[v.location] || 0) + 1;
                });
                
                charts.geo = new Chart(geoCtx, {
                type: 'pie',
                data: {
                    labels: Object.keys(locations),
                    datasets: [{
                        data: Object.values(locations),
                        backgroundColor: ['#ff0000', '#ff6600', '#ffaa00', '#00ff41'],
                        borderColor: '#0a0e27',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#00ff41', padding: 10 }
                        },
                        tooltip: {
                            callbacks: {
                                footer: (items) => {
                                    return 'Click to filter by this location';
                                }
                            }
                        }
                    },
                    onClick: (event, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const locationNames = Object.keys(locations);
                            const selectedLocation = locationNames[index];
                            const filtered = vendorData.filter(v => v.location === selectedLocation);
                            updateRadarBlips(filtered);
                            updateVendorLists();
                            showNotification(`Showing ${filtered.length} vendor(s) in ${selectedLocation}`, 'info');
                        }
                    }
                }
            });
            } else {
                console.warn('Geographic chart canvas not found');
            }
        }

        // Vendor Management Functions
        function openAddVendor() {
            editingVendorId = null;
            const modalTitle = safeGetElement('modalTitle', 'openAddVendor');
            if (modalTitle) modalTitle.textContent = 'ADD VENDOR';
            
            const vendorForm = safeGetElement('vendorForm', 'openAddVendor');
            if (vendorForm) vendorForm.reset();
            
            const vendorModal = safeGetElement('vendorModal', 'openAddVendor');
            if (vendorModal) vendorModal.classList.add('active');
        }
        
        // Make vendor management functions globally accessible
        window.openAddVendor = openAddVendor;

        function closeVendorModal() {
            const vendorModal = safeGetElement('vendorModal', 'closeVendorModal');
            if (vendorModal) {
                vendorModal.classList.remove('active');
            }
            editingVendorId = null;
        }

        // Edit vendor function
        function editVendor(vendorId) {
            const vendor = vendorData.find(v => v.id === vendorId);
            if (!vendor) {
                if (typeof showNotification === 'function') {
                    showNotification('Vendor not found.', 'error');
                } else {
                    alert('Vendor not found.');
                }
                return;
            }
            
            editingVendorId = vendorId;
            const modalTitle = safeGetElement('modalTitle', 'editVendor');
            if (modalTitle) modalTitle.textContent = 'EDIT VENDOR';
            
            const vendorForm = safeGetElement('vendorForm', 'editVendor');
            if (vendorForm) {
                // Populate form fields
                const nameEl = document.getElementById('vendorName');
                if (nameEl) nameEl.value = vendor.name || '';
                
                const categoryEl = document.getElementById('vendorCategory');
                if (categoryEl) categoryEl.value = vendor.category || 'tactical';
                
                const sectorEl = document.getElementById('vendorSector');
                if (sectorEl) sectorEl.value = vendor.sector || 'Other';
                
                const locationEl = document.getElementById('vendorLocation');
                if (locationEl) locationEl.value = vendor.location || 'Unknown';
                
                const contactEl = document.getElementById('vendorContact');
                if (contactEl) contactEl.value = vendor.contact || '';
                
                const notesEl = document.getElementById('vendorNotes');
                if (notesEl) notesEl.value = vendor.notes || '';
                
                // Clear and set data type checkboxes
                document.querySelectorAll('input[name="dataType"]').forEach(cb => {
                    cb.checked = (vendor.dataTypes || []).includes(cb.value);
                });
            }
            
            const vendorModal = safeGetElement('vendorModal', 'editVendor');
            if (vendorModal) vendorModal.classList.add('active');
        }

        // Delete vendor function
        function deleteVendor(vendorId) {
            if (!confirm('Are you sure you want to delete this vendor? This cannot be undone.')) {
                return;
            }
            
            const index = vendorData.findIndex(v => v.id === vendorId);
            if (index === -1) {
                alert('Vendor not found.');
                return;
            }
            
            vendorData.splice(index, 1);
            
            // Save to storage
            const mode = (typeof detectMode === 'function') ? detectMode() : 'demo';
            const config = (typeof MODE_CONFIG !== 'undefined' && MODE_CONFIG[mode]) 
                ? MODE_CONFIG[mode] 
                : { dataSource: 'catalog', persistence: 'session', maxVendors: 25, name: 'Demo' };
            const storageKey = config.dataSource === 'catalog' 
                ? 'vendorsoluce_demo_data' 
                : 'vendorsoluce_user_data';
            const storage = config.persistence === 'session' ? sessionStorage : localStorage;
            storage.setItem(storageKey, JSON.stringify(vendorData));
            
            // Update displays
            if (typeof updateAllDisplays === 'function') {
                updateAllDisplays();
            } else {
                if (typeof updateStats === 'function') updateStats();
                if (typeof updateRadar === 'function') updateRadar();
                if (typeof updateCharts === 'function') updateCharts();
                if (typeof updateVendorLists === 'function') updateVendorLists();
            }
            
            // Show notification
            if (typeof showNotification === 'function') {
                showNotification('Vendor deleted successfully.', 'success');
            } else {
                alert('Vendor deleted successfully.');
            }
        }
        
        // Make edit and delete functions globally accessible
        window.editVendor = editVendor;
        window.deleteVendor = deleteVendor;

        const vendorForm = safeGetElement('vendorForm', 'form submission');
        if (vendorForm) {
            vendorForm.addEventListener('submit', function(e) {
                e.preventDefault();
            
            try {
                const vendorNameEl = document.getElementById('vendorName');
                const vendorName = vendorNameEl ? vendorNameEl.value.trim() : '';
                
                if (!vendorName) {
                    if (typeof showNotification === 'function') {
                        showNotification('Vendor name is required.', 'error');
                    } else {
                        alert('Vendor name is required.');
                    }
                    if (vendorNameEl) vendorNameEl.focus();
                    return;
                }
                
                const formData = {
                    id: editingVendorId || generateId(),
                    name: vendorName,
                    category: (document.getElementById('vendorCategory')?.value || 'tactical').toLowerCase(),
                    dataTypes: Array.from(document.querySelectorAll('input[name="dataType"]:checked')).map(cb => cb.value).filter(Boolean),
                    sector: (document.getElementById('vendorSector')?.value || 'Other').trim(),
                    location: (document.getElementById('vendorLocation')?.value || 'Unknown').trim(),
                    contact: (document.getElementById('vendorContact')?.value || '').trim(),
                    notes: (document.getElementById('vendorNotes')?.value || '').trim()
                };
                
                // Validate category
                if (!['critical', 'strategic', 'tactical', 'commodity'].includes(formData.category)) {
                    formData.category = 'tactical';
                }
                
                // Ensure dataTypes is an array
                if (!Array.isArray(formData.dataTypes) || formData.dataTypes.length === 0) {
                    formData.dataTypes = ['Confidential'];
                }
                
                // Calculate risk for the vendor
                let vendorWithRisk;
                try {
                    vendorWithRisk = {
                        ...formData,
                        ...calculateVendorRisk(formData)
                    };
                } catch (riskErr) {
                    logError('Error calculating risk:', riskErr);
                    // Use default risk values if calculation fails
                    vendorWithRisk = {
                        ...formData,
                        inherentRisk: 50,
                        residualRisk: 50,
                        riskLevel: 'medium',
                        sbomProfile: formData.sbomProfile || { providesSoftware: false, sbomAvailable: false, sbomFormat: 'none' }
                    };
                }
                
                if (editingVendorId) {
                    const index = vendorData.findIndex(v => v.id === editingVendorId);
                    if (index !== -1) {
                        vendorData[index] = vendorWithRisk;
                    } else {
                        console.warn('Vendor ID not found for editing:', editingVendorId);
                        vendorData.push(vendorWithRisk);
                    }
                } else {
                    // Check vendor limit before adding
                    const mode = (typeof detectMode === 'function') ? detectMode() : 'demo';
                    const config = (typeof MODE_CONFIG !== 'undefined' && MODE_CONFIG[mode]) 
                        ? MODE_CONFIG[mode] 
                        : { maxVendors: 25, dataSource: 'catalog', persistence: 'session' };
                    
                    if (config.maxVendors !== Infinity && vendorData.length >= config.maxVendors) {
                        alert(`Vendor limit reached (${config.maxVendors} vendors max). Please remove a vendor or upgrade your plan.`);
                        return;
                    }
                    
                    vendorData.push(vendorWithRisk);
                }
                
                // Recalculate risks for all vendors to ensure consistency
                vendorData = vendorData.map(vendor => {
                    try {
                        return {
                            ...vendor,
                            ...calculateVendorRisk(vendor)
                        };
                    } catch (err) {
                        logError('Error recalculating risk for vendor:', vendor, err);
                        return vendor; // Keep original if recalculation fails
                    }
                });
                
                // Save with mode-specific key
                const mode = (typeof detectMode === 'function') ? detectMode() : 'demo';
                const config = (typeof MODE_CONFIG !== 'undefined' && MODE_CONFIG[mode]) 
                    ? MODE_CONFIG[mode] 
                    : { dataSource: 'catalog', persistence: 'session', maxVendors: 25 };
                const storageKey = config.dataSource === 'catalog' 
                    ? 'vendorsoluce_demo_data' 
                    : 'vendorsoluce_user_data';
                const storage = config.persistence === 'session' ? sessionStorage : localStorage;
                
                try {
                    storage.setItem(storageKey, JSON.stringify(vendorData));
                } catch (storageErr) {
                    logError('Error saving vendor data:', storageErr);
                    const errorMsg = 'Warning: Vendor added but could not be saved to storage. ' + storageErr.message;
                    if (typeof showNotification === 'function') {
                        showNotification(errorMsg, 'warning');
                    } else {
                        alert(errorMsg);
                    }
                }
                
                if (typeof updateAllDisplays === 'function') {
                    updateAllDisplays();
                } else {
                    logWarn('updateAllDisplays function not available');
                }
                
                closeVendorModal();
            } catch (error) {
                logError('Error submitting vendor form:', error);
                const errorMsg = 'Error saving vendor: ' + (error.message || 'Unknown error');
                if (typeof showNotification === 'function') {
                    showNotification(errorMsg, 'error');
                } else {
                    alert(errorMsg);
                }
            }
        });
        } else {
            console.error('Vendor form not found: cannot attach submit handler');
        }

        // Import/Export Functions
        
function normalizeHeader(h){
            if (!h) return '';
            // Normalize header: lowercase, replace spaces/underscores with single space, remove special chars except spaces
            return h.toString().trim().toLowerCase()
                .replace(/[_\s]+/g, ' ')  // Replace underscores and multiple spaces with single space
                .replace(/[^a-z0-9 ]/g, '')  // Remove special characters
                .trim();
        }

        function mapRowToVendor(row){
            // row is an object with normalized keys
            const name = row['name'] || row['vendor'] || row['vendor name'] || '';
            const category = (row['category'] || row['tier'] || 'tactical').toString().toLowerCase();
            const dataTypesRaw = row['data types'] || row['data'] || row['data types handled'] || '';
            const dataTypes = dataTypesRaw ? dataTypesRaw.toString().split(/;|\||,/).map(s=>s.trim()).filter(Boolean) : [];

            const vendor = {
                name: name.toString().trim(),
                category: ['critical','strategic','tactical','commodity'].includes(category) ? category : 'tactical',
                dataTypes,
                sector: (row['sector'] || row['industry'] || 'Other').toString().trim() || 'Other',
                location: (row['location'] || row['country'] || 'United States').toString().trim() || 'United States',
                contact: (row['contact'] || row['owner'] || row['point of contact'] || '').toString().trim(),
                notes: (row['notes'] || row['comments'] || '').toString().trim(),
                // SBOM fields (optional in import)
                sbomProfile: {
                    providesSoftware: String(row['provides software'] || row['software vendor'] || '').toLowerCase() === 'true',
                    sbomAvailable: String(row['sbom available'] || row['sbom provided'] || '').toLowerCase() === 'true',
                    sbomFormat: (row['sbom format'] || row['format'] || 'none').toString().trim() || 'none'
                }
            };

            // If SBOM fields were not provided, infer them
            const providedAnySBOMField = ['provides software','software vendor','sbom available','sbom provided','sbom format'].some(k => row[k] !== undefined);
            if (!providedAnySBOMField) {
                vendor.sbomProfile = detectSBOMProfile(vendor);
            } else {
                // If providesSoftware is blank but sbomFormat suggests SBOM, infer providesSoftware
                if (!vendor.sbomProfile.providesSoftware && vendor.sbomProfile.sbomFormat && vendor.sbomProfile.sbomFormat.toLowerCase() !== 'none') {
                    vendor.sbomProfile.providesSoftware = true;
                }
            }

            return vendor;
        }

        function importVendors(event) {
            try {
                if (!event || !event.target) {
                    logError('Invalid event object in importVendors');
                    if (typeof showNotification === 'function') {
                        showNotification('Error: Invalid file input event. Please try again.', 'error');
                    } else {
                        alert('Error: Invalid file input event. Please try again.');
                    }
                    return;
                }
                
                const file = event.target.files && event.target.files[0];
                if (!file) {
                    logWarn('No file selected for import');
                    if (typeof showNotification === 'function') {
                        showNotification('No file selected. Please select a CSV or Excel file.', 'warning');
                    } else {
                        alert('No file selected. Please select a CSV or Excel file.');
                    }
                    return;
                }
                
                console.log('File selected:', {
                    name: file.name,
                    size: file.size,
                    type: file.type
                });

            // Enhanced file type detection: check extension, MIME type, and content
            const filename = (file.name || '').toLowerCase();
            const fileType = (file.type || '').toLowerCase();
            
            // Check by file extension (primary method)
            const hasXlsxExt = filename.endsWith('.xlsx') || filename.endsWith('.xls');
            const hasCsvExt = filename.endsWith('.csv');
            
            // Check by MIME type (secondary method, can be unreliable)
            const isXlsxMime = fileType.includes('spreadsheet') || 
                              fileType.includes('excel') || 
                              fileType === 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' ||
                              fileType === 'application/vnd.ms-excel' ||
                              fileType === 'application/excel' ||
                              fileType === 'application/x-excel' ||
                              fileType === 'application/x-msexcel';
            const isCsvMime = fileType === 'text/csv' || 
                            fileType === 'application/csv' ||
                            fileType === 'text/comma-separated-values' ||
                            fileType === 'application/vnd.ms-excel'; // Some systems report CSV as this
            
            // Determine file type: prioritize extension over MIME type (more reliable)
            // If extension is present, trust it. Otherwise, use MIME type or fallback to content detection
            const isXlsx = hasXlsxExt || (isXlsxMime && !hasCsvExt);
            const isCsv = hasCsvExt || (isCsvMime && !hasXlsxExt);
            
            // Log file info for debugging
            log('File import attempt:', {
                name: file.name,
                type: file.type,
                size: file.size,
                extension: filename.substring(filename.lastIndexOf('.')),
                detectedAsXlsx: isXlsx,
                detectedAsCsv: isCsv
            });

            // Get file input reference for resetting
            const fileInput = event.target;
            
            // Define finishImport first (used by helper functions)
            const finishImport = (vendors) => {
                console.log('finishImport called with vendors:', vendors);
                
                if (!Array.isArray(vendors)) {
                    logError('finishImport: vendors is not an array', vendors);
                    if (typeof showNotification === 'function') {
                        showNotification('Error: Invalid data format in file.', 'error');
                    } else {
                        alert('Error processing file: Invalid data format.');
                    }
                    if (fileInput) fileInput.value = '';
                    return;
                }

                const cleaned = vendors.filter(v => v && v.name && typeof v.name === 'string' && v.name.trim().length > 0);
                log(`Cleaned vendors: ${cleaned.length} out of ${vendors.length} total`);
                
                if (cleaned.length === 0) {
                    if (typeof showNotification === 'function') {
                        showNotification('No valid vendors found. Please check the format and ensure vendor names are provided.', 'error');
                    } else {
                        alert('No valid vendors found in file. Please check the format and ensure vendor names are provided.');
                    }
                    if (fileInput) fileInput.value = '';
                    return;
                }
                
                // Get current vendor data
                const currentData = (typeof vendorData !== 'undefined' && Array.isArray(vendorData)) ? vendorData : [];
                console.log(`Current vendor count: ${currentData.length}`);
                
                // Calculate risk for new vendors
                const vendorsWithRisk = cleaned.map(v => {
                    try {
                        return { ...v, ...calculateVendorRisk(v) };
                    } catch (err) {
                        console.error('Error calculating risk for vendor:', v, err);
                        // Return vendor with default risk if calculation fails
                        return {
                            ...v,
                            inherentRisk: 50,
                            residualRisk: 50,
                            riskLevel: 'medium',
                            sbomProfile: v.sbomProfile || { providesSoftware: false, sbomAvailable: false, sbomFormat: 'none' }
                        };
                    }
                });
                
                // Update vendorData - ensure we're updating the global variable
                vendorData = [...currentData, ...vendorsWithRisk];
                console.log(`Total vendors after import: ${vendorData.length}`);
                console.log('Sample vendor data:', vendorData.slice(0, 2));
                console.log('vendorData type:', typeof vendorData, 'isArray:', Array.isArray(vendorData));
                
                // Save with mode-specific key
                const mode = (typeof detectMode === 'function') ? detectMode() : 'demo';
                const config = (typeof MODE_CONFIG !== 'undefined' && MODE_CONFIG[mode]) 
                    ? MODE_CONFIG[mode] 
                    : { dataSource: 'catalog', persistence: 'session', maxVendors: 25, name: 'Demo' };
                const storageKey = config.dataSource === 'catalog' 
                    ? 'vendorsoluce_demo_data' 
                    : 'vendorsoluce_user_data';
                const storage = config.persistence === 'session' ? sessionStorage : localStorage;
                
                // Enforce vendor limits
                if (config.maxVendors !== Infinity && vendorData.length > config.maxVendors) {
                    const excess = vendorData.length - config.maxVendors;
                    vendorData = vendorData.slice(0, config.maxVendors);
                    const message = `Successfully imported ${cleaned.length} vendor(s)! However, ${excess} vendor(s) were removed due to the ${config.maxVendors} vendor limit in ${config.name || 'demo'} mode.`;
                    if (typeof showNotification === 'function') {
                        showNotification(message, 'warning');
                    } else {
                        alert(message);
                    }
                } else {
                    const message = `Successfully imported ${cleaned.length} vendor(s)!`;
                    if (typeof showNotification === 'function') {
                        showNotification(message, 'success');
                    } else {
                        alert(message);
                    }
                }
                
                try {
                    storage.setItem(storageKey, JSON.stringify(vendorData));
                    console.log('Vendor data saved to storage, key:', storageKey);
                    console.log('Verifying storage - saved count:', JSON.parse(storage.getItem(storageKey) || '[]').length);
                } catch (err) {
                    logError('Error saving vendor data:', err);
                    const errorMsg = 'Warning: Data imported but could not be saved to storage. ' + err.message;
                    if (typeof showNotification === 'function') {
                        showNotification(errorMsg, 'warning');
                    } else {
                        alert(errorMsg);
                    }
                }
                
                // Reset file input
                if (fileInput) fileInput.value = '';
                
                // Verify vendorData is accessible before updating displays
                console.log('Before updateAllDisplays - vendorData length:', typeof vendorData !== 'undefined' ? vendorData.length : 'UNDEFINED');
                
                // Force update all displays immediately
                console.log('Calling updateAllDisplays immediately...');
                console.log('vendorData at update time:', typeof vendorData !== 'undefined' ? vendorData.length : 'UNDEFINED');
                
                // Update displays immediately
                if (typeof updateAllDisplays === 'function') {
                    updateAllDisplays();
                    console.log('updateAllDisplays called successfully');
                } else {
                    console.error('updateAllDisplays function not available!');
                    // Fallback: manually update key displays
                    if (typeof updateStats === 'function') {
                        updateStats();
                    }
                    if (typeof updateRadar === 'function') {
                        updateRadar();
                    }
                    if (typeof updateRadarBlips === 'function') {
                        updateRadarBlips(vendorData || []);
                    }
                    if (typeof updateCharts === 'function') {
                        updateCharts();
                    }
                    console.log('Fallback display updates called');
                }
                
                // Ensure radar updates even if updateAllDisplays doesn't call it
                setTimeout(() => {
                    if (typeof updateRadar === 'function') {
                        updateRadar();
                        console.log('updateRadar called in setTimeout');
                    }
                    if (typeof updateRadarBlips === 'function' && vendorData && vendorData.length > 0) {
                        // Get filtered vendors if filters are active
                        let vendorsToShow = vendorData;
                        try {
                            const categoryFilter = document.getElementById('categoryFilter')?.value || 'all';
                            const riskFilter = document.getElementById('riskFilter')?.value || 'all';
                            
                            if (categoryFilter !== 'all' || riskFilter !== 'all') {
                                vendorsToShow = vendorData.filter(v => {
                                    if (categoryFilter !== 'all') {
                                        const categoryMap = { critical: ['critical'], strategic: ['critical', 'strategic'], tactical: ['critical', 'strategic', 'tactical'] };
                                        if (!categoryMap[categoryFilter]?.includes(v.category)) return false;
                                    }
                                    if (riskFilter !== 'all') {
                                        const riskMap = { critical: ['critical'], high: ['critical', 'high'], medium: ['critical', 'high', 'medium'] };
                                        if (!riskMap[riskFilter]?.includes(v.riskLevel)) return false;
                                    }
                                    return true;
                                });
                            }
                        } catch (e) {
                            console.warn('Error filtering vendors for radar:', e);
                        }
                        updateRadarBlips(vendorsToShow);
                        console.log('updateRadarBlips called directly with', vendorsToShow.length, 'vendors');
                    }
                }, 100);
            };
            
            // Helper functions to process files
            const processExcelFile = (file) => {
                console.log('Processing Excel file:', file.name, 'Size:', file.size);
                
                // Show loading indicator
                if (typeof showNotification === 'function') {
                    showNotification(`Reading Excel file: ${file.name}...`, 'info');
                }
                
                if (!window.XLSX) {
                    alert('Excel import requires XLSX library. Please use CSV format or ensure XLSX library is loaded.');
                    if (fileInput) fileInput.value = '';
                    if (typeof showNotification === 'function') {
                        showNotification('XLSX library not loaded. Please refresh the page.', 'error');
                    }
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e){
                    try{
                        // Use reader.result or e.target.result - more reliable
                        const result = (this.result || e.target?.result || reader.result);
                        if (!result) {
                            throw new Error('Failed to read file content');
                        }
                        console.log('Excel file content read successfully!');
                        console.log('Buffer size:', result.byteLength || result.length);
                        const data = new Uint8Array(result);
                        const wb = XLSX.read(data, { type: 'array' });
                        console.log('Excel workbook parsed, sheets:', wb.SheetNames?.length || 0);
                        
                        if (!wb.SheetNames || wb.SheetNames.length === 0) {
                            throw new Error('Excel file has no sheets');
                        }
                        
                        const sheetName = wb.SheetNames[0];
                        const ws = wb.Sheets[sheetName];
                        const json = XLSX.utils.sheet_to_json(ws, { defval: '' });

                        if (!json || json.length === 0) {
                            throw new Error('Excel file is empty or has no data rows');
                        }

                        const vendors = json.map((obj, index) => {
                            try {
                                const row = {};
                                Object.keys(obj).forEach(k => {
                                    const normalizedKey = normalizeHeader(k);
                                    row[normalizedKey] = obj[k];
                                });
                                const vendor = mapRowToVendor(row);
                                if (vendor && vendor.name) {
                                    return {
                                        id: generateId(),
                                        ...vendor
                                    };
                                }
                                return null;
                            } catch (err) {
                                console.warn(`Error processing row ${index + 1}:`, err);
                                return null;
                            }
                        }).filter(v => v !== null);

                        if (vendors.length === 0) {
                            throw new Error('No valid vendors found in Excel file. Please check the format.');
                        }

                        log(`Successfully parsed ${vendors.length} vendor(s) from Excel`);
                        finishImport(vendors);
                    }catch(err){
                        logError('Excel import error:', err);
                        const errorMsg = 'Error importing Excel file: ' + (err.message || 'Unknown error');
                        if (typeof showNotification === 'function') {
                            showNotification(errorMsg, 'error');
                        } else {
                            alert(errorMsg);
                        }
                        if (fileInput) fileInput.value = '';
                    }
                };
                reader.onerror = function(err) {
                    logError('FileReader error:', err);
                    if (typeof showNotification === 'function') {
                        showNotification('Error reading Excel file. Please try again.', 'error');
                    } else {
                        alert('Error reading Excel file. Please try again.');
                    }
                    if (fileInput) fileInput.value = '';
                };
                reader.readAsArrayBuffer(file);
            };
            
            const processCsvFile = (file) => {
                console.log('Processing CSV file:', file.name, 'Size:', file.size);
                
                // Show loading indicator
                if (typeof showNotification === 'function') {
                    showNotification(`Reading file: ${file.name}...`, 'info');
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        // Use reader.result or e.target.result - more reliable
                        const csv = (this.result || e.target?.result || reader.result || '');
                        log('File content read successfully!');
                        log('Content length:', csv.length);
                        log('First 200 chars:', csv.substring(0, 200));
                        
                        if (!csv || csv.trim().length === 0) {
                            if (typeof showNotification === 'function') {
                                showNotification('File is empty.', 'error');
                            } else {
                                alert('File is empty.');
                            }
                            if (fileInput) fileInput.value = '';
                            return;
                        }
                        
                        const lines = csv.split(/\r?\n/).filter(line => line.trim());
                        log('CSV lines parsed:', lines.length);
                        if (lines.length < 2) {
                            if (typeof showNotification === 'function') {
                                showNotification('CSV file must have at least a header row and one data row.', 'error');
                            } else {
                                alert('CSV file must have at least a header row and one data row.');
                            }
                            if (fileInput) fileInput.value = '';
                            return;
                        }

                        // Simplified CSV parsing - try simple split first, then fallback to quote handling
                        const parseCSVLine = (line) => {
                            // Try simple split first (most common case)
                            const simpleSplit = line.split(',');
                            // If no quotes found, use simple split
                            if (!line.includes('"')) {
                                return simpleSplit.map(v => v.trim());
                            }
                            
                            // Otherwise handle quotes properly
                            const result = [];
                            let current = '';
                            let inQuotes = false;
                            
                            for (let i = 0; i < line.length; i++) {
                                const char = line[i];
                                const nextChar = line[i + 1];
                                
                                if (char === '"') {
                                    if (inQuotes && nextChar === '"') {
                                        current += '"';
                                        i++;
                                    } else {
                                        inQuotes = !inQuotes;
                                    }
                                } else if (char === ',' && !inQuotes) {
                                    result.push(current.trim());
                                    current = '';
                                } else {
                                    current += char;
                                }
                            }
                            result.push(current.trim());
                            return result;
                        };

                        const headers = parseCSVLine(lines[0]).map(h => normalizeHeader(h.trim()));
                        if (headers.length === 0) {
                            throw new Error('Could not parse CSV headers');
                        }
                        
                        const vendors = [];

                        for (let i = 1; i < lines.length; i++) {
                            try {
                                if (!lines[i].trim()) continue;
                                
                                const values = parseCSVLine(lines[i]);
                                if (values.length === 0) continue;
                                
                                const row = {};
                                headers.forEach((h, idx) => {
                                    let val = (values[idx] ?? '').trim();
                                    // Remove surrounding quotes if present
                                    if (val.startsWith('"') && val.endsWith('"')) {
                                        val = val.slice(1, -1).replace(/""/g, '"');
                                    }
                                    row[h] = val;
                                });
                                
                                const vendor = mapRowToVendor(row);
                                if (vendor && vendor.name && vendor.name.trim().length > 0) {
                                    vendors.push({
                                        id: generateId(),
                                        ...vendor
                                    });
                                }
                            } catch (rowErr) {
                                logWarn(`Error processing CSV row ${i + 1}:`, rowErr);
                                // Continue processing other rows
                            }
                        }

                        if (vendors.length === 0) {
                            const errorMsg = 'No valid vendors found in file. Please check the format and ensure vendor names are provided.';
                            if (typeof showNotification === 'function') {
                                showNotification(errorMsg, 'error');
                            } else {
                                alert(errorMsg);
                            }
                            if (fileInput) fileInput.value = '';
                            return;
                        }

                        console.log(`Successfully parsed ${vendors.length} vendor(s) from CSV`);
                        finishImport(vendors);
                    } catch (error) {
                        console.error('CSV import error:', error);
                        alert('Error importing CSV file: ' + (error.message || 'Unknown error'));
                        if (fileInput) fileInput.value = '';
                    }
                };
                reader.onerror = function(err) {
                    console.error('FileReader error:', err);
                    alert('Error reading CSV file. Please try again.');
                    if (fileInput) fileInput.value = '';
                };
                reader.readAsText(file, 'UTF-8');
            };

            // Process the file using helper functions
            if (isXlsx) {
                processExcelFile(file);
            } else if (isCsv) {
                processCsvFile(file);
            } else {
                // Last resort: try to detect by reading first bytes (magic number detection)
                // Read more bytes (512) for better detection
                const bytesToRead = Math.min(512, file.size);
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        // Use reader.result or e.target.result - more reliable
                        const result = (this.result || e.target?.result || reader.result);
                        if (!result) {
                            throw new Error('Failed to read file content');
                        }
                        const buffer = result;
                        const firstBytes = new Uint8Array(buffer);
                        
                        // Excel files start with PK (ZIP signature) or D0 CF 11 E0 (old Excel)
                        const isExcelMagic = (firstBytes[0] === 0x50 && firstBytes[1] === 0x4B) || // PK (ZIP/XLSX)
                                            (firstBytes[0] === 0xD0 && firstBytes[1] === 0xCF && firstBytes[2] === 0x11 && firstBytes[3] === 0xE0); // Old Excel
                        
                        if (isExcelMagic) {
                            console.log('File detected as Excel by magic bytes');
                            processExcelFile(file);
                        } else {
                            // Check if it looks like text (CSV)
                            let isText = true;
                            let hasCommaOrTab = false;
                            
                            for (let i = 0; i < Math.min(100, firstBytes.length); i++) {
                                const byte = firstBytes[i];
                                // Check for null bytes or control characters (except common text ones)
                                if (byte === 0 || (byte < 0x20 && byte !== 0x09 && byte !== 0x0A && byte !== 0x0D)) {
                                    isText = false;
                                    break;
                                }
                                // Check for CSV delimiters
                                if (byte === 0x2C || byte === 0x09) { // comma or tab
                                    hasCommaOrTab = true;
                                }
                            }
                            
                            if (isText && (hasCommaOrTab || firstBytes.length > 0)) {
                                console.log('File detected as CSV by content analysis');
                                processCsvFile(file);
                            } else {
                                // Try to get text representation for better error message
                                try {
                                    const text = String.fromCharCode.apply(null, Array.from(firstBytes.slice(0, Math.min(100, firstBytes.length))));
                                    console.warn('File type could not be determined. Attempting CSV processing as fallback.');
                                    console.log('File preview:', text.substring(0, 50));
                                    // Default to CSV processing - it's more forgiving
                                    processCsvFile(file);
                                } catch (textErr) {
                                    console.error('Error analyzing file content:', textErr);
                                    alert('Could not determine file type. Please ensure the file is a valid CSV (.csv) or Excel (.xlsx, .xls) file.\n\nFile details:\n- Name: ' + file.name + '\n- Type: ' + (file.type || 'unknown') + '\n- Size: ' + file.size + ' bytes\n\nTip: Make sure the file has the correct extension (.csv, .xlsx, or .xls).');
                                    if (fileInput) fileInput.value = '';
                                }
                            }
                        }
                    } catch (err) {
                        console.error('Error in magic byte detection:', err);
                        // Default to CSV as it's more forgiving
                        console.log('Error in detection, defaulting to CSV processing');
                        processCsvFile(file);
                    }
                };
                reader.onerror = function(err) {
                    console.error('FileReader error in magic byte detection:', err);
                    // Default to CSV processing as fallback
                    console.log('FileReader error, defaulting to CSV processing');
                    processCsvFile(file);
                };
                reader.readAsArrayBuffer(file.slice(0, bytesToRead));
            }
        } catch (err) {
            console.error('Fatal error in importVendors:', err);
            alert('An error occurred while processing the file. Please try again or contact support if the problem persists.');
            if (event && event.target) {
                event.target.value = '';
            }
        }
    }
        
        // Make importVendors globally accessible
        window.importVendors = importVendors;

        function exportVendors() {
            if (!vendorData || vendorData.length === 0) {
                alert('No vendor data available. Please scan vendors first.');
                return;
            }
            
            try {
                const now = new Date();
                const categoryName = (cat) => VENDOR_CATEGORIES[cat]?.name || cat || 'Unknown';
                const sbomStatus = (v) => {
                    const sbom = v.sbomProfile || {};
                    if (!sbom.providesSoftware) return 'N/A';
                    return sbom.sbomAvailable ? `Yes (${sbom.sbomFormat || 'Unknown'})` : 'No (EO 14028 Gap)';
                };
                
                const csv = [
                    // Header row with comprehensive fields
                    ['Name', 'Category', 'Category Name', 'Risk Level', 'Residual Risk', 'Inherent Risk', 
                     'Sector', 'Location', 'Data Types', 'Contact Email', 'SBOM Provides Software', 
                     'SBOM Available', 'SBOM Format', 'SBOM Status', 'Notes'].join(','),
                    // Data rows
                    ...vendorData
                        .sort((a, b) => (b.residualRisk || 0) - (a.residualRisk || 0))
                        .map(v => {
                            const sbom = v.sbomProfile || {};
                            const row = [
                                v.name || '',
                                v.category || '',
                                categoryName(v.category),
                                (v.riskLevel || 'unknown').toUpperCase(),
                                v.residualRisk || 0,
                                v.inherentRisk || 0,
                                v.sector || '',
                                v.location || '',
                                (v.dataTypes || []).join('; '),
                                v.contact || '',
                                sbom.providesSoftware ? 'Yes' : 'No',
                                sbom.sbomAvailable ? 'Yes' : 'No',
                                sbom.sbomFormat || 'N/A',
                                sbomStatus(v),
                                (v.notes || '').replace(/"/g, '""') // Escape quotes in CSV
                            ];
                            // Quote fields that contain commas, quotes, or newlines
                            return row.map(field => {
                                const str = String(field);
                                if (str.includes(',') || str.includes('"') || str.includes('\n')) {
                                    return `"${str.replace(/"/g, '""')}"`;
                                }
                                return str;
                            }).join(',');
                        })
                ];
                
                // Add metadata as comments at the top (some CSV readers support this)
                const metadata = [
                    `# Vendor Risk Assessment Export`,
                    `# Generated: ${now.toLocaleString()}`,
                    `# Total Vendors: ${vendorData.length}`,
                    `# Export Date: ${now.toISOString().split('T')[0]}`,
                    `# Generated by: VendorSoluceâ„¢ Supply Chain Assurance`,
                    `#`,
                    csv.join('\n')
                ].join('\n');
                
                const blob = new Blob([metadata], { type: 'text/csv;charset=utf-8;' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `vendor-risk-export-${now.toISOString().split('T')[0]}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                // Show success message
                if (typeof showNotification === 'function') {
                    showNotification(`Exported ${vendorData.length} vendor(s) to CSV`, 'success');
                }
            } catch (error) {
                console.error('Export error:', error);
                alert('Error exporting vendors: ' + error.message);
            }
        }
        
        // Make exportVendors globally accessible
        window.exportVendors = exportVendors;

        // Reset vendor data to demo data
        async function resetVendorData() {
            if (!confirm('Reset all vendor data and reload demo data? This will clear all current vendors.')) {
                return;
            }
            
            try {
                // Clear current data
                vendorData = [];
                
                // Clear storage
                const mode = (typeof detectMode === 'function') ? detectMode() : 'demo';
                const config = (typeof MODE_CONFIG !== 'undefined' && MODE_CONFIG[mode]) 
                    ? MODE_CONFIG[mode] 
                    : { dataSource: 'catalog', persistence: 'session', maxVendors: 25, name: 'Demo' };
                const storageKey = config.dataSource === 'catalog' 
                    ? 'vendorsoluce_demo_data' 
                    : 'vendorsoluce_user_data';
                const storage = config.persistence === 'session' ? sessionStorage : localStorage;
                storage.removeItem(storageKey);
                
                // Load fresh demo data
                const sampleVendors = await initializeSampleVendors();
                if (sampleVendors && sampleVendors.length > 0) {
                    vendorData = sampleVendors.slice(0, config.maxVendors || 25);
                    
                    // Calculate risk scores
                    vendorData = vendorData.map(vendor => ({
                        ...vendor,
                        ...calculateVendorRisk(vendor)
                    }));
                    
                    // Save to storage
                    storage.setItem(storageKey, JSON.stringify(vendorData));
                    
                    // Update displays
                    updateAllDisplays();
                    
                    // Show success notification
                    if (typeof showNotification === 'function') {
                        showNotification(`Reset complete! Loaded ${vendorData.length} demo vendor(s).`, 'success');
                    } else {
                        alert(`Reset complete! Loaded ${vendorData.length} demo vendor(s).`);
                    }
                } else {
                    throw new Error('Failed to load demo data');
                }
            } catch (error) {
                console.error('Error resetting vendor data:', error);
                alert('Error resetting vendor data: ' + (error.message || 'Unknown error'));
            }
        }
        
        // Make resetVendorData globally accessible
        window.resetVendorData = resetVendorData;

        // Clear all vendors (without reloading demo data)
        function clearAllVendors() {
            if (!confirm('Are you sure you want to clear all vendors? This cannot be undone.')) {
                return;
            }
            
            try {
                // Clear current data
                vendorData = [];
                
                // Clear storage
                const mode = (typeof detectMode === 'function') ? detectMode() : 'demo';
                const config = (typeof MODE_CONFIG !== 'undefined' && MODE_CONFIG[mode]) 
                    ? MODE_CONFIG[mode] 
                    : { dataSource: 'catalog', persistence: 'session', maxVendors: 25, name: 'Demo' };
                const storageKey = config.dataSource === 'catalog' 
                    ? 'vendorsoluce_demo_data' 
                    : 'vendorsoluce_user_data';
                const storage = config.persistence === 'session' ? sessionStorage : localStorage;
                storage.removeItem(storageKey);
                
                // Update all displays
                if (typeof updateAllDisplays === 'function') {
                    updateAllDisplays();
                } else {
                    // Fallback: manually update key displays
                    if (typeof updateStats === 'function') updateStats();
                    if (typeof updateRadar === 'function') updateRadar();
                    if (typeof updateCharts === 'function') updateCharts();
                    if (typeof updateVendorLists === 'function') updateVendorLists();
                }
                
                // Show success notification
                if (typeof showNotification === 'function') {
                    showNotification('All vendors cleared successfully.', 'success');
                } else {
                    alert('All vendors cleared successfully.');
                }
                
                console.log('All vendors cleared');
            } catch (error) {
                console.error('Error clearing vendors:', error);
                alert('Error clearing vendors: ' + (error.message || 'Unknown error'));
            }
        }
        
        // Make clearAllVendors globally accessible
        window.clearAllVendors = clearAllVendors;

        function generateReport() {
            // Check for vendor data
            if (!vendorData || vendorData.length === 0) {
                alert('No vendor data available. Please scan vendors first.');
                return;
            }

            // Check if PDF is enabled in current mode
            const mode = (typeof detectMode === 'function') ? detectMode() : 'demo';
            const config = (typeof MODE_CONFIG !== 'undefined' && MODE_CONFIG[mode]) 
                ? MODE_CONFIG[mode] 
                : { pdfEnabled: false };
            
            // Check demo mode restriction
            if (mode === 'demo' && (DEMO_MODE.pdfEnabled === false || config.pdfEnabled === false)) {
                if (typeof openUpgrade === 'function') {
                    openUpgrade('PDF reports are locked in Demo Mode. Start your free trial to unlock PDF exports and unlimited vendors.');
                } else {
                    alert('PDF reports are locked in Demo Mode. Please upgrade to generate reports.');
                }
                return;
            }

            try {
                // Check for jsPDF library
                if (!window.jspdf) {
                    alert('PDF library not loaded. Please refresh the page and try again.');
                    return;
                }
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Check for autoTable plugin
                if (typeof doc.autoTable !== 'function') {
                    alert('PDF table plugin not loaded. Please refresh the page and try again.');
                    return;
                }
                
                // Validate vendor data
                const validVendors = vendorData.filter(v => {
                    return v && 
                           v.name && 
                           typeof v.name === 'string' && 
                           v.name.trim().length > 0;
                });

                if (validVendors.length === 0) {
                    alert('No valid vendor data available for PDF generation.');
                    return;
                }
                
                const now = new Date();
                const pageWidth = doc.internal.pageSize.width;
                const pageHeight = doc.internal.pageSize.height;
                const margin = 14;
                const contentWidth = pageWidth - (margin * 2);
                let yPos = margin;
                
                // Helper function to add new page if needed
                const checkPageBreak = (requiredSpace = 20) => {
                    if (yPos + requiredSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = margin;
                        return true;
                    }
                    return false;
                };
                
                // Helper function to draw section header
                const addSectionHeader = (text, size = 14) => {
                    checkPageBreak(15);
                    yPos += 8;
                    doc.setFontSize(size);
                    doc.setTextColor(51, 105, 30);
                    doc.setFont(undefined, 'bold');
                    doc.text(text, margin, yPos);
                    yPos += 6;
                    doc.setFont(undefined, 'normal');
                    doc.setFontSize(10);
                    doc.setTextColor(0, 0, 0);
                };
                
                // Helper function to draw a horizontal line
                const drawLine = () => {
                    doc.setDrawColor(200, 200, 200);
                    doc.line(margin, yPos, pageWidth - margin, yPos);
                    yPos += 3;
                };
                
                // Helper function to draw a metric box
                const drawMetricBox = (label, value, x, width = 45) => {
                    const boxHeight = 20;
                    checkPageBreak(boxHeight + 5);
                    
                    // Box background
                    doc.setFillColor(245, 245, 245);
                    doc.rect(x, yPos, width, boxHeight, 'F');
                    
                    // Box border
                    doc.setDrawColor(220, 220, 220);
                    doc.rect(x, yPos, width, boxHeight);
                    
                    // Value
                    doc.setFontSize(16);
                    doc.setTextColor(51, 105, 30);
                    doc.setFont(undefined, 'bold');
                    doc.text(String(value), x + width / 2, yPos + 10, { align: 'center' });
                    
                    // Label
                    doc.setFontSize(8);
                    doc.setTextColor(100, 100, 100);
                    doc.setFont(undefined, 'normal');
                    doc.text(label, x + width / 2, yPos + 17, { align: 'center' });
                };
                
                // ========== COVER PAGE ==========
                // Logo/Title area
                doc.setFontSize(24);
                doc.setTextColor(51, 105, 30);
                doc.setFont(undefined, 'bold');
                doc.text('VendorSoluceâ„¢', pageWidth / 2, 40, { align: 'center' });
                
                doc.setFontSize(18);
                doc.text('Vendor Risk Assessment Report', pageWidth / 2, 50, { align: 'center' });
                
                doc.setFontSize(12);
                doc.setTextColor(100, 100, 100);
                doc.setFont(undefined, 'normal');
                doc.text('Supply Chain Assurance', pageWidth / 2, 60, { align: 'center' });
                
                // Report metadata box
                yPos = 80;
                const metadataBoxHeight = 50;
                doc.setFillColor(250, 250, 250);
                doc.rect(margin, yPos, contentWidth, metadataBoxHeight, 'F');
                doc.setDrawColor(200, 200, 200);
                doc.rect(margin, yPos, contentWidth, metadataBoxHeight);
                
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                let metadataY = yPos + 8;
                doc.text(`Report Generated: ${now.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' })}`, margin + 5, metadataY);
                metadataY += 6;
                doc.text(`Total Vendors Assessed: ${validVendors.length}`, margin + 5, metadataY);
                metadataY += 6;
                doc.text(`Report Period: ${now.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}`, margin + 5, metadataY);
                metadataY += 6;
                doc.text(`Assessment Mode: ${mode.toUpperCase()}`, margin + 5, metadataY);
                
                yPos = 140;
                
                // ========== EXECUTIVE SUMMARY ==========
                doc.addPage();
                yPos = margin;
                addSectionHeader('Executive Summary', 16);
                
                // Calculate key metrics
                const criticalCount = validVendors.filter(v => v.riskLevel === 'critical').length;
                const highCount = validVendors.filter(v => v.riskLevel === 'high').length;
                const mediumCount = validVendors.filter(v => v.riskLevel === 'medium').length;
                const lowCount = validVendors.filter(v => v.riskLevel === 'low').length;
                const criticalCategoryCount = validVendors.filter(v => v.category === 'critical').length;
                const strategicCount = validVendors.filter(v => v.category === 'strategic').length;
                const tacticalCount = validVendors.filter(v => v.category === 'tactical').length;
                const commodityCount = validVendors.filter(v => v.category === 'commodity').length;
                
                const sbomGaps = validVendors.filter(v => (v.sbomProfile||{}).providesSoftware && !(v.sbomProfile||{}).sbomAvailable).length;
                const sbomCompliant = validVendors.filter(v => (v.sbomProfile||{}).providesSoftware && (v.sbomProfile||{}).sbomAvailable).length;
                const softwareVendors = validVendors.filter(v => (v.sbomProfile||{}).providesSoftware).length;
                
                const avgRisk = validVendors.length > 0 
                    ? Math.round(validVendors.reduce((sum, v) => sum + (v.residualRisk || 0), 0) / validVendors.length)
                    : 0;
                const maxRisk = Math.max(...validVendors.map(v => v.residualRisk || 0));
                const minRisk = Math.min(...validVendors.map(v => v.residualRisk || 0));
                
                const piiVendors = validVendors.filter(v => (v.dataTypes || []).includes('PII')).length;
                const phiVendors = validVendors.filter(v => (v.dataTypes || []).includes('PHI')).length;
                const financialVendors = validVendors.filter(v => (v.dataTypes || []).includes('Financial')).length;
                
                // Key Metrics Boxes
                const boxWidth = (contentWidth - 20) / 4;
                let boxX = margin;
                drawMetricBox('Total Vendors', validVendors.length, boxX, boxWidth);
                boxX += boxWidth + 5;
                drawMetricBox('Critical Risk', criticalCount, boxX, boxWidth);
                boxX += boxWidth + 5;
                drawMetricBox('High Risk', highCount, boxX, boxWidth);
                boxX += boxWidth + 5;
                drawMetricBox('Avg Risk', `${avgRisk}/100`, boxX, boxWidth);
                
                yPos += 25;
                checkPageBreak(40);
                
                // Risk Distribution
                addSectionHeader('Risk Distribution', 12);
                doc.setFontSize(9);
                doc.setTextColor(0, 0, 0);
                doc.text(`Critical Risk (90-100): ${criticalCount} vendors (${Math.round(criticalCount/validVendors.length*100)}%)`, margin + 5, yPos);
                yPos += 5;
                doc.text(`High Risk (70-89): ${highCount} vendors (${Math.round(highCount/validVendors.length*100)}%)`, margin + 5, yPos);
                yPos += 5;
                doc.text(`Medium Risk (40-69): ${mediumCount} vendors (${Math.round(mediumCount/validVendors.length*100)}%)`, margin + 5, yPos);
                yPos += 5;
                doc.text(`Low Risk (0-39): ${lowCount} vendors (${Math.round(lowCount/validVendors.length*100)}%)`, margin + 5, yPos);
                yPos += 8;
                
                // Category Distribution
                addSectionHeader('Category Distribution', 12);
                doc.setFontSize(9);
                doc.text(`Critical Category: ${criticalCategoryCount} vendors`, margin + 5, yPos);
                yPos += 5;
                doc.text(`Strategic Category: ${strategicCount} vendors`, margin + 5, yPos);
                yPos += 5;
                doc.text(`Tactical Category: ${tacticalCount} vendors`, margin + 5, yPos);
                yPos += 5;
                doc.text(`Commodity Category: ${commodityCount} vendors`, margin + 5, yPos);
                yPos += 8;
                
                // Data Exposure Summary
                addSectionHeader('Data Exposure Summary', 12);
                doc.setFontSize(9);
                doc.text(`Vendors with PII: ${piiVendors}`, margin + 5, yPos);
                yPos += 5;
                doc.text(`Vendors with PHI: ${phiVendors}`, margin + 5, yPos);
                yPos += 5;
                doc.text(`Vendors with Financial Data: ${financialVendors}`, margin + 5, yPos);
                yPos += 8;
                
                // Risk Range
                doc.setFontSize(9);
                doc.text(`Risk Score Range: ${minRisk} - ${maxRisk} (Average: ${avgRisk})`, margin + 5, yPos);
                yPos += 10;
                
                // ========== SBOM COMPLIANCE SECTION ==========
                checkPageBreak(50);
                addSectionHeader('SBOM Compliance & EO 14028 Posture', 14);
                
                doc.setFontSize(10);
                doc.text(`Software Vendors Identified: ${softwareVendors}`, margin + 5, yPos);
                yPos += 6;
                doc.text(`SBOM Compliant: ${sbomCompliant} (${softwareVendors > 0 ? Math.round(sbomCompliant/softwareVendors*100) : 0}%)`, margin + 5, yPos);
                yPos += 6;
                doc.setTextColor(220, 38, 38);
                doc.setFont(undefined, 'bold');
                doc.text(`SBOM Gaps (EO 14028 Risk): ${sbomGaps} (${softwareVendors > 0 ? Math.round(sbomGaps/softwareVendors*100) : 0}%)`, margin + 5, yPos);
                yPos += 8;
                doc.setTextColor(0, 0, 0);
                doc.setFont(undefined, 'normal');
                
                if (sbomGaps > 0) {
                    doc.setFontSize(9);
                    doc.setTextColor(100, 100, 100);
                    doc.text('Vendors with SBOM gaps require immediate procurement follow-up per EO 14028 requirements.', margin + 5, yPos);
                    yPos += 6;
                    doc.text('These vendors provide software but cannot produce a Software Bill of Materials (SBOM).', margin + 5, yPos);
                    yPos += 8;
                }
                
                // List vendors with SBOM gaps
                if (sbomGaps > 0) {
                    const sbomGapVendors = validVendors.filter(v => (v.sbomProfile||{}).providesSoftware && !(v.sbomProfile||{}).sbomAvailable);
                    if (sbomGapVendors.length > 0) {
                        doc.setFontSize(9);
                        doc.setTextColor(0, 0, 0);
                        doc.setFont(undefined, 'bold');
                        doc.text('Vendors Requiring SBOM Follow-up:', margin + 5, yPos);
                        yPos += 5;
                        doc.setFont(undefined, 'normal');
                        sbomGapVendors.slice(0, 10).forEach((v, idx) => {
                            if (yPos > pageHeight - 30) {
                                doc.addPage();
                                yPos = margin;
                            }
                            doc.text(`${idx + 1}. ${v.name} (${v.sector || 'Unknown'})`, margin + 10, yPos);
                            yPos += 4;
                        });
                        if (sbomGapVendors.length > 10) {
                            doc.text(`... and ${sbomGapVendors.length - 10} more`, margin + 10, yPos);
                            yPos += 4;
                        }
                        yPos += 5;
                    }
                }
                
                // ========== DETAILED RISK ANALYSIS ==========
                checkPageBreak(30);
                addSectionHeader('Detailed Risk Analysis', 14);
                
                doc.setFontSize(10);
                doc.text('Top Risk Vendors Requiring Immediate Attention:', margin + 5, yPos);
                yPos += 8;
                
                const topRiskVendors = validVendors
                    .sort((a, b) => (b.residualRisk || 0) - (a.residualRisk || 0))
                    .slice(0, 10);
                
                topRiskVendors.forEach((v, idx) => {
                    checkPageBreak(15);
                    doc.setFontSize(9);
                    doc.setFont(undefined, 'bold');
                    doc.setTextColor(51, 105, 30);
                    doc.text(`${idx + 1}. ${v.name}`, margin + 5, yPos);
                    yPos += 5;
                    doc.setFont(undefined, 'normal');
                    doc.setTextColor(0, 0, 0);
                    doc.setFontSize(8);
                    const categoryName = VENDOR_CATEGORIES[v.category]?.name || v.category || 'Unknown';
                    doc.text(`   Category: ${categoryName} | Risk Level: ${(v.riskLevel || 'unknown').toUpperCase()} | Residual Risk: ${v.residualRisk || 0}/100`, margin + 5, yPos);
                    yPos += 4;
                    if (v.sector) {
                        doc.text(`   Sector: ${v.sector} | Location: ${v.location || 'Unknown'}`, margin + 5, yPos);
                        yPos += 4;
                    }
                    if (v.dataTypes && v.dataTypes.length > 0) {
                        doc.text(`   Data Types: ${v.dataTypes.join(', ')}`, margin + 5, yPos);
                        yPos += 4;
                    }
                    const sbom = v.sbomProfile || {};
                    if (sbom.providesSoftware) {
                        doc.text(`   SBOM Status: ${sbom.sbomAvailable ? 'Compliant' : 'âš  Missing (EO 14028 Gap)'}`, margin + 5, yPos);
                        yPos += 4;
                    }
                    yPos += 3;
                });
                
                // ========== COMPREHENSIVE VENDOR TABLE ==========
                checkPageBreak(30);
                addSectionHeader('Complete Vendor Inventory', 14);
                
                // Prepare comprehensive table data
                const tableData = validVendors
                    .sort((a, b) => (b.residualRisk || 0) - (a.residualRisk || 0))
                    .map(v => {
                        const sbom = v.sbomProfile || {};
                        const sbomStatus = sbom.providesSoftware 
                            ? (sbom.sbomAvailable ? 'Yes' : 'No')
                            : 'N/A';
                        return [
                            (v.name || 'Unknown').substring(0, 35),
                            (VENDOR_CATEGORIES[v.category]?.name || v.category || 'Unknown').substring(0, 12),
                            (v.riskLevel || 'unknown').toUpperCase(),
                            String(Math.round(v.residualRisk || 0)),
                            String(Math.round(v.inherentRisk || 0)),
                            (v.sector || 'Unknown').substring(0, 15),
                            ((v.dataTypes || []).join(', ') || 'None').substring(0, 20),
                            sbomStatus
                        ];
                    });
                
                try {
                    const finalY = doc.lastAutoTable.finalY || yPos;
                    doc.autoTable({
                        startY: finalY + 5,
                        head: [['Vendor', 'Category', 'Risk', 'Residual', 'Inherent', 'Sector', 'Data Types', 'SBOM']],
                        body: tableData,
                        theme: 'striped',
                        headStyles: { 
                            fillColor: [51, 105, 30], 
                            textColor: 255, 
                            fontStyle: 'bold',
                            fontSize: 9
                        },
                        styles: { 
                            fontSize: 7, 
                            cellPadding: 2,
                            overflow: 'linebreak',
                            cellWidth: 'wrap'
                        },
                        columnStyles: {
                            0: { cellWidth: 40 },
                            1: { cellWidth: 25 },
                            2: { cellWidth: 18 },
                            3: { cellWidth: 18 },
                            4: { cellWidth: 18 },
                            5: { cellWidth: 28 },
                            6: { cellWidth: 30 },
                            7: { cellWidth: 15 }
                        },
                        margin: { left: margin, right: margin },
                        didDrawPage: (data) => {
                            yPos = data.cursor.y;
                        }
                    });
                    yPos = doc.lastAutoTable.finalY + 10;
                } catch (tableError) {
                    console.error('AutoTable error:', tableError);
                    throw new Error('Failed to generate PDF table: ' + (tableError.message || 'Unknown error'));
                }
                
                // ========== RECOMMENDATIONS & NEXT STEPS ==========
                checkPageBreak(60);
                addSectionHeader('Recommendations & Next Steps', 14);
                
                doc.setFontSize(10);
                doc.setFont(undefined, 'bold');
                doc.text('Immediate Actions Required:', margin + 5, yPos);
                yPos += 6;
                doc.setFont(undefined, 'normal');
                doc.setFontSize(9);
                
                const recommendations = [];
                if (criticalCount > 0) {
                    recommendations.push(`Review ${criticalCount} critical risk vendor(s) and develop remediation plans within 30 days`);
                }
                if (sbomGaps > 0) {
                    recommendations.push(`Request SBOMs from ${sbomGaps} software vendor(s) to meet EO 14028 compliance requirements`);
                }
                if (criticalCategoryCount > 0) {
                    recommendations.push(`Establish exit plans and redundancy options for ${criticalCategoryCount} critical category vendor(s)`);
                }
                if (piiVendors > 0 || phiVendors > 0) {
                    recommendations.push(`Validate privacy controls and DPA clauses for ${piiVendors + phiVendors} vendor(s) handling sensitive data`);
                }
                recommendations.push('Assign ownership and set next review dates for all high-risk vendors');
                recommendations.push('Schedule quarterly vendor risk review meetings');
                
                recommendations.forEach((rec, idx) => {
                    checkPageBreak(6);
                    doc.text(`${idx + 1}. ${rec}`, margin + 5, yPos);
                    yPos += 5;
                });
                
                yPos += 5;
                doc.setFontSize(9);
                doc.setTextColor(100, 100, 100);
                doc.text('This report is generated by VendorSoluceâ„¢ Supply Chain Assurance platform.', margin + 5, yPos);
                yPos += 4;
                doc.text('For questions or support, contact your VendorSoluce administrator.', margin + 5, yPos);
                
                // ========== FOOTER ON ALL PAGES ==========
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFontSize(8);
                    doc.setTextColor(128, 128, 128);
                    doc.setFont(undefined, 'normal');
                    
                    // Footer line
                    doc.setDrawColor(200, 200, 200);
                    doc.line(margin, pageHeight - 15, pageWidth - margin, pageHeight - 15);
                    
                    // Footer text
                    doc.text(
                        `VendorSoluceâ„¢ Supply Chain Assurance - Confidential - Page ${i} of ${pageCount}`,
                        pageWidth / 2,
                        pageHeight - 8,
                        { align: 'center' }
                    );
                    
                    // Report date in footer
                    doc.text(
                        `Generated: ${now.toLocaleDateString()}`,
                        pageWidth - margin,
                        pageHeight - 8,
                        { align: 'right' }
                    );
                }
                
                // ========== SAVE PDF ==========
                const filename = `vendor-risk-report-${now.toISOString().split('T')[0]}.pdf`;
                doc.save(filename);
                
                // Show success message
                if (typeof showToast === 'function') {
                    showToast('PDF report generated successfully!');
                } else if (typeof showNotification === 'function') {
                    showNotification('PDF report generated successfully!', 'success');
                } else {
                    console.log('PDF report generated successfully!');
                }
            } catch (error) {
                console.error('PDF generation error:', error);
                
                // More specific error messages
                if (error.message && error.message.includes('autoTable')) {
                    alert('Error generating PDF table. Please refresh the page and try again.');
                } else if (error.message && error.message.includes('font')) {
                    alert('Error with PDF fonts. Please try again.');
                } else {
                    alert('Error generating PDF report: ' + (error.message || 'Unknown error'));
                }
            }
        }
        
        // Make generateReport globally accessible
        window.generateReport = generateReport;

        // Start Trial function
        function startTrial() {
            if (typeof openUpgrade === 'function') {
                openUpgrade('Start your 14-day free trial to unlock unlimited vendors, PDF exports, and full SBOM ingestion.');
            } else {
                window.location.href = 'https://www.application.vendorsoluce.com';
            }
        }

        // Auto-scan
        setInterval(scanVendors, 5 * 60 * 1000);

        
        
// Theme + Collapsible Panels (v8)
window.VSTheme = (function(){
  const KEY = "vendorsoluce_theme";
  let userOverride = null;

  function apply(mode){
    const root = document.documentElement;
    root.dataset.theme = mode;
    if(mode === "dark") root.classList.add("dark");
    else root.classList.remove("dark");
    const btn = document.getElementById("themeToggle");
    if(btn) btn.textContent = (mode === "dark") ? "Dark" : "Light";
  }

  function getSystem(){
    return (window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches) ? "dark" : "light";
  }

  function init(){
    const stored = localStorage.getItem(KEY);
    if(stored === "dark" || stored === "light"){
      userOverride = stored;
      apply(stored);
    } else {
      apply(getSystem());
    }
    // react to system changes only if user hasn't overridden
    if(window.matchMedia){
      const mq = window.matchMedia("(prefers-color-scheme: dark)");
      const handler = () => { if(!userOverride) apply(getSystem()); };
      if(mq.addEventListener) mq.addEventListener("change", handler);
      else if(mq.addListener) mq.addListener(handler);
    }
  }

  function toggle(){
    const current = document.documentElement.dataset.theme || getSystem();
    const next = (current === "dark") ? "light" : "dark";
    userOverride = next;
    localStorage.setItem(KEY, next);
    apply(next);
  }

  return { init, toggle, apply };
})();

window.VSCollapse = (function(){
  function decorate(){
    // Decorate radar panels
    document.querySelectorAll(".radar-panel .panel-title").forEach((t)=>{
      t.setAttribute("tabindex","0");
      t.setAttribute("role","button");
      if(!t.querySelector(".panel-chev")){
        const chev = document.createElement("span");
        chev.className = "panel-chev";
        chev.textContent = "â–¾";
        t.appendChild(chev);
      }
      const panel = t.closest(".radar-panel");
      const setAria = () => t.setAttribute("aria-expanded", panel && !panel.classList.contains("collapsed") ? "true" : "false");
      setAria();
      t.addEventListener("click", (e)=>{
        // Don't collapse if clicking help button
        if(e.target.closest('.panel-help-btn')) return;
        if(panel){ panel.classList.toggle("collapsed"); setAria(); }
      });
      t.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); t.click(); }});
    });
    
    // Decorate collapsible sections
    document.querySelectorAll(".collapsible-section .section-header").forEach((h)=>{
      h.setAttribute("tabindex","0");
      h.setAttribute("role","button");
      const section = h.closest(".collapsible-section");
      const setAria = () => h.setAttribute("aria-expanded", section && !section.classList.contains("collapsed") ? "true" : "false");
      setAria();
      h.addEventListener("click", (e)=>{
        // Don't collapse if clicking help button
        if(e.target.closest('.section-help-btn')) return;
        if(section){ section.classList.toggle("collapsed"); setAria(); }
      });
      h.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); h.click(); }});
    });
  }
  function collapseAll(){
    document.querySelectorAll(".radar-panel").forEach(p=>p.classList.add("collapsed"));
    document.querySelectorAll(".radar-panel .panel-title").forEach(t=>t.setAttribute("aria-expanded","false"));
    document.querySelectorAll(".collapsible-section").forEach(s=>s.classList.add("collapsed"));
    document.querySelectorAll(".collapsible-section .section-header").forEach(h=>h.setAttribute("aria-expanded","false"));
  }
  function expandAll(){
    document.querySelectorAll(".radar-panel").forEach(p=>p.classList.remove("collapsed"));
    document.querySelectorAll(".radar-panel .panel-title").forEach(t=>t.setAttribute("aria-expanded","true"));
    document.querySelectorAll(".collapsible-section").forEach(s=>s.classList.remove("collapsed"));
    document.querySelectorAll(".collapsible-section .section-header").forEach(h=>h.setAttribute("aria-expanded","true"));
  }
  function init(){ decorate(); }
  return { init, collapseAll, expandAll };
})();

// Guidance display function
function showGuidance(sectionId){
  const guidanceEl = document.getElementById('guidance-' + sectionId);
  if(guidanceEl){
    const isVisible = guidanceEl.style.display !== 'none';
    guidanceEl.style.display = isVisible ? 'none' : 'block';
  }
}

// Help Panel Functions
function showHelpPanel() {
  let helpPanel = document.getElementById('helpPanel');
  if (!helpPanel) {
    // Create help panel if it doesn't exist
    const panel = document.createElement('div');
    panel.id = 'helpPanel';
    panel.className = 'help-panel';
    panel.innerHTML = `
      <div class="help-panel-header">
        <h3>Help & Guidance</h3>
        <button onclick="closeHelpPanel()" class="help-panel-close" aria-label="Close help panel">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
        </button>
      </div>
      <div class="help-panel-content">
        <div class="help-section">
          <h4>Quick Start</h4>
          <ul>
            <li><strong>Scan Vendors:</strong> Click to analyze all vendors and calculate risk scores</li>
            <li><strong>Add Vendor:</strong> Manually add a new vendor to your assessment</li>
            <li><strong>Import CSV:</strong> Bulk import vendors from a spreadsheet</li>
            <li><strong>Filters:</strong> Use category and risk filters to focus on specific vendor groups</li>
            <li><strong>Catalog:</strong> Browse pre-configured enterprise vendors</li>
            <li><strong>Wizard:</strong> Use onboarding wizard for quick vendor setup</li>
          </ul>
        </div>
        <div class="help-section">
          <h4>Keyboard Shortcuts</h4>
          <ul>
            <li><kbd>Arrow Keys</kbd> - Navigate between radar blips</li>
            <li><kbd>Enter</kbd> or <kbd>Space</kbd> - Open vendor details drawer</li>
            <li><kbd>Esc</kbd> - Close modals, drawers, or help panels</li>
            <li><kbd>Click Charts</kbd> - Filter vendors by clicking chart segments</li>
            <li><kbd>Hover Blips</kbd> - View quick vendor tooltips</li>
          </ul>
        </div>
        <div class="help-section">
          <h4>Understanding Risk Scores</h4>
          <ul>
            <li><strong>Critical (90-100):</strong> Immediate attention required, develop remediation plans</li>
            <li><strong>High (70-89):</strong> Enhanced monitoring recommended, review controls</li>
            <li><strong>Medium (40-69):</strong> Standard monitoring, periodic reviews</li>
            <li><strong>Low (0-39):</strong> Minimal risk, routine oversight</li>
          </ul>
        </div>
        <div class="help-section">
          <h4>Vendor Categories</h4>
          <ul>
            <li><strong>Critical:</strong> Mission-essential, single point of failure, requires exit plans</li>
            <li><strong>Strategic:</strong> High-value, significant business impact</li>
            <li><strong>Tactical:</strong> Operational support, moderate impact</li>
            <li><strong>Commodity:</strong> Easily replaceable, low impact</li>
          </ul>
        </div>
        <div class="help-section">
          <h4>SBOM & EO 14028</h4>
          <ul>
            <li>Software vendors must provide SBOMs per Executive Order 14028</li>
            <li>Vendors with SBOM gaps are flagged for procurement follow-up</li>
            <li>Click vendor cards to see detailed SBOM compliance status</li>
            <li>SBOM format (SPDX/CycloneDX) is tracked for compliance</li>
          </ul>
        </div>
        <div class="help-section">
          <h4>Tips & Best Practices</h4>
          <ul>
            <li>Hover over radar blips to see quick vendor details</li>
            <li>Click any vendor card or blip to view full risk analysis</li>
            <li>Use the Catalog to quickly add common enterprise vendors</li>
            <li>Export data for compliance documentation</li>
            <li>Generate PDF reports for executive presentations</li>
            <li>Use filters to focus on high-priority vendor groups</li>
            <li>Review SBOM gaps regularly for EO 14028 compliance</li>
          </ul>
        </div>
      </div>
    `;
    document.body.appendChild(panel);
    // Add backdrop
    const backdrop = document.createElement('div');
    backdrop.className = 'help-panel-backdrop';
    backdrop.onclick = closeHelpPanel;
    document.body.appendChild(backdrop);
    setTimeout(() => {
      panel.classList.add('show');
      backdrop.classList.add('show');
    }, 10);
  } else {
    helpPanel.classList.toggle('show');
    const backdrop = document.querySelector('.help-panel-backdrop');
    if (backdrop) backdrop.classList.toggle('show');
  }
}

function closeHelpPanel() {
  const helpPanel = document.getElementById('helpPanel');
  const backdrop = document.querySelector('.help-panel-backdrop');
  if (helpPanel) {
    helpPanel.classList.remove('show');
  }
  if (backdrop) {
    backdrop.classList.remove('show');
  }
}

// Make functions globally accessible
window.showHelpPanel = showHelpPanel;
window.closeHelpPanel = closeHelpPanel;

// Keyboard shortcuts for help panel
document.addEventListener('keydown', function(e) {
  // Press '?' or 'H' to open help panel (when not typing in input fields)
  if ((e.key === '?' || e.key === 'h' || e.key === 'H') && 
      !e.target.matches('input, textarea, select') && 
      !e.ctrlKey && !e.metaKey) {
    e.preventDefault();
    const helpPanel = document.getElementById('helpPanel');
    if (helpPanel && !helpPanel.classList.contains('show')) {
      showHelpPanel();
    }
  }
  // Press Escape to close help panel
  if (e.key === 'Escape') {
    const helpPanel = document.getElementById('helpPanel');
    if (helpPanel && helpPanel.classList.contains('show')) {
      closeHelpPanel();
    }
  }
});

// Mobile Menu Script
(function() {
    function initMobileMenu() {
        const menuButton = document.querySelector('[data-mobile-menu-button]');
        if (!menuButton) return;

        menuButton.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            const isExpanded = menuButton.getAttribute('aria-expanded') === 'true';
            const mobileMenu = document.querySelector('[data-mobile-menu]');
            
            if (mobileMenu) {
                if (isExpanded) {
                    mobileMenu.classList.add('hidden');
                    menuButton.setAttribute('aria-expanded', 'false');
                    menuButton.setAttribute('aria-label', 'Open menu');
                } else {
                    mobileMenu.classList.remove('hidden');
                    menuButton.setAttribute('aria-expanded', 'true');
                    menuButton.setAttribute('aria-label', 'Close menu');
                }
            }
        });

        // Close menu when clicking outside
        document.addEventListener('click', function(e) {
            const mobileMenu = document.querySelector('[data-mobile-menu]');
            if (mobileMenu && !mobileMenu.contains(e.target) && !menuButton.contains(e.target)) {
                if (!mobileMenu.classList.contains('hidden')) {
                    mobileMenu.classList.add('hidden');
                    menuButton.setAttribute('aria-expanded', 'false');
                    menuButton.setAttribute('aria-label', 'Open menu');
                }
            }
        });

        // Close menu on escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const mobileMenu = document.querySelector('[data-mobile-menu]');
                if (mobileMenu && !mobileMenu.classList.contains('hidden')) {
                    mobileMenu.classList.add('hidden');
                    menuButton.setAttribute('aria-expanded', 'false');
                    menuButton.setAttribute('aria-label', 'Open menu');
                }
            }
        });
    }

    // Theme Toggle Handler (if not already handled by VSTheme)
    function initThemeToggle() {
        const themeButtons = document.querySelectorAll('[data-theme-toggle]');
        themeButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                if (typeof window.VSTheme !== 'undefined' && typeof window.VSTheme.toggle === 'function') {
                    window.VSTheme.toggle();
                }
            });
        });
    }

    // Always wait for DOM to be fully loaded to ensure mobile menu panel exists
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
            initMobileMenu();
            initThemeToggle();
        });
    } else {
        // Use setTimeout to ensure DOM is fully parsed even if readyState is 'complete'
        setTimeout(function() {
            initMobileMenu();
            initThemeToggle();
        }, 0);
    }
})();

// Initial scan + init
document.addEventListener("DOMContentLoaded", ()=>{
  try{ window.VSTheme.init(); }catch(e){}
  try{ window.VSCollapse.init(); }catch(e){}
  
  // Initialize mode system
  if (typeof initializeApp === 'function') {
    initializeApp();
  }
  // Initialize platform status
  if (typeof initializePlatformStatus === 'function') {
    initializePlatformStatus();
  }
  
  // Initialize timestamp on page load
  const timestampEl = document.getElementById('timestamp');
  if (timestampEl && (timestampEl.textContent === 'â€”' || timestampEl.textContent === 'INITIALIZINGâ€¦')) {
    const now = new Date();
    timestampEl.textContent = now.toLocaleString();
  }
  
  // Auto-load demo data on page load
  if (typeof scanVendors === 'function') {
    try { 
      scanVendors(); 
    } catch(e) {
      console.warn('Error auto-loading demo data:', e);
    }
  }
  
  // Set footer year
  const yearEl = document.getElementById('vs-year');
  if (yearEl) yearEl.textContent = new Date().getFullYear();
});
</script>
</main>
<!-- Demo Watermark -->
<div aria-hidden="true" class="vs-watermark">DEMO</div>
<!-- Vendor Drawer -->
<aside aria-hidden="true" aria-label="Vendor details" class="vs-drawer" id="vendorDrawer" role="dialog">
<div class="vs-drawer__backdrop" id="drawerBackdrop"></div>
<div class="vs-drawer__panel" role="document">
<div class="vs-drawer__header">
<div>
<div class="vs-drawer__title" id="drawerTitle">Vendor</div>
<div class="vs-drawer__subtitle" id="drawerSubtitle">Risk profile</div>
</div>
<button aria-label="Close details" class="btn btn-ghost" id="drawerCloseBtn" type="button">
<span aria-hidden="true" class="btn__icon">âœ•</span>
</button>
</div>
<div class="vs-drawer__body">
<div class="vs-kpiRow">
<div class="vs-kpiMini">
<div class="vs-kpiMini__label">Risk Level</div>
<div class="vs-kpiMini__value" id="drawerRiskLevel">â€”</div>
</div>
<div class="vs-kpiMini">
<div class="vs-kpiMini__label">Inherent / Residual</div>
<div class="vs-kpiMini__value" id="drawerScores">â€”</div>
</div>
<div class="vs-kpiMini">
<div class="vs-kpiMini__label">Criticality</div>
<div class="vs-kpiMini__value" id="drawerCriticality">â€”</div>
</div>
</div>
<div class="vs-card">
<div class="vs-card__title">Why this vendor matters</div>
<ul class="vs-bullets" id="drawerRationale"></ul>
</div>
<div class="vs-card">
<div class="vs-card__title">Data access</div>
<div class="vs-chips" id="drawerDataTypes"></div>
</div>
<div class="vs-card">
<div class="vs-card__title">SBOM &amp; Supply Chain Signal</div>
<div class="vs-sbomBox">
<div class="vs-sbomLine"><span class="vs-muted">Provides software:</span> <strong id="drawerProvidesSoftware">â€”</strong></div>
<div class="vs-sbomLine"><span class="vs-muted">SBOM available:</span> <strong id="drawerSbomAvailable">â€”</strong></div>
<div class="vs-sbomLine"><span class="vs-muted">Format:</span> <strong id="drawerSbomFormat">â€”</strong></div>
<div class="vs-sbomLine"><span class="vs-muted">Open source exposure:</span> <strong id="drawerOssExposure">â€”</strong></div>
<div class="vs-sbomNote">EO 14028-ready assessment signals. Full SBOM ingestion &amp; component risk requires the Professional tier.</div>
</div>
</div>
<div class="vs-card">
<div class="vs-card__title">Recommended next actions</div>
<ol class="vs-steps" id="drawerActions"></ol>
</div>
</div>
<div class="vs-drawer__footer">
<button class="btn btn-primary" id="drawerCtaBtn" type="button">Request Full Access</button>
<button class="btn btn-ghost" id="drawerSecondaryBtn" type="button">Back to Radar</button>
</div>
</div>
</aside>
<!-- Upgrade Modal -->
<div aria-hidden="true" aria-label="Upgrade required" class="vs-modal" id="upgradeModal" role="dialog">
<div class="vs-modal__backdrop" id="upgradeBackdrop"></div>
<div class="vs-modal__panel" role="document">
<div class="vs-modal__header">
<div class="vs-modal__title">Unlock Professional</div>
<button aria-label="Close upgrade" class="btn btn-ghost" id="upgradeCloseBtn" type="button">
<span aria-hidden="true" class="btn__icon">âœ•</span>
</button>
</div>
<div class="vs-modal__body">
<p class="vs-modal__lead" id="upgradeReason">This action is locked in Demo Mode.</p>
<div class="vs-grid2">
<div class="vs-card">
<div class="vs-card__title">Professional unlocks</div>
<ul class="vs-bullets">
<li>Unlimited vendors + full register</li>
<li>Executive PDF reports</li>
<li>SBOM &amp; EO 14028 control mapping</li>
<li>Custom risk weights and rationale tuning</li>
</ul>
</div>
<div class="vs-card">
<div class="vs-card__title">Why teams buy</div>
<ul class="vs-bullets">
<li>Procurement-ready defensibility</li>
<li>Focus on the vendors that can break you</li>
<li>Actionable board reporting in minutes</li>
<li>Operational signals, not spreadsheets</li>
</ul>
</div>
</div>
<div class="vs-ctaRow">
<a class="btn btn-primary" href="#pricing" id="upgradePrimaryLink">View Pricing</a>
<a class="btn btn-ghost" href="#contact" id="upgradeSecondaryLink">Request Full Access</a>
</div>
<div class="vs-muted vs-small">Demo Mode is intentionally constrained to protect methodology and prevent â€œfree consulting.â€</div>
</div>
</div>
</div>
<!-- VendorSoluce Catalog + Wizard + API Mockups (v6) -->
<div aria-label="Vendor Catalog" aria-modal="true" aria-hidden="true" class="vs-modal-backdrop" id="vsCatalogBackdrop" role="dialog" style="display: none;">
<div class="vs-modal">
<header>
<div>
<h3>VendorSoluce Catalog</h3>
<div class="vs-muted">150â€“200 common vendors, filterable by industry. Add to your working list in one click.</div>
</div>
<button class="vs-close" onclick="VSUI.close('vsCatalogBackdrop')">Close</button>
</header>
<div class="vs-body">
<div class="vs-grid">
<div class="vs-card">
<div class="vs-field">
<label>Search</label>
<input class="vs-input" id="vsCatalogSearch" placeholder="e.g., Okta, Salesforce, CrowdStrike"/>
</div>
<div class="vs-field">
<label>Industry filter</label>
<select class="vs-select" id="vsCatalogIndustry">
<option value="All">All</option>
<option value="Healthcare">Healthcare</option>
<option value="Financial Services">Financial Services</option>
<option value="Retail">Retail</option>
<option value="Technology">Technology</option>
<option value="Manufacturing">Manufacturing</option>
<option value="SMB">SMB</option>
</select>
</div>
<div class="vs-field">
<label>Category filter</label>
<select class="vs-select" id="vsCatalogCategory">
<option value="All">All</option>
</select>
</div>
<div class="vs-alert" id="vsCatalogHint">
            Tip: Use <span class="vs-badge">Industry templates</span> in the onboarding wizard to preload a realistic stack.
          </div>
<div class="vs-row" style="margin-top:12px">
<button class="vs-btn primary" onclick="VSUI.addSelectedFromCatalog()">Add selected</button>
<button class="vs-btn" onclick="VSUI.selectTopVisible(12)">Select top 12</button>
<button class="vs-btn" onclick="VSUI.clearCatalogSelection()">Clear selection</button>
</div>
</div>
<div class="vs-card">
<div class="vs-row" style="justify-content:space-between;align-items:center;margin-bottom:10px">
<div class="vs-muted"><span id="vsCatalogCount">0</span> vendors shown</div>
<div class="vs-muted">Selected: <span id="vsCatalogSelectedCount">0</span></div>
</div>
<table aria-label="Vendor catalog list" class="vs-table">
<thead>
<tr>
<th style="width:44px"></th>
<th>Vendor</th>
<th>Category</th>
<th>Industries</th>
<th style="width:140px"></th>
</tr>
</thead>
<tbody id="vsCatalogTbody"></tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div aria-label="Vendor Onboarding Wizard" aria-modal="true" aria-hidden="true" class="vs-modal-backdrop" id="vsWizardBackdrop" role="dialog" style="display: none;">
<div class="vs-modal">
<header>
<div>
<h3>Vendor Onboarding Wizard</h3>
<div class="vs-muted">Build a vendor list by selecting your industry and tech stack. Takes 2â€“3 minutes.</div>
</div>
<button class="vs-close" onclick="VSUI.close('vsWizardBackdrop')">Close</button>
</header>
<div class="vs-body">
<div class="vs-stepper" id="vsWizardStepper"></div>
<div id="vsWizardContent" style="margin-top:14px"></div>
<div class="vs-row" style="justify-content:space-between;margin-top:14px">
<button class="vs-btn" onclick="VSUI.wizardPrev()">Back</button>
<div class="vs-row">
<button class="vs-btn" onclick="VSUI.wizardSkip()">Skip</button>
<button class="vs-btn primary" onclick="VSUI.wizardNext()">Next</button>
</div>
</div>
</div>
</div>
</div>
<div aria-label="API Integration Mockups" aria-modal="true" aria-hidden="true" class="vs-modal-backdrop" id="vsApiBackdrop" role="dialog" style="display: none;">
<div class="vs-modal">
<header>
<div>
<h3>API Integration Mockups</h3>
<div class="vs-muted">Buyer-facing â€œhow it would workâ€ previews for pulling vendor/app assignments from identity providers.</div>
</div>
<button class="vs-close" onclick="VSUI.close('vsApiBackdrop')">Close</button>
</header>
<div class="vs-body">
<div class="vs-grid">
<div class="vs-card">
<div class="vs-field">
<label>Select provider</label>
<select class="vs-select" id="vsApiProvider">
<option value="okta">Okta</option>
<option value="entra">Microsoft Entra ID</option>
<option value="google">Google Workspace</option>
<option value="ping">Ping Identity</option>
<option value="onelogin">OneLogin</option>
</select>
</div>
<div class="vs-field">
<label>What you would pull</label>
<div class="vs-row">
<span class="vs-pill">Assigned apps</span>
<span class="vs-pill">Groups</span>
<span class="vs-pill">SSO metadata</span>
<span class="vs-pill">Owners</span>
</div>
</div>
<div class="vs-alert">
            This is a <b>mock</b>. In production you would use OAuth / SCIM and only store the minimal vendor metadata needed for risk decisions.
          </div>
<div class="vs-row" style="margin-top:12px">
<button class="vs-btn primary" onclick="VSUI.previewApiMock()">Preview mock response</button>
<button class="vs-btn" onclick="VSUI.applyApiMock()">Apply to vendor list</button>
</div>
</div>
<div class="vs-card">
<div class="vs-muted" style="margin-bottom:8px">Example endpoints &amp; mapping (illustrative)</div>
<pre id="vsApiPreview" style="white-space:pre-wrap;line-height:1.35;border:1px solid rgba(127,127,127,.18);border-radius:14px;padding:12px;overflow:auto;max-height:56vh"></pre>
</div>
</div>
</div>
</div>
</div>
<script>
(function(){
  // ============================================================================
  // ENHANCED VENDOR CATALOG - 150+ Enterprise Vendors
  // ============================================================================
  // Note: This catalog is loaded from vendor-catalog-enhanced.js
  // For now, we'll use a script tag to load it, or convert VS_CATALOG format
  // The enhanced catalog provides richer data with SBOM info, data types, etc.
  
  // Helper function to convert enhanced catalog format to VS_CATALOG format
  function convertEnhancedToVSCatalog(enhancedVendor) {
    // Map sector to category for VS_CATALOG
    const sectorToCategory = {
      'Cloud Infrastructure': 'Cloud/Infrastructure',
      'SaaS': 'Collaboration & Productivity',
      'Collaboration': 'Collaboration & Productivity',
      'Security': 'Cybersecurity',
      'Identity & Access': 'Identity & Access',
      'Development Tools': 'DevOps & Engineering',
      'Marketing': 'CRM/Marketing',
      'Data Storage': 'Data & Analytics',
      'Business Intelligence': 'Data & Analytics',
      'HR & Payroll': 'HR & People Ops',
      'Payment Processing': 'Payments/Financial',
      'Fintech': 'Payments/Financial',
      'Accounting': 'Payments/Financial',
      'Compliance': 'GRC/Compliance',
      'Telecommunications': 'CRM/Marketing',
      'Other': 'Other'
    };
    
    // Determine industries based on vendor characteristics
    const industries = ['All'];
    if (enhancedVendor.dataTypes && enhancedVendor.dataTypes.includes('PHI')) {
      industries.push('Healthcare');
    }
    if (enhancedVendor.dataTypes && (enhancedVendor.dataTypes.includes('Financial') || enhancedVendor.sector === 'Payment Processing')) {
      industries.push('Financial Services');
    }
    if (enhancedVendor.sector === 'Development Tools' || enhancedVendor.sector === 'Data Storage') {
      industries.push('Technology');
    }
    if (enhancedVendor.sector === 'Marketing' || enhancedVendor.sector === 'Payment Processing') {
      industries.push('Retail');
    }
    
    return {
      name: enhancedVendor.name,
      industries: industries,
      category: sectorToCategory[enhancedVendor.sector] || enhancedVendor.sector,
      providesSoftware: enhancedVendor.sbom ? enhancedVendor.sbom.providesSoftware : true,
      notes: enhancedVendor.notes || ''
    };
  }
  
  // Enhanced catalog helper functions (will be populated from vendor-catalog-enhanced.js if available)
  function getAllVendorsFromCatalog() {
    if (typeof ENTERPRISE_VENDOR_CATALOG !== 'undefined') {
      const allVendors = [];
      for (const category in ENTERPRISE_VENDOR_CATALOG) {
        allVendors.push(...ENTERPRISE_VENDOR_CATALOG[category]);
      }
      return allVendors.map(v => ({
        ...v,
        id: (typeof generateId === 'function') ? generateId() : Math.random().toString(36).slice(2)
      }));
    }
    return [];
  }
  
  function getVendorsByIndustry(industry) {
    if (typeof ENTERPRISE_VENDOR_CATALOG === 'undefined') return [];
    
    const industryMappings = {
      healthcare: ['cloudInfrastructure', 'securityIdentity', 'hrPayroll', 'complianceGov', 'productivitySaaS'],
      financial: ['cloudInfrastructure', 'securityIdentity', 'paymentFintech', 'accountingFinance', 'complianceGov'],
      retail: ['cloudInfrastructure', 'paymentFintech', 'crmSales', 'marketingAnalytics', 'productivitySaaS'],
      manufacturing: ['cloudInfrastructure', 'securityIdentity', 'hrPayroll', 'developmentTools', 'businessIntelligence'],
      technology: ['cloudInfrastructure', 'developmentTools', 'securityIdentity', 'databases', 'productivitySaaS'],
      education: ['productivitySaaS', 'cloudInfrastructure', 'securityIdentity', 'customerSupport', 'documentManagement']
    };
    
    const categories = industryMappings[industry.toLowerCase()] || Object.keys(ENTERPRISE_VENDOR_CATALOG);
    const vendors = [];
    
    categories.forEach(cat => {
      if (ENTERPRISE_VENDOR_CATALOG[cat]) {
        vendors.push(...ENTERPRISE_VENDOR_CATALOG[cat]);
      }
    });
    
    return vendors.map(v => ({
      ...v,
      id: (typeof generateId === 'function') ? generateId() : Math.random().toString(36).slice(2)
    }));
  }
  
  function getStarterVendorSet() {
    if (typeof ENTERPRISE_VENDOR_CATALOG === 'undefined') return [];
    
    return [
      ...(ENTERPRISE_VENDOR_CATALOG.cloudInfrastructure || []).slice(0, 3),
      ...(ENTERPRISE_VENDOR_CATALOG.productivitySaaS || []).slice(0, 5),
      ...(ENTERPRISE_VENDOR_CATALOG.securityIdentity || []).slice(0, 3),
      ...(ENTERPRISE_VENDOR_CATALOG.hrPayroll || []).slice(0, 2),
      ...(ENTERPRISE_VENDOR_CATALOG.crmSales || []).slice(0, 2),
      ...(ENTERPRISE_VENDOR_CATALOG.developmentTools || []).slice(0, 2)
    ].map(v => ({
      ...v,
      id: (typeof generateId === 'function') ? generateId() : Math.random().toString(36).slice(2)
    }));
  }
  
  // Expose helper functions globally
  window.getAllVendorsFromCatalog = getAllVendorsFromCatalog;
  window.getVendorsByIndustry = getVendorsByIndustry;
  window.getStarterVendorSet = getStarterVendorSet;
  
  const VS_CATALOG = [{"name": "Amazon Web Services (AWS)", "industries": ["All", "Financial Services", "Retail", "Technology"], "category": "Cloud/Infrastructure", "providesSoftware": true, "notes": ""}, {"name": "Microsoft Azure", "industries": ["All", "Financial Services", "Retail", "Technology"], "category": "Cloud/Infrastructure", "providesSoftware": true, "notes": ""}, {"name": "Google Cloud Platform (GCP)", "industries": ["All", "Financial Services", "Retail", "Technology"], "category": "Cloud/Infrastructure", "providesSoftware": true, "notes": ""}, {"name": "Cloudflare", "industries": ["All", "Financial Services", "Retail", "Technology"], "category": "Cloud/Infrastructure", "providesSoftware": true, "notes": ""}, {"name": "Akamai", "industries": ["All", "Financial Services", "Retail", "Technology"], "category": "Cloud/Infrastructure", "providesSoftware": true, "notes": ""}, {"name": "DigitalOcean", "industries": ["All", "Financial Services", "Retail", "Technology"], "category": "Cloud/Infrastructure", "providesSoftware": true, "notes": ""}, {"name": "Oracle Cloud", "industries": ["All", "Financial Services", "Retail", "Technology"], "category": "Cloud/Infrastructure", "providesSoftware": true, "notes": ""}, {"name": "IBM Cloud", "industries": ["All", "Financial Services", "Retail", "Technology"], "category": "Cloud/Infrastructure", "providesSoftware": true, "notes": ""}, {"name": "Okta", "industries": ["All", "Financial Services", "Healthcare", "Technology"], "category": "Identity & Access", "providesSoftware": true, "notes": ""}, {"name": "Microsoft Entra ID (Azure AD)", "industries": ["All", "Financial Services", "Healthcare", "Technology"], "category": "Identity & Access", "providesSoftware": true, "notes": ""}, {"name": "Google Workspace", "industries": ["All", "Financial Services", "Healthcare", "Technology"], "category": "Identity & Access", "providesSoftware": true, "notes": ""}, {"name": "Ping Identity", "industries": ["All", "Financial Services", "Healthcare", "Technology"], "category": "Identity & Access", "providesSoftware": true, "notes": ""}, {"name": "OneLogin", "industries": ["All", "Financial Services", "Healthcare", "Technology"], "category": "Identity & Access", "providesSoftware": true, "notes": ""}, {"name": "Duo Security", "industries": ["All", "Financial Services", "Healthcare", "Technology"], "category": "Identity & Access", "providesSoftware": true, "notes": ""}, {"name": "Auth0", "industries": ["All", "Financial Services", "Healthcare", "Technology"], "category": "Identity & Access", "providesSoftware": true, "notes": ""}, {"name": "CyberArk", "industries": ["All", "Financial Services", "Healthcare", "Technology"], "category": "Identity & Access", "providesSoftware": true, "notes": ""}, {"name": "Microsoft 365", "industries": ["All"], "category": "Collaboration & Productivity", "providesSoftware": true, "notes": ""}, {"name": "Google Workspace", "industries": ["All"], "category": "Collaboration & Productivity", "providesSoftware": true, "notes": ""}, {"name": "Slack", "industries": ["All"], "category": "Collaboration & Productivity", "providesSoftware": true, "notes": ""}, {"name": "Zoom", "industries": ["All"], "category": "Collaboration & Productivity", "providesSoftware": true, "notes": ""}, {"name": "Cisco Webex", "industries": ["All"], "category": "Collaboration & Productivity", "providesSoftware": true, "notes": ""}, {"name": "Atlassian", "industries": ["All"], "category": "Collaboration & Productivity", "providesSoftware": true, "notes": ""}, {"name": "Notion", "industries": ["All"], "category": "Collaboration & Productivity", "providesSoftware": true, "notes": ""}, {"name": "Box", "industries": ["All"], "category": "Collaboration & Productivity", "providesSoftware": true, "notes": ""}, {"name": "Dropbox", "industries": ["All"], "category": "Collaboration & Productivity", "providesSoftware": true, "notes": ""}, {"name": "SharePoint", "industries": ["All"], "category": "Collaboration & Productivity", "providesSoftware": true, "notes": ""}, {"name": "Confluence", "industries": ["All"], "category": "Collaboration & Productivity", "providesSoftware": true, "notes": ""}, {"name": "Jira", "industries": ["All"], "category": "Collaboration & Productivity", "providesSoftware": true, "notes": ""}, {"name": "CrowdStrike", "industries": ["All", "Financial Services", "Healthcare", "Technology"], "category": "Cybersecurity", "providesSoftware": true, "notes": ""}, {"name": "Palo Alto Networks", "industries": ["All", "Financial Services", "Healthcare", "Technology"], "category": "Cybersecurity", "providesSoftware": true, "notes": ""}, {"name": "Fortinet", "industries": ["All", "Financial Services", "Healthcare", "Technology"], "category": "Cybersecurity", "providesSoftware": true, "notes": ""}, {"name": "Check Point", "industries": ["All", "Financial Services", "Healthcare", "Technology"], "category": "Cybersecurity", "providesSoftware": true, "notes": ""}, {"name": "Zscaler", "industries": ["All", "Financial Services", "Healthcare", "Technology"], "category": "Cybersecurity", "providesSoftware": true, "notes": ""}, {"name": "Proofpoint", "industries": ["All", "Financial Services", "Healthcare", "Technology"], "category": "Cybersecurity", "providesSoftware": true, "notes": ""}, {"name": "Mimecast", "industries": ["All", "Financial Services", "Healthcare", "Technology"], "category": "Cybersecurity", "providesSoftware": true, "notes": ""}, {"name": "Splunk", "industries": ["All", "Financial Services", "Healthcare", "Technology"], "category": "Cybersecurity", "providesSoftware": true, "notes": ""}, {"name": "Snyk", "industries": ["All", "Financial Services", "Healthcare", "Technology"], "category": "Cybersecurity", "providesSoftware": true, "notes": ""}, {"name": "Tenable", "industries": ["All", "Financial Services", "Healthcare", "Technology"], "category": "Cybersecurity", "providesSoftware": true, "notes": ""}, {"name": "Qualys", "industries": ["All", "Financial Services", "Healthcare", "Technology"], "category": "Cybersecurity", "providesSoftware": true, "notes": ""}, {"name": "Rapid7", "industries": ["All", "Financial Services", "Healthcare", "Technology"], "category": "Cybersecurity", "providesSoftware": true, "notes": ""}, {"name": "SentinelOne", "industries": ["All", "Financial Services", "Healthcare", "Technology"], "category": "Cybersecurity", "providesSoftware": true, "notes": ""}, {"name": "Sophos", "industries": ["All", "Financial Services", "Healthcare", "Technology"], "category": "Cybersecurity", "providesSoftware": true, "notes": ""}, {"name": "Trend Micro", "industries": ["All", "Financial Services", "Healthcare", "Technology"], "category": "Cybersecurity", "providesSoftware": true, "notes": ""}, {"name": "Datadog Security", "industries": ["All", "Financial Services", "Healthcare", "Technology"], "category": "Cybersecurity", "providesSoftware": true, "notes": ""}, {"name": "Microsoft Defender", "industries": ["All", "Financial Services", "Healthcare", "Technology"], "category": "Cybersecurity", "providesSoftware": true, "notes": ""}, {"name": "AWS GuardDuty", "industries": ["All", "Financial Services", "Healthcare", "Technology"], "category": "Cybersecurity", "providesSoftware": true, "notes": ""}, {"name": "GitHub", "industries": ["Technology", "All"], "category": "DevOps & Engineering", "providesSoftware": true, "notes": ""}, {"name": "GitLab", "industries": ["Technology", "All"], "category": "DevOps & Engineering", "providesSoftware": true, "notes": ""}, {"name": "Bitbucket", "industries": ["Technology", "All"], "category": "DevOps & Engineering", "providesSoftware": true, "notes": ""}, {"name": "CircleCI", "industries": ["Technology", "All"], "category": "DevOps & Engineering", "providesSoftware": true, "notes": ""}, {"name": "Jenkins", "industries": ["Technology", "All"], "category": "DevOps & Engineering", "providesSoftware": true, "notes": ""}, {"name": "Docker", "industries": ["Technology", "All"], "category": "DevOps & Engineering", "providesSoftware": true, "notes": ""}, {"name": "Kubernetes", "industries": ["Technology", "All"], "category": "DevOps & Engineering", "providesSoftware": true, "notes": ""}, {"name": "HashiCorp", "industries": ["Technology", "All"], "category": "DevOps & Engineering", "providesSoftware": true, "notes": ""}, {"name": "Terraform Cloud", "industries": ["Technology", "All"], "category": "DevOps & Engineering", "providesSoftware": true, "notes": ""}, {"name": "Vercel", "industries": ["Technology", "All"], "category": "DevOps & Engineering", "providesSoftware": true, "notes": ""}, {"name": "Netlify", "industries": ["Technology", "All"], "category": "DevOps & Engineering", "providesSoftware": true, "notes": ""}, {"name": "Sentry", "industries": ["Technology", "All"], "category": "DevOps & Engineering", "providesSoftware": true, "notes": ""}, {"name": "Datadog", "industries": ["Technology", "All"], "category": "DevOps & Engineering", "providesSoftware": true, "notes": ""}, {"name": "New Relic", "industries": ["Technology", "All"], "category": "DevOps & Engineering", "providesSoftware": true, "notes": ""}, {"name": "PagerDuty", "industries": ["Technology", "All"], "category": "DevOps & Engineering", "providesSoftware": true, "notes": ""}, {"name": "ServiceNow", "industries": ["Technology", "All"], "category": "DevOps & Engineering", "providesSoftware": true, "notes": ""}, {"name": "Zendesk", "industries": ["Technology", "All"], "category": "DevOps & Engineering", "providesSoftware": true, "notes": ""}, {"name": "Stripe", "industries": ["Financial Services", "Retail", "All"], "category": "Payments/Financial", "providesSoftware": true, "notes": ""}, {"name": "PayPal", "industries": ["Financial Services", "Retail", "All"], "category": "Payments/Financial", "providesSoftware": true, "notes": ""}, {"name": "Square", "industries": ["Financial Services", "Retail", "All"], "category": "Payments/Financial", "providesSoftware": true, "notes": ""}, {"name": "Adyen", "industries": ["Financial Services", "Retail", "All"], "category": "Payments/Financial", "providesSoftware": true, "notes": ""}, {"name": "Fiserv", "industries": ["Financial Services", "Retail", "All"], "category": "Payments/Financial", "providesSoftware": true, "notes": ""}, {"name": "Worldpay", "industries": ["Financial Services", "Retail", "All"], "category": "Payments/Financial", "providesSoftware": true, "notes": ""}, {"name": "Visa", "industries": ["Financial Services", "Retail", "All"], "category": "Payments/Financial", "providesSoftware": true, "notes": ""}, {"name": "Mastercard", "industries": ["Financial Services", "Retail", "All"], "category": "Payments/Financial", "providesSoftware": true, "notes": ""}, {"name": "American Express", "industries": ["Financial Services", "Retail", "All"], "category": "Payments/Financial", "providesSoftware": true, "notes": ""}, {"name": "JPMorgan Chase", "industries": ["Financial Services", "Retail", "All"], "category": "Payments/Financial", "providesSoftware": true, "notes": ""}, {"name": "Bank of America", "industries": ["Financial Services", "Retail", "All"], "category": "Payments/Financial", "providesSoftware": true, "notes": ""}, {"name": "Wells Fargo", "industries": ["Financial Services", "Retail", "All"], "category": "Payments/Financial", "providesSoftware": true, "notes": ""}, {"name": "HSBC", "industries": ["Financial Services", "Retail", "All"], "category": "Payments/Financial", "providesSoftware": true, "notes": ""}, {"name": "Citibank", "industries": ["Financial Services", "Retail", "All"], "category": "Payments/Financial", "providesSoftware": true, "notes": ""}, {"name": "Wise", "industries": ["Financial Services", "Retail", "All"], "category": "Payments/Financial", "providesSoftware": true, "notes": ""}, {"name": "Payoneer", "industries": ["Financial Services", "Retail", "All"], "category": "Payments/Financial", "providesSoftware": true, "notes": ""}, {"name": "Workday", "industries": ["All", "Healthcare", "Financial Services"], "category": "HR & People Ops", "providesSoftware": true, "notes": ""}, {"name": "ADP", "industries": ["All", "Healthcare", "Financial Services"], "category": "HR & People Ops", "providesSoftware": true, "notes": ""}, {"name": "Paychex", "industries": ["All", "Healthcare", "Financial Services"], "category": "HR & People Ops", "providesSoftware": true, "notes": ""}, {"name": "BambooHR", "industries": ["All", "Healthcare", "Financial Services"], "category": "HR & People Ops", "providesSoftware": true, "notes": ""}, {"name": "Gusto", "industries": ["All", "Healthcare", "Financial Services"], "category": "HR & People Ops", "providesSoftware": true, "notes": ""}, {"name": "UKG", "industries": ["All", "Healthcare", "Financial Services"], "category": "HR & People Ops", "providesSoftware": true, "notes": ""}, {"name": "SAP SuccessFactors", "industries": ["All", "Healthcare", "Financial Services"], "category": "HR & People Ops", "providesSoftware": true, "notes": ""}, {"name": "Oracle HCM", "industries": ["All", "Healthcare", "Financial Services"], "category": "HR & People Ops", "providesSoftware": true, "notes": ""}, {"name": "Greenhouse", "industries": ["All", "Healthcare", "Financial Services"], "category": "HR & People Ops", "providesSoftware": true, "notes": ""}, {"name": "Lever", "industries": ["All", "Healthcare", "Financial Services"], "category": "HR & People Ops", "providesSoftware": true, "notes": ""}, {"name": "LinkedIn Talent Solutions", "industries": ["All", "Healthcare", "Financial Services"], "category": "HR & People Ops", "providesSoftware": true, "notes": ""}, {"name": "Salesforce", "industries": ["Retail", "All", "Technology"], "category": "CRM/Marketing", "providesSoftware": true, "notes": ""}, {"name": "HubSpot", "industries": ["Retail", "All", "Technology"], "category": "CRM/Marketing", "providesSoftware": true, "notes": ""}, {"name": "Marketo", "industries": ["Retail", "All", "Technology"], "category": "CRM/Marketing", "providesSoftware": true, "notes": ""}, {"name": "Mailchimp", "industries": ["Retail", "All", "Technology"], "category": "CRM/Marketing", "providesSoftware": true, "notes": ""}, {"name": "Klaviyo", "industries": ["Retail", "All", "Technology"], "category": "CRM/Marketing", "providesSoftware": true, "notes": ""}, {"name": "Zendesk", "industries": ["Retail", "All", "Technology"], "category": "CRM/Marketing", "providesSoftware": true, "notes": ""}, {"name": "Intercom", "industries": ["Retail", "All", "Technology"], "category": "CRM/Marketing", "providesSoftware": true, "notes": ""}, {"name": "Twilio", "industries": ["Retail", "All", "Technology"], "category": "CRM/Marketing", "providesSoftware": true, "notes": ""}, {"name": "SendGrid", "industries": ["Retail", "All", "Technology"], "category": "CRM/Marketing", "providesSoftware": true, "notes": ""}, {"name": "Postmark", "industries": ["Retail", "All", "Technology"], "category": "CRM/Marketing", "providesSoftware": true, "notes": ""}, {"name": "Braze", "industries": ["Retail", "All", "Technology"], "category": "CRM/Marketing", "providesSoftware": true, "notes": ""}, {"name": "Sprout Social", "industries": ["Retail", "All", "Technology"], "category": "CRM/Marketing", "providesSoftware": true, "notes": ""}, {"name": "Hootsuite", "industries": ["Retail", "All", "Technology"], "category": "CRM/Marketing", "providesSoftware": true, "notes": ""}, {"name": "Google Ads", "industries": ["Retail", "All", "Technology"], "category": "CRM/Marketing", "providesSoftware": true, "notes": ""}, {"name": "Meta Ads", "industries": ["Retail", "All", "Technology"], "category": "CRM/Marketing", "providesSoftware": true, "notes": ""}, {"name": "Snowflake", "industries": ["All", "Technology", "Retail", "Financial Services"], "category": "Data & Analytics", "providesSoftware": true, "notes": ""}, {"name": "Databricks", "industries": ["All", "Technology", "Retail", "Financial Services"], "category": "Data & Analytics", "providesSoftware": true, "notes": ""}, {"name": "Tableau", "industries": ["All", "Technology", "Retail", "Financial Services"], "category": "Data & Analytics", "providesSoftware": true, "notes": ""}, {"name": "Power BI", "industries": ["All", "Technology", "Retail", "Financial Services"], "category": "Data & Analytics", "providesSoftware": true, "notes": ""}, {"name": "Looker", "industries": ["All", "Technology", "Retail", "Financial Services"], "category": "Data & Analytics", "providesSoftware": true, "notes": ""}, {"name": "Segment", "industries": ["All", "Technology", "Retail", "Financial Services"], "category": "Data & Analytics", "providesSoftware": true, "notes": ""}, {"name": "Amplitude", "industries": ["All", "Technology", "Retail", "Financial Services"], "category": "Data & Analytics", "providesSoftware": true, "notes": ""}, {"name": "Mixpanel", "industries": ["All", "Technology", "Retail", "Financial Services"], "category": "Data & Analytics", "providesSoftware": true, "notes": ""}, {"name": "Google Analytics", "industries": ["All", "Technology", "Retail", "Financial Services"], "category": "Data & Analytics", "providesSoftware": true, "notes": ""}, {"name": "Plausible", "industries": ["All", "Technology", "Retail", "Financial Services"], "category": "Data & Analytics", "providesSoftware": true, "notes": ""}, {"name": "Umami", "industries": ["All", "Technology", "Retail", "Financial Services"], "category": "Data & Analytics", "providesSoftware": true, "notes": ""}, {"name": "Elastic", "industries": ["All", "Technology", "Retail", "Financial Services"], "category": "Data & Analytics", "providesSoftware": true, "notes": ""}, {"name": "MongoDB Atlas", "industries": ["All", "Technology", "Retail", "Financial Services"], "category": "Data & Analytics", "providesSoftware": true, "notes": ""}, {"name": "PostgreSQL (managed)", "industries": ["All", "Technology", "Retail", "Financial Services"], "category": "Data & Analytics", "providesSoftware": true, "notes": ""}, {"name": "BigQuery", "industries": ["All", "Technology", "Retail", "Financial Services"], "category": "Data & Analytics", "providesSoftware": true, "notes": ""}, {"name": "Redshift", "industries": ["All", "Technology", "Retail", "Financial Services"], "category": "Data & Analytics", "providesSoftware": true, "notes": ""}, {"name": "Backblaze", "industries": ["All"], "category": "Backup & Recovery", "providesSoftware": true, "notes": ""}, {"name": "Wasabi", "industries": ["All"], "category": "Backup & Recovery", "providesSoftware": true, "notes": ""}, {"name": "Veeam", "industries": ["All"], "category": "Backup & Recovery", "providesSoftware": true, "notes": ""}, {"name": "Rubrik", "industries": ["All"], "category": "Backup & Recovery", "providesSoftware": true, "notes": ""}, {"name": "Cohesity", "industries": ["All"], "category": "Backup & Recovery", "providesSoftware": true, "notes": ""}, {"name": "Commvault", "industries": ["All"], "category": "Backup & Recovery", "providesSoftware": true, "notes": ""}, {"name": "Carbonite", "industries": ["All"], "category": "Backup & Recovery", "providesSoftware": true, "notes": ""}, {"name": "Barracuda Backup", "industries": ["All"], "category": "Backup & Recovery", "providesSoftware": true, "notes": ""}, {"name": "Epic Systems", "industries": ["Healthcare"], "category": "Healthcare IT", "providesSoftware": true, "notes": ""}, {"name": "Cerner (Oracle Health)", "industries": ["Healthcare"], "category": "Healthcare IT", "providesSoftware": true, "notes": ""}, {"name": "athenahealth", "industries": ["Healthcare"], "category": "Healthcare IT", "providesSoftware": true, "notes": ""}, {"name": "Meditech", "industries": ["Healthcare"], "category": "Healthcare IT", "providesSoftware": true, "notes": ""}, {"name": "Teladoc Health", "industries": ["Healthcare"], "category": "Healthcare IT", "providesSoftware": true, "notes": ""}, {"name": "Change Healthcare", "industries": ["Healthcare"], "category": "Healthcare IT", "providesSoftware": true, "notes": ""}, {"name": "McKesson", "industries": ["Healthcare"], "category": "Healthcare IT", "providesSoftware": true, "notes": ""}, {"name": "Cardinal Health", "industries": ["Healthcare"], "category": "Healthcare IT", "providesSoftware": true, "notes": ""}, {"name": "Philips Healthcare IT", "industries": ["Healthcare"], "category": "Healthcare IT", "providesSoftware": true, "notes": ""}, {"name": "Bloomberg", "industries": ["Financial Services"], "category": "Financial Platforms", "providesSoftware": true, "notes": ""}, {"name": "Refinitiv (LSEG)", "industries": ["Financial Services"], "category": "Financial Platforms", "providesSoftware": true, "notes": ""}, {"name": "FIS", "industries": ["Financial Services"], "category": "Financial Platforms", "providesSoftware": true, "notes": ""}, {"name": "Finastra", "industries": ["Financial Services"], "category": "Financial Platforms", "providesSoftware": true, "notes": ""}, {"name": "Temenos", "industries": ["Financial Services"], "category": "Financial Platforms", "providesSoftware": true, "notes": ""}, {"name": "Jack Henry", "industries": ["Financial Services"], "category": "Financial Platforms", "providesSoftware": true, "notes": ""}, {"name": "SS&C Technologies", "industries": ["Financial Services"], "category": "Financial Platforms", "providesSoftware": true, "notes": ""}, {"name": "Broadridge", "industries": ["Financial Services"], "category": "Financial Platforms", "providesSoftware": true, "notes": ""}, {"name": "Moody's Analytics", "industries": ["Financial Services"], "category": "Financial Platforms", "providesSoftware": true, "notes": ""}, {"name": "S&P Global", "industries": ["Financial Services"], "category": "Financial Platforms", "providesSoftware": true, "notes": ""}, {"name": "Shopify", "industries": ["Retail"], "category": "Retail & eCommerce", "providesSoftware": true, "notes": ""}, {"name": "Magento (Adobe Commerce)", "industries": ["Retail"], "category": "Retail & eCommerce", "providesSoftware": true, "notes": ""}, {"name": "BigCommerce", "industries": ["Retail"], "category": "Retail & eCommerce", "providesSoftware": true, "notes": ""}, {"name": "Amazon Marketplace", "industries": ["Retail"], "category": "Retail & eCommerce", "providesSoftware": true, "notes": ""}, {"name": "Walmart Marketplace", "industries": ["Retail"], "category": "Retail & eCommerce", "providesSoftware": true, "notes": ""}, {"name": "Instacart", "industries": ["Retail"], "category": "Retail & eCommerce", "providesSoftware": true, "notes": ""}, {"name": "DoorDash", "industries": ["Retail"], "category": "Retail & eCommerce", "providesSoftware": true, "notes": ""}, {"name": "Uber Eats", "industries": ["Retail"], "category": "Retail & eCommerce", "providesSoftware": true, "notes": ""}, {"name": "Oracle Retail", "industries": ["Retail"], "category": "Retail & eCommerce", "providesSoftware": true, "notes": ""}, {"name": "NCR Voyix", "industries": ["Retail"], "category": "Retail & eCommerce", "providesSoftware": true, "notes": ""}, {"name": "SAP", "industries": ["Retail", "Manufacturing", "All"], "category": "Supply Chain & ERP", "providesSoftware": true, "notes": ""}, {"name": "Oracle", "industries": ["Retail", "Manufacturing", "All"], "category": "Supply Chain & ERP", "providesSoftware": true, "notes": ""}, {"name": "Microsoft Dynamics 365", "industries": ["Retail", "Manufacturing", "All"], "category": "Supply Chain & ERP", "providesSoftware": true, "notes": ""}, {"name": "Infor", "industries": ["Retail", "Manufacturing", "All"], "category": "Supply Chain & ERP", "providesSoftware": true, "notes": ""}, {"name": "Manhattan Associates", "industries": ["Retail", "Manufacturing", "All"], "category": "Supply Chain & ERP", "providesSoftware": true, "notes": ""}, {"name": "Blue Yonder", "industries": ["Retail", "Manufacturing", "All"], "category": "Supply Chain & ERP", "providesSoftware": true, "notes": ""}, {"name": "Coupa", "industries": ["Retail", "Manufacturing", "All"], "category": "Supply Chain & ERP", "providesSoftware": true, "notes": ""}, {"name": "Ariba (SAP)", "industries": ["Retail", "Manufacturing", "All"], "category": "Supply Chain & ERP", "providesSoftware": true, "notes": ""}, {"name": "DHL", "industries": ["Retail", "Manufacturing", "All"], "category": "Supply Chain & ERP", "providesSoftware": true, "notes": ""}, {"name": "FedEx", "industries": ["Retail", "Manufacturing", "All"], "category": "Supply Chain & ERP", "providesSoftware": true, "notes": ""}, {"name": "UPS", "industries": ["Retail", "Manufacturing", "All"], "category": "Supply Chain & ERP", "providesSoftware": true, "notes": ""}, {"name": "DocuSign", "industries": ["All", "Technology", "Financial Services"], "category": "GRC/Compliance", "providesSoftware": true, "notes": ""}, {"name": "Adobe Acrobat Sign", "industries": ["All", "Technology", "Financial Services"], "category": "GRC/Compliance", "providesSoftware": true, "notes": ""}, {"name": "Ironclad", "industries": ["All", "Technology", "Financial Services"], "category": "GRC/Compliance", "providesSoftware": true, "notes": ""}, {"name": "OneTrust", "industries": ["All", "Technology", "Financial Services"], "category": "GRC/Compliance", "providesSoftware": true, "notes": ""}, {"name": "TrustArc", "industries": ["All", "Technology", "Financial Services"], "category": "GRC/Compliance", "providesSoftware": true, "notes": ""}, {"name": "Vanta", "industries": ["All", "Technology", "Financial Services"], "category": "GRC/Compliance", "providesSoftware": true, "notes": ""}, {"name": "Drata", "industries": ["All", "Technology", "Financial Services"], "category": "GRC/Compliance", "providesSoftware": true, "notes": ""}, {"name": "Secureframe", "industries": ["All", "Technology", "Financial Services"], "category": "GRC/Compliance", "providesSoftware": true, "notes": ""}, {"name": "Tugboat Logic", "industries": ["All", "Technology", "Financial Services"], "category": "GRC/Compliance", "providesSoftware": true, "notes": ""}, {"name": "LogicGate", "industries": ["All", "Technology", "Financial Services"], "category": "GRC/Compliance", "providesSoftware": true, "notes": ""}, {"name": "Intune", "industries": ["All"], "category": "IT Management", "providesSoftware": true, "notes": ""}, {"name": "Jamf", "industries": ["All"], "category": "IT Management", "providesSoftware": true, "notes": ""}, {"name": "Kandji", "industries": ["All"], "category": "IT Management", "providesSoftware": true, "notes": ""}, {"name": "Ivanti", "industries": ["All"], "category": "IT Management", "providesSoftware": true, "notes": ""}, {"name": "ManageEngine", "industries": ["All"], "category": "IT Management", "providesSoftware": true, "notes": ""}, {"name": "Lansweeper", "industries": ["All"], "category": "IT Management", "providesSoftware": true, "notes": ""}, {"name": "SolarWinds", "industries": ["All"], "category": "IT Management", "providesSoftware": true, "notes": ""}, {"name": "CrowdStrike Falcon Complete", "industries": ["All"], "category": "IT Management", "providesSoftware": true, "notes": ""}, {"name": "Genesys", "industries": ["All", "Retail", "Financial Services"], "category": "Contact Center", "providesSoftware": true, "notes": ""}, {"name": "Five9", "industries": ["All", "Retail", "Financial Services"], "category": "Contact Center", "providesSoftware": true, "notes": ""}, {"name": "Nice CXone", "industries": ["All", "Retail", "Financial Services"], "category": "Contact Center", "providesSoftware": true, "notes": ""}];
  const VS_TEMPLATES = {"Healthcare": {"Identity & Access": ["Okta", "Microsoft Entra ID (Azure AD)", "Duo Security"], "Cloud/Infrastructure": ["Microsoft Azure", "Amazon Web Services (AWS)", "Google Cloud Platform (GCP)"], "Collaboration & Productivity": ["Microsoft 365", "Google Workspace", "Zoom"], "Healthcare IT": ["Epic Systems", "Cerner (Oracle Health)", "athenahealth"], "Cybersecurity": ["CrowdStrike", "Palo Alto Networks", "Proofpoint", "Tenable"], "GRC/Compliance": ["OneTrust", "Vanta", "Drata"]}, "Financial Services": {"Identity & Access": ["Okta", "Microsoft Entra ID (Azure AD)", "Ping Identity"], "Cloud/Infrastructure": ["Microsoft Azure", "Amazon Web Services (AWS)", "Google Cloud Platform (GCP)"], "Collaboration & Productivity": ["Microsoft 365", "Slack", "Zoom"], "Financial Platforms": ["Bloomberg", "FIS", "Finastra", "Moody's Analytics"], "Payments/Financial": ["Stripe", "Visa", "Mastercard"], "Cybersecurity": ["Palo Alto Networks", "CrowdStrike", "Zscaler", "Splunk", "Snyk"], "GRC/Compliance": ["OneTrust", "LogicGate", "Vanta"]}, "Retail": {"Identity & Access": ["Okta", "Google Workspace", "Duo Security"], "Cloud/Infrastructure": ["Amazon Web Services (AWS)", "Google Cloud Platform (GCP)", "Cloudflare"], "Retail & eCommerce": ["Shopify", "BigCommerce", "Magento (Adobe Commerce)", "NCR Voyix"], "Payments/Financial": ["Stripe", "PayPal", "Square", "Adyen"], "CRM/Marketing": ["Salesforce", "HubSpot", "Klaviyo", "Mailchimp"], "Cybersecurity": ["CrowdStrike", "Proofpoint", "Zscaler"], "Supply Chain & ERP": ["SAP", "Oracle", "Coupa", "DHL"]}, "Technology": {"Identity & Access": ["Okta", "Auth0", "Microsoft Entra ID (Azure AD)"], "Cloud/Infrastructure": ["Amazon Web Services (AWS)", "Google Cloud Platform (GCP)", "Microsoft Azure", "Cloudflare"], "DevOps & Engineering": ["GitHub", "GitLab", "Docker", "Kubernetes", "Terraform Cloud", "Vercel", "Netlify"], "Data & Analytics": ["Snowflake", "Databricks", "Looker", "Segment"], "Cybersecurity": ["Snyk", "CrowdStrike", "Tenable", "Rapid7"], "Collaboration & Productivity": ["Slack", "Atlassian", "Notion"]}};
  const DEMO_LIMIT = 25;  // Updated to match user journey spec
  const REQUIRED_COLS = ['name','category','dataTypes','sector','location','contact','notes','sbomAvailable','sbomFormat','providesSoftware'];

  function normalize(s){ return String(s||'').trim(); }
  function slug(s){ return normalize(s).toLowerCase(); }
  function escapeHtml(str){ return String(str).replace(/[&<>"']/g, (m)=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

  function ensureToolbarButtons(){
    const toolbar = document.querySelector('.toolbar');
    if(!toolbar) return;
    if(document.getElementById('vsBtnCatalog')) return;

    const group = document.createElement('div');
    group.className = 'toolbar-group';
    group.style.gap = '10px';
    group.innerHTML = `
      <button id="vsBtnTemplate" onclick="VSUI.downloadTemplate()">CSV Template</button>
      <button id="vsBtnCatalog" onclick="VSUI.open('vsCatalogBackdrop')">Catalog</button>
      <button id="vsBtnWizard" onclick="VSUI.open('vsWizardBackdrop')">Onboarding Wizard</button>
      <button id="vsBtnApi" onclick="VSUI.open('vsApiBackdrop')">API Mockups</button>
    `;
    toolbar.prepend(group);
  }

  function buildCategoryOptions(){
    const sel = document.getElementById('vsCatalogCategory');
    if(!sel) return;
    const cats = Array.from(new Set(VS_CATALOG.map(v=>v.category))).sort();
    sel.innerHTML = '<option value="All">All</option>' + cats.map(c=>`<option value="${escapeHtml(c)}">${escapeHtml(c)}</option>`).join('');
  }

  const selection = new Set();

  function renderCatalog(){
    const q = slug(document.getElementById('vsCatalogSearch')?.value);
    const ind = document.getElementById('vsCatalogIndustry')?.value || 'All';
    const cat = document.getElementById('vsCatalogCategory')?.value || 'All';

    const rows = VS_CATALOG.filter(v=>{
      const hit = !q || slug(v.name).includes(q) || slug(v.category).includes(q) || (v.industries||[]).some(x=>slug(x).includes(q));
      const indHit = ind==='All' || (v.industries||[]).includes('All') || (v.industries||[]).includes(ind);
      const catHit = cat==='All' || v.category===cat;
      return hit && indHit && catHit;
    });

    const tbody = document.getElementById('vsCatalogTbody');
    if(!tbody) return;
    tbody.innerHTML = rows.map(v=>{
      const key = v.name;
      const checked = selection.has(key) ? 'checked' : '';
      const industries = (v.industries||[]).slice(0,4).join(', ') + ((v.industries||[]).length>4 ? 'â€¦' : '');
      return `
        <tr>
          <td><input type="checkbox" data-vs-name="${escapeHtml(key)}" ${checked} onchange="VSUI.toggleCatalogSelection(this)" /></td>
          <td><b>${escapeHtml(v.name)}</b><div class="vs-muted">${escapeHtml(v.notes||'')}</div></td>
          <td>${escapeHtml(v.category)}</td>
          <td class="vs-muted">${escapeHtml(industries)}</td>
          <td><button class="vs-btn primary" onclick="VSUI.addVendorFromCatalog('${escapeHtml(key)}')">Add</button></td>
        </tr>
      `;
    }).join('');

    const countEl = document.getElementById('vsCatalogCount');
    if(countEl) countEl.textContent = String(rows.length);
    const selEl = document.getElementById('vsCatalogSelectedCount');
    if(selEl) selEl.textContent = String(selection.size);
  }

  function mapCatalogVendorToRecord(v, overrides={}){
    return {
      id: (typeof generateId === 'function') ? generateId() : Math.random().toString(36).slice(2),
      name: v.name,
      category: overrides.category || 'tactical',
      dataTypes: overrides.dataTypes || ['Confidential'],
      sector: overrides.sector || v.category,
      location: overrides.location || 'Unknown',
      contact: overrides.contact || '',
      notes: overrides.notes || (v.notes || ''),
      providesSoftware: (typeof overrides.providesSoftware === 'boolean') ? overrides.providesSoftware : !!v.providesSoftware,
      sbomAvailable: (typeof overrides.sbomAvailable === 'boolean') ? overrides.sbomAvailable : false,
      sbomFormat: overrides.sbomFormat || 'none'
    };
  }

  function addVendorsToWorkingList(records) {
    if(!Array.isArray(records) || records.length===0) {
        console.warn('addVendorsToWorkingList: Invalid or empty records array');
        return;
    }
    
    try {
        // Filter out invalid records
        const validRecords = records.filter(r => r && r.name && typeof r.name === 'string' && r.name.trim().length > 0);
        
        if (validRecords.length === 0) {
            console.warn('addVendorsToWorkingList: No valid records after filtering');
            alert('No valid vendors to add. Please check the data.');
            return;
        }
        
        // Get current mode and config
        const mode = (typeof detectMode === 'function') ? detectMode() : 'demo';
        const config = (typeof MODE_CONFIG !== 'undefined' && MODE_CONFIG[mode]) 
            ? MODE_CONFIG[mode] 
            : { maxVendors: 25, dataSource: 'catalog', persistence: 'session', name: 'Demo' };
        const storageKey = config.dataSource === 'catalog' 
            ? 'vendorsoluce_demo_data' 
            : 'vendorsoluce_user_data';
        const storage = config.persistence === 'session' ? sessionStorage : localStorage;
        
        // Use the vendorData variable from the main scope, not window.vendorData
        const current = (typeof vendorData !== 'undefined' && Array.isArray(vendorData)) ? vendorData : [];
        const room = config.maxVendors - current.length;
        
        if(room <= 0) {
            if (mode === 'demo') {
                const message = `Vendor limit reached in demo mode (${config.maxVendors} vendors max). Start a free trial for up to 100 vendors!`;
                if(typeof startTrial === 'function') {
                    if(confirm(message + '\n\nWould you like to start your free trial now?')) {
                        startTrial();
                    }
                } else {
                    if(typeof openUpgrade === 'function') {
                        openUpgrade(message);
                    } else {
                        alert(message);
                    }
                }
            } else {
                if(typeof openUpgrade === 'function') {
                    openUpgrade('Vendor limit reached. Upgrade to Professional for unlimited vendors.');
                } else {
                    alert('Vendor limit reached. Upgrade to Professional for unlimited vendors.');
                }
            }
            return;
        }
        
        const trimmed = validRecords.slice(0, room);
        
        // Ensure each vendor has an ID
        const vendorsWithIds = trimmed.map(v => ({
            ...v,
            id: v.id || generateId()
        }));
        
        vendorData = current.concat(vendorsWithIds);
        
        // Recalculate risks with error handling
        vendorData = vendorData.map(v => {
            try {
                return {
                    ...v,
                    ...calculateVendorRisk(v)
                };
            } catch (err) {
                console.error('Error calculating risk for vendor:', v, err);
                // Return vendor with default risk if calculation fails
                return {
                    ...v,
                    inherentRisk: v.inherentRisk || 50,
                    residualRisk: v.residualRisk || 50,
                    riskLevel: v.riskLevel || 'medium',
                    sbomProfile: v.sbomProfile || { providesSoftware: false, sbomAvailable: false, sbomFormat: 'none' }
                };
            }
        });
        
        // Save with mode-specific key
        try {
            storage.setItem(storageKey, JSON.stringify(vendorData));
        } catch (storageErr) {
            console.error('Error saving vendor data:', storageErr);
            alert('Warning: Vendors added but could not be saved to storage. ' + storageErr.message);
        }
        
        // Update displays
        if(typeof updateAllDisplays === 'function') {
            updateAllDisplays();
        } else {
            console.warn('updateAllDisplays function not available');
        }
        
        if(typeof updateKpis === 'function') {
            updateKpis(vendorData);
        }
        
        // Show success message
        if (trimmed.length < validRecords.length) {
            alert(`Added ${trimmed.length} vendor(s). ${validRecords.length - trimmed.length} vendor(s) were skipped due to limit.`);
        } else if (trimmed.length === validRecords.length && trimmed.length > 0) {
            // Silent success for single vendor additions from catalog
            console.log(`Successfully added ${trimmed.length} vendor(s)`);
        }
    } catch (error) {
        console.error('Error in addVendorsToWorkingList:', error);
        alert('Error adding vendors: ' + (error.message || 'Unknown error'));
    }
  }

  function downloadCsv(filename, csvText){
    const blob = new Blob([csvText], {type:'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(()=>URL.revokeObjectURL(url), 2000);
  }

  function templateCsv() {
    const header = REQUIRED_COLS.join(',');
    // Sample data for demo - includes realistic vendor examples with proper formatting
    const rows = [
      ['AWS','critical','PII;Financial;Confidential','Cloud Services','United States','security@aws.amazon.com','Primary cloud infrastructure provider','false','none','true'],
      ['Okta','strategic','PII;Confidential','Identity & Access','United States','security@okta.com','SSO/IdP','true','SPDX','true'],
      ['Salesforce','strategic','PII;Confidential','CRM/Marketing','United States','security@salesforce.com','Customer relationship management','false','none','true'],
      ['Microsoft 365','critical','PII;Confidential;IP','Collaboration & Productivity','United States','security@microsoft.com','Email and collaboration suite','false','none','true'],
      ['GitHub','tactical','IP;Confidential','DevOps & Engineering','United States','security@github.com','Code repository and version control','true','SPDX','true'],
      ['CrowdStrike','strategic','PII;Confidential','Cybersecurity','United States','security@crowdstrike.com','Endpoint detection and response','true','CycloneDX','true'],
      ['Stripe','tactical','Financial;PII','Payments/Financial','United States','security@stripe.com','Payment processing','false','none','true'],
      ['Snowflake','strategic','Financial;PII;Confidential','Data & Analytics','United States','security@snowflake.com','Data warehouse platform','true','SPDX','true']
    ];
    // Properly quote fields that contain commas or special characters
    const csv = [header].concat(rows.map(r=>r.map(x=>{
      const str = String(x);
      // Quote if contains comma, quote, or newline
      if (str.includes(',') || str.includes('"') || str.includes('\n')) {
        return `"${str.replace(/"/g, '""')}"`;
      }
      return str;
    }).join(','))).join('\n');
    return csv;
  }

  function validateRecord(obj){
    const errors = [];
    if(!normalize(obj.name)) errors.push('name is required');
    const cat = slug(obj.category);
    if(!['critical','strategic','tactical','commodity'].includes(cat)) errors.push('category must be one of: critical, strategic, tactical, commodity');
    if(obj.sbomAvailable && !['spdx','cyclonedx','none'].includes(slug(obj.sbomFormat))) errors.push('sbomFormat must be SPDX, CycloneDX, or none');
    return errors;
  }

  // Wizard state
  const wizard = {
    step: 0,
    industry: Object.keys(VS_TEMPLATES)[0] || 'Technology',
    sso: 'Okta',
    include: new Set(),
    dataTypes: new Set(['Confidential']),
    criticality: 'strategic'
  };
  const steps = ['Industry', 'SSO/Identity', 'Stack Template', 'Data Exposure', 'Review'];

  function renderStepper(){
    const el = document.getElementById('vsWizardStepper');
    if(!el) return;
    el.innerHTML = steps.map((s,i)=>`<span class="vs-step ${i===wizard.step?'active':''}">${i+1}. ${s}</span>`).join('');
  }

  function renderWizard(){
    renderStepper();
    const c = document.getElementById('vsWizardContent');
    if(!c) return;

    if(wizard.step===0){
      c.innerHTML = `
        <div class="vs-card">
          <div class="vs-field">
            <label>Select your industry</label>
            <select class="vs-select" id="vsWIndustry">
              ${Object.keys(VS_TEMPLATES).map(k=>`<option value="${escapeHtml(k)}" ${k===wizard.industry?'selected':''}>${escapeHtml(k)}</option>`).join('')}
            </select>
          </div>
          <div class="vs-muted">This will preload a realistic baseline vendor stack for your sector.</div>
        </div>
      `;
      document.getElementById('vsWIndustry').onchange = (e)=>wizard.industry = e.target.value;
      return;
    }

    if(wizard.step===1){
      c.innerHTML = `
        <div class="vs-card">
          <div class="vs-field">
            <label>Primary identity provider (SSO)</label>
            <select class="vs-select" id="vsWSSO">
              ${['Okta','Microsoft Entra ID (Azure AD)','Google Workspace','Ping Identity','OneLogin'].map(x=>`<option value="${escapeHtml(x)}" ${x===wizard.sso?'selected':''}>${escapeHtml(x)}</option>`).join('')}
            </select>
          </div>
          <div class="vs-alert">In production, VendorSoluce can pull assigned apps via SCIM/OAuth. Here we only preview what it would look like.</div>
        </div>
      `;
      document.getElementById('vsWSSO').onchange = (e)=>wizard.sso = e.target.value;
      return;
    }

    if(wizard.step===2){
      const tpl = VS_TEMPLATES[wizard.industry] || {};
      const blocks = Object.entries(tpl).map(([cat,list])=>{
        const pills = list.map(v=>`<span class="vs-pill"><input type="checkbox" style="margin:0" data-v="${escapeHtml(v)}" onchange="VSUI.wizardToggleVendor(this)" ${wizard.include.has(v)?'checked':''} /> ${escapeHtml(v)}</span>`).join('');
        return `
          <div class="vs-card" style="margin-bottom:12px">
            <div class="vs-row" style="justify-content:space-between;align-items:center">
              <div><b>${escapeHtml(cat)}</b><div class="vs-muted">${list.length} common vendors</div></div>
              <button class="vs-btn primary" onclick="VSUI.wizardAddCategory('${escapeHtml(cat)}')">Add all</button>
            </div>
            <div class="vs-row" style="margin-top:10px">${pills}</div>
          </div>
        `;
      }).join('');
      c.innerHTML = `
        <div class="vs-alert">Choose vendors that match your stack. You can also use the Catalog for more vendors.</div>
        ${blocks}
      `;
      return;
    }

    if(wizard.step===3){
      const opts = ['PII','PHI','Financial','IP','Confidential'];
      c.innerHTML = `
        <div class="vs-card">
          <div class="vs-field">
            <label>Data types shared with vendors</label>
            <div class="vs-row">
              ${opts.map(o=>`<span class="vs-pill"><input type="checkbox" style="margin:0" onchange="VSUI.wizardToggleDataType('${o}', this.checked)" ${wizard.dataTypes.has(o)?'checked':''} /> ${o}</span>`).join('')}
            </div>
          </div>
          <div class="vs-field">
            <label>Default criticality for imported stack</label>
            <select class="vs-select" id="vsWCrit">
              ${['critical','strategic','tactical','commodity'].map(x=>`<option value="${x}" ${x===wizard.criticality?'selected':''}>${x}</option>`).join('')}
            </select>
          </div>
          <div class="vs-muted">You can adjust individual vendors later in the vendor drawer.</div>
        </div>
      `;
      document.getElementById('vsWCrit').onchange = (e)=>wizard.criticality = e.target.value;
      return;
    }

    if(wizard.step===4){
      const list = Array.from(wizard.include);
      c.innerHTML = `
        <div class="vs-card">
          <div class="vs-row" style="justify-content:space-between;align-items:center">
            <div>
              <b>Ready to generate your vendor list</b>
              <div class="vs-muted">Industry: ${escapeHtml(wizard.industry)} â€¢ SSO: ${escapeHtml(wizard.sso)} â€¢ Vendors selected: ${list.length}</div>
            </div>
            <button class="vs-btn primary" onclick="VSUI.wizardApply()">Generate list</button>
          </div>
          <div class="vs-row" style="margin-top:12px">
            ${list.slice(0,24).map(v=>`<span class="vs-pill">${escapeHtml(v)}</span>`).join('')}
            ${list.length>24 ? `<span class="vs-muted">+${list.length-24} moreâ€¦</span>` : ''}
          </div>
        </div>
      `;
      return;
    }
  }

  function open(id){
    const el = document.getElementById(id);
    if (!el) {
      console.error('Modal element not found:', id);
      return;
    }
    el.style.display='flex';
    el.setAttribute('aria-hidden', 'false');
    if(id==='vsCatalogBackdrop'){ 
      buildCategoryOptions(); 
      renderCatalog(); 
    }
    if(id==='vsWizardBackdrop'){
      wizard.step=0;
      wizard.include.clear();
      const tpl = VS_TEMPLATES[wizard.industry]||{};
      Object.values(tpl).flat().slice(0,12).forEach(v=>wizard.include.add(v));
      renderWizard();
    }
    if(id==='vsApiBackdrop'){ 
      if (typeof VSUI !== 'undefined' && typeof VSUI.previewApiMock === 'function') {
        VSUI.previewApiMock(); 
      }
    }
  }
  function close(id){ 
    const el = document.getElementById(id);
    if (el) {
      el.style.display='none';
      el.setAttribute('aria-hidden', 'true');
    }
  }

  function toggleCatalogSelection(cb){
    const n = cb.getAttribute('data-vs-name');
    if(cb.checked) selection.add(n); else selection.delete(n);
    renderCatalog();
  }
  function clearCatalogSelection(){ selection.clear(); renderCatalog(); }
  function selectTopVisible(n){
    const boxes = Array.from(document.querySelectorAll('#vsCatalogTbody input[type="checkbox"]'));
    boxes.slice(0,n).forEach(b=>{ b.checked=true; selection.add(b.getAttribute('data-vs-name')); });
    renderCatalog();
  }
  function addVendorFromCatalog(name){
    const v = VS_CATALOG.find(x=>x.name===name);
    if(!v) return;
    addVendorsToWorkingList([mapCatalogVendorToRecord(v)]);
  }
  function addSelectedFromCatalog(){
    const chosen = Array.from(selection).map(name=>VS_CATALOG.find(x=>x.name===name)).filter(Boolean).map(v=>mapCatalogVendorToRecord(v));
    addVendorsToWorkingList(chosen);
    selection.clear();
    renderCatalog();
  }

  function downloadTemplate(){
    const csv = templateCsv();
    downloadCsv('vendorsoluce_vendor_import_template.csv', csv);
    const msg = [
      'Template downloaded.',
      'Validation rules:',
      '- name required',
      '- category: critical|strategic|tactical|commodity',
      '- dataTypes: separate with semicolons (PII;PHI;Financial;IP;Confidential)',
      '- sbomAvailable: true|false',
      '- sbomFormat: SPDX|CycloneDX|none'
    ].join('\n');
    if(typeof showToast==='function') showToast(msg);
    // Fallback handled silently
  }

  function wizardPrev(){ wizard.step = Math.max(0, wizard.step-1); renderWizard(); }
  function wizardNext(){ wizard.step = Math.min(steps.length-1, wizard.step+1); renderWizard(); }
  function wizardSkip(){ wizard.step = Math.min(steps.length-1, wizard.step+1); renderWizard(); }
  function wizardToggleVendor(cb){
    const v = cb.getAttribute('data-v');
    if(cb.checked) wizard.include.add(v); else wizard.include.delete(v);
  }
  function wizardAddCategory(cat){
    const tpl = VS_TEMPLATES[wizard.industry]||{};
    (tpl[cat]||[]).forEach(v=>wizard.include.add(v));
    renderWizard();
  }
  function wizardToggleDataType(dt, on){ if(on) wizard.dataTypes.add(dt); else wizard.dataTypes.delete(dt); }
  function wizardApply(){
    const records = Array.from(wizard.include).map(name=>VS_CATALOG.find(v=>v.name===name) || {name, category:'', industries:[wizard.industry], providesSoftware:true, notes:''});
    const mapped = records.map(v=>mapCatalogVendorToRecord(v, {
      category: wizard.criticality,
      dataTypes: Array.from(wizard.dataTypes),
      location: 'Unknown',
      notes: (v.notes||'') + (v.providesSoftware ? ' â€¢ Software vendor' : '')
    }));
    const ssoName = wizard.sso;
    if(!Array.from(wizard.include).includes(ssoName)) {
      const v = VS_CATALOG.find(x=>x.name===ssoName) || {name:ssoName, category:'Identity & Access', industries:['All'], providesSoftware:true, notes:'Identity provider'};
      mapped.unshift(mapCatalogVendorToRecord(v, {category:'critical', dataTypes:['PII','Confidential'], sector:'Identity & Access'}));
    }
    addVendorsToWorkingList(mapped);
    close('vsWizardBackdrop');
  }

  function apiMock(provider){
    const base = {
      okta: { endpoints: ['GET /api/v1/apps', 'GET /api/v1/groups', 'GET /api/v1/users'], sample: [
        {app:'Salesforce', owner:'IT', sso:'SAML', groups:['Sales','RevOps']},
        {app:'Workday', owner:'HR', sso:'OIDC', groups:['HR']},
        {app:'AWS', owner:'Security', sso:'SAML', groups:['Engineering','Infra']}
      ]},
      entra: { endpoints: ['GET /v1.0/applications', 'GET /v1.0/servicePrincipals', 'GET /v1.0/groups'], sample: [
        {app:'Microsoft 365', owner:'IT', sso:'OIDC', groups:['All Employees']},
        {app:'ServiceNow', owner:'IT', sso:'SAML', groups:['ITSM']},
        {app:'GitHub', owner:'Engineering', sso:'SAML', groups:['Developers']}
      ]},
      google: { endpoints: ['GET /admin/directory/v1/apps', 'GET /admin/directory/v1/groups', 'GET /admin/directory/v1/users'], sample: [
        {app:'Google Workspace', owner:'IT', sso:'OIDC', groups:['All']},
        {app:'Zoom', owner:'IT', sso:'SAML', groups:['All']},
        {app:'Slack', owner:'IT', sso:'SAML', groups:['All']}
      ]},
      ping: { endpoints: ['GET /v1/applications', 'GET /v1/groups', 'GET /v1/users'], sample: [
        {app:'Salesforce', owner:'IT', sso:'SAML', groups:['Sales']},
        {app:'Workday', owner:'HR', sso:'SAML', groups:['HR']}
      ]},
      onelogin: { endpoints: ['GET /api/2/apps', 'GET /api/2/groups', 'GET /api/2/users'], sample: [
        {app:'Zendesk', owner:'CX', sso:'SAML', groups:['Support']},
        {app:'HubSpot', owner:'Marketing', sso:'SAML', groups:['Marketing']}
      ]}
    };
    return base[provider] || base.okta;
  }

  function previewApiMock(){
    const prov = document.getElementById('vsApiProvider')?.value || 'okta';
    const mock = apiMock(prov);
    const preview = {
      provider: prov,
      endpoints: mock.endpoints,
      response: mock.sample,
      mapping: { vendorName: 'app', sector: 'Derived from app category', owner: 'owner', ssoMethod: 'sso', groups: 'groups[]' }
    };
    const el = document.getElementById('vsApiPreview');
    if(el) el.textContent = JSON.stringify(preview, null, 2);
  }

  function applyApiMock(){
    const prov = document.getElementById('vsApiProvider')?.value || 'okta';
    const mock = apiMock(prov);
    const records = mock.sample.map(s=>{
      const v = VS_CATALOG.find(x=>x.name===s.app) || {name:s.app, category:'', industries:['All'], providesSoftware:true, notes:''};
      return mapCatalogVendorToRecord(v, {
        category: 'strategic',
        dataTypes: ['Confidential'],
        sector: v.category || 'SaaS',
        notes: (v.notes||'') + ` â€¢ Detected via IdP (${prov}) â€¢ Owner: ${s.owner} â€¢ SSO: ${s.sso}`
      });
    });
    addVendorsToWorkingList(records);
    close('vsApiBackdrop');
  }

  window.VSUI = {
    open, close,
    toggleCatalogSelection, clearCatalogSelection, selectTopVisible,
    addVendorFromCatalog, addSelectedFromCatalog,
    downloadTemplate,
    wizardPrev, wizardNext, wizardSkip,
    wizardToggleVendor, wizardAddCategory, wizardToggleDataType, wizardApply,
    previewApiMock, applyApiMock
  };

  document.addEventListener('DOMContentLoaded', ()=>{
    ensureToolbarButtons();
    buildCategoryOptions();
    const search = document.getElementById('vsCatalogSearch');
    const ind = document.getElementById('vsCatalogIndustry');
    const cat = document.getElementById('vsCatalogCategory');
    if(search) search.addEventListener('input', renderCatalog);
    if(ind) ind.addEventListener('change', renderCatalog);
    if(cat) cat.addEventListener('change', renderCatalog);
    
    // Mark active navigation links
    const currentPath = window.location.pathname;
    const currentPage = currentPath.split('/').pop() || 'index.html';
    const navLinks = document.querySelectorAll('nav a[href]');
    navLinks.forEach(link => {
      const href = link.getAttribute('href');
      if (href) {
        const linkPage = href.split('/').pop();
        // Check if this link matches the current page
        if (linkPage === currentPage || 
            (currentPage === 'vendor-risk-radar.html' && href.includes('vendor-risk-radar.html')) ||
            (currentPage === '' && href === '../index.html' && currentPath.endsWith('/'))) {
          link.classList.add('active');
          link.setAttribute('aria-current', 'page');
        }
      }
    });
    
    // Initialize app with mode detection (if not already initialized)
    if(typeof initializeApp === 'function' && typeof currentMode === 'undefined') {
      initializeApp();
    }
    
    // Backup handler for import button (in case inline onclick doesn't work)
    const importBtn = document.querySelector('button[onclick*="importFile"]');
    const importFileInput = document.getElementById('importFile');
    if (importBtn && importFileInput) {
      importBtn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        importFileInput.click();
      });
    }
  });
  
  // Ensure all button functions are globally accessible
  if (typeof scanVendors !== 'undefined') window.scanVendors = scanVendors;
  if (typeof openAddVendor !== 'undefined') window.openAddVendor = openAddVendor;
  if (typeof clearAllVendors !== 'undefined') window.clearAllVendors = clearAllVendors;
  if (typeof closeVendorModal !== 'undefined') window.closeVendorModal = closeVendorModal;
  if (typeof editVendor !== 'undefined') window.editVendor = editVendor;
  if (typeof deleteVendor !== 'undefined') window.deleteVendor = deleteVendor;
})();
</script>
<!-- Shared Footer for VendorSoluce -->
<footer class="border-t border-gray-200 dark:border-gray-800/60 bg-white dark:bg-gray-800 backdrop-blur-sm" style="margin-top: 40px;">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-2 sm:py-3">
    <div class="flex flex-col md:flex-row md:items-start gap-8 md:gap-10 mb-2">
      <div class="flex items-start space-x-1 flex-shrink-0">
        <img src="../homepage_files/vendorsoluce.png" alt="VendorSoluce Logo" class="h-16 w-16 sm:h-20 sm:w-20 transition-transform duration-300 hover:scale-110 flex-shrink-0 block opacity-100" loading="eager">
        <div class="brand-text">
          <span class="block text-[10px] sm:text-xs md:text-sm font-bold text-vendorsoluce-green dark:text-white truncate leading-tight">
            VendorSoluce&trade;
            <span class="vs-badge ml-1.5">beta</span>
          </span>
          <span class="block text-[9px] sm:text-[10px] md:text-[10px] text-vendorsoluce-green/80 text-gray-700 dark:text-vendorsoluce-light-green font-normal leading-tight tracking-tighter" style="letter-spacing: -0.02em; margin-top: -3px;">Supply Chain Assurance</span>
          <span class="block text-[9px] sm:text-[10px] md:text-[10px] text-gray-600 dark:text-gray-400 font-normal leading-tight">by ERMITS</span>
          <div class="text-sm mt-2 text-gray-700 dark:text-gray-300 leading-tight">
            <div>VendorSoluce&trade; Supply Chain Assurance &mdash;</div>
            <div>Privacy-First</div>
            <div>Comprehensive supply chain risk management platform</div>
          </div>
        </div>
      </div>
      <div class="flex flex-col md:flex-row md:items-start gap-8 md:gap-10 flex-1 md:ml-8 lg:ml-12">
        <div class="flex-1">
          <h3 class="font-medium mb-3 text-sm text-gray-700 dark:text-gray-300">Quick Links</h3>
          <ul class="space-y-0 leading-tight">
            <li><a class="text-sm font-medium flex items-center gap-1.5 text-gray-700 dark:text-gray-300 hover:text-vendorsoluce-green dark:hover:text-white transition-colors" href="../how-it-works.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-layers w-3.5 h-3.5 text-current inline-block"><path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"></path><path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"></path><path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"></path></svg>How It Works</a></li>
            <li><a class="text-sm font-medium flex items-center gap-1.5 text-gray-700 dark:text-gray-300 hover:text-vendorsoluce-green dark:hover:text-white transition-colors" href="../features.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sparkles w-3.5 h-3.5 text-current inline-block"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path><path d="M5 3v4"></path><path d="M19 17v4"></path><path d="M3 5h4"></path><path d="M17 19h4"></path></svg>Features</a></li>
            <li><a class="text-sm font-medium flex items-center gap-1.5 text-gray-700 dark:text-gray-300 hover:text-vendorsoluce-green dark:hover:text-white transition-colors" href="../pricing.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-dollar-sign w-3.5 h-3.5 text-current inline-block"><line x1="12" x2="12" y1="2" y2="22"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>Pricing</a></li>
            <li><a class="text-sm font-medium flex items-center gap-1.5 text-gray-700 dark:text-gray-300 hover:text-vendorsoluce-green dark:hover:text-white transition-colors" href="../trust.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shield w-3.5 h-3.5 text-current inline-block"><path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"></path></svg>Trust</a></li>
          </ul>
        </div>
        <div class="flex-1">
          <h3 class="font-medium mb-2 text-sm text-gray-700 dark:text-gray-300">Resources</h3>
          <ul class="space-y-0 leading-tight">
            <li><a class="text-sm font-medium flex items-center gap-1.5 text-gray-700 dark:text-gray-300 hover:text-vendorsoluce-green dark:hover:text-white transition-colors" href="vendor-risk-radar.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-radar w-3.5 h-3.5 text-current inline-block"><path d="M19.07 4.93A10 10 0 0 0 6.99 3.34M4.93 19.07a10 10 0 0 1 1.65-12.08M15.34 6.99a10 10 0 0 1 2.73 12.08M2 12h20M12 2v20"></path><circle cx="12" cy="12" r="2"></circle></svg>Vendor Risk Radar</a></li>
            <li><a class="text-sm font-medium flex items-center gap-1.5 text-gray-700 dark:text-gray-300 hover:text-vendorsoluce-green dark:hover:text-white transition-colors" href="https://app.vendorsoluce.com/tools/vendor-risk-radar" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-external-link w-3.5 h-3.5 text-current inline-block"><path d="M15 3h6v6"></path><path d="M10 14 21 3"></path><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path></svg>React App Version</a></li>
            <li><a class="text-sm font-medium flex items-center gap-1.5 text-gray-700 dark:text-gray-300 hover:text-vendorsoluce-green dark:hover:text-white transition-colors" href="../index.html#best-practices"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-award w-3.5 h-3.5 text-current inline-block"><circle cx="12" cy="8" r="6"></circle><path d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11"></path></svg>Best Practices</a></li>
            <li><a class="text-sm font-medium flex items-center gap-1.5 text-gray-700 dark:text-gray-300 hover:text-vendorsoluce-green dark:hover:text-white transition-colors" href="../contact.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-mail w-3.5 h-3.5 text-current inline-block"><rect width="20" height="16" x="2" y="4" rx="2"></rect><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path></svg>Contact</a></li>
            <li><a class="text-sm font-medium flex items-center gap-1.5 text-gray-700 dark:text-gray-300 hover:text-vendorsoluce-green dark:hover:text-white transition-colors" href="../faq.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-help-circle w-3.5 h-3.5 text-current inline-block"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><path d="M12 17h.01"></path></svg>FAQ</a></li>
          </ul>
        </div>
        <div class="flex-1">
          <h3 class="font-medium mb-2 text-sm text-gray-700 dark:text-gray-300">Legal</h3>
          <ul class="space-y-0 leading-tight">
            <li><a class="text-sm font-medium flex items-center gap-1.5 text-gray-700 dark:text-gray-300 hover:text-vendorsoluce-green dark:hover:text-white transition-colors" href="../legal/privacy-policy.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-lock w-3.5 h-3.5 text-current inline-block"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>Privacy Policy</a></li>
            <li><a class="text-sm font-medium flex items-center gap-1.5 text-gray-700 dark:text-gray-300 hover:text-vendorsoluce-green dark:hover:text-white transition-colors" href="../legal/cookie-policy.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-cookie w-3.5 h-3.5 text-current inline-block"><path d="M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5"></path><path d="M8.5 8.5v.01"></path><path d="M16 15.5v.01"></path><path d="M12 12v.01"></path><path d="M11 17v.01"></path><path d="M7 14v.01"></path></svg>Cookie Policy</a></li>
            <li><a class="text-sm font-medium flex items-center gap-1.5 text-gray-700 dark:text-gray-300 hover:text-vendorsoluce-green dark:hover:text-white transition-colors" href="../legal/terms.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-scale w-3.5 h-3.5 text-current inline-block"><path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"></path><path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"></path><path d="M7 21h10"></path><path d="M12 3v18"></path><path d="M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2"></path></svg>Terms of Service</a></li>
            <li><a class="text-sm font-medium flex items-center gap-1.5 text-gray-700 dark:text-gray-300 hover:text-vendorsoluce-green dark:hover:text-white transition-colors" href="../legal/acceptable-use-policy.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shield-check w-3.5 h-3.5 text-current inline-block"><path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"></path><path d="m9 12 2 2 4-4"></path></svg>Acceptable Use</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="flex flex-col lg:flex-row justify-between items-center gap-3 lg:gap-4 pt-1 border-t border-gray-200 dark:border-gray-800/60">
      <div class="flex flex-col sm:flex-row items-center gap-3 flex-1 justify-center lg:justify-start">
        <div class="flex items-center space-x-1.5 px-2.5 py-1.5 rounded-lg bg-secure-green/10 border border-secure-green/30 status-badge-secure">
          <img src="../homepage_files/vendorsoluce.png" alt="VendorSoluce Logo" class="w-3.5 h-3.5 block opacity-100" loading="eager">
          <span class="text-[10px] sm:text-xs font-medium text-secure-green">Privacy-First â€¢ Local Storage</span>
        </div>
        <div class="flex items-center space-x-1.5">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-circle2 w-3.5 h-3.5 text-secure-green"><circle cx="12" cy="12" r="10"></circle><path d="m9 12 2 2 4-4"></path></svg>
          <span class="text-[10px] sm:text-xs text-gray-500 dark:text-gray-400">Version 1.0</span>
        </div>
      </div>
      <div class="flex flex-col items-center lg:items-end space-y-0 leading-tight text-xs flex-shrink-0">
        <div class="text-[10px] sm:text-xs text-gray-500 dark:text-gray-400">Â© 2025 ERMITS LLC</div>
      </div>
    </div>
  </div>
</footer>
<script src="../includes/active-nav.js"></script>
</body>
</html>
